h6. RIP

# product
## skip {{collapse(БД)
<pre>
|id |document_name_format |document_format_version|check_code|date_begin|date_end  |ordernum|service_code|check_action|
|---|---------------------|-----------------------|----------|----------|----------|--------|------------|------------|
|75 |repimportedproduct_v4|4                      |product   |2025-02-20|2050-02-20|5       |inspector   |skip        |

</pre>
}}
{{collapse(Полный лог)
<pre>
2025-06-19 13:47:45,976 DEBUG [] [PollThread] = poll:0
2025-06-19 13:47:45,976 DEBUG [] [PollThread] = repeat()
2025-06-19 13:47:45,976 DEBUG [] [PollThread] = repeatEnabled:true
2025-06-19 13:47:45,976 DEBUG [] [PollThread] = repeatRecords size:0
2025-06-19 13:47:45,976 DEBUG [] [PollThread] = records is empty
2025-06-19 13:47:45,979 DEBUG [] [PollThread] = commitSync()
2025-06-19 13:47:46,485 DEBUG [] [PollThread] = poll:1
2025-06-19 13:47:46,486 DEBUG [] [PollThread] = consume. key:[null] value:[{"type":"repimportedproduct_v4","uri":"030000434308-6635f0eb-d36a-4982-90e2-a1fb1175e541","fsrarid":"030000434308","date":"2025-06-05","timezone":"+03:00","inn":"7841051711","kpp":""}] offset:[19299] topic:[confirmed])
2025-06-19 13:47:46,486 INFO [] [PollThread] = Start processing.
2025-06-19 13:47:46,488 DEBUG [] [PollThread] = Для получения файла используем БД
2025-06-19 13:47:46,488 DEBUG [] [PollThread] = Loading data by uri: 6635f0eb-d36a-4982-90e2-a1fb1175e541
2025-06-19 13:47:46,488 DEBUG [] [PollThread] = SELECT filedata FROM filedata.inboxdata
WHERE uri=?
ORDER BY id

2025-06-19 13:47:46,509 DEBUG [] [PollThread] = Doc type:DocType{type='repimportedproduct_v4', num='46', ticketDocName='RepImportedProduct_v4'} date:2025-06-19 number:00018
2025-06-19 13:47:46,509 DEBUG [] [PollThread] = 030000434308-6635f0eb-d36a-4982-90e2-a1fb1175e541
2025-06-19 13:47:46,510 DEBUG [] [PollThread] = Load:22 ms
2025-06-19 13:47:46,510 DEBUG [] [PollThread] = checkExist:repimportedproduct_v4
2025-06-19 13:47:46,510 DEBUG [] [PollThread] = find rule:DocTypeCode[docType=DocType{type='repimportedproduct_v4', num='46', ticketDocName='RepImportedProduct_v4'}, code=doubles] Rule[code=doubles, mode=ERROR, start=Проверка документа на повтор, reject=Документ с номером %s и датой %s уже зафиксирован в системе, confirm=Проверка пройдена]
2025-06-19 13:47:46,510 DEBUG [] [PollThread] = existRegistryDoc [030000434308] [repimportedproduct_v4] [00018] [2025-06-19]
2025-06-19 13:47:46,510 DEBUG [] [PollThread] = SELECT 1
FROM
  registry.documents
WHERE
  fsrarid = ?
  AND dtype = ?
  AND client_number = ?
  AND dt = ?
LIMIT 1

2025-06-19 13:47:46,515 DEBUG [] [PollThread] = 30000434308 repimportedproduct_v4 00018 2025-06-19
2025-06-19 13:47:46,519 DEBUG [] [PollThread] = docHash: 76a6357eb475b8c767571ad43b280fb5
2025-06-19 13:47:46,521 DEBUG [] [PollThread] = set docHash 76a6357eb475b8c767571ad43b280fb5 to redis
2025-06-19 13:47:46,521 DEBUG [] [PollThread] = checkDayShift:repimportedproduct_v4
2025-06-19 13:47:46,521 DEBUG [] [PollThread] = find rule:DocTypeCode[docType=DocType{type='repimportedproduct_v4', num='46', ticketDocName='RepImportedProduct_v4'}, code=daterange] Rule[code=daterange, mode=SKIP, start=Дата, указанная отправителем в документе, может отличаться от даты подачи документа в ЕГАИС на три дня в большую или меньшую сторону (с учетом часовых поясов), reject=Дата документа (%s) отличается от текущей более чем на три дня, confirm=Проверка пройдена]
2025-06-19 13:47:46,521 DEBUG [] [PollThread] = skip:daterange
2025-06-19 13:47:46,521 DEBUG [] [PollThread] = docDate:2025-06-19 
2025-06-19 13:47:46,522 DEBUG [] [PollThread] = importedDate:2025-06-19 
2025-06-19 13:47:46,522 DEBUG [] [PollThread] = betweenDays:0
2025-06-19 13:47:46,522 DEBUG [] [PollThread] = checkShipper:repimportedproduct_v4
2025-06-19 13:47:46,522 DEBUG [] [PollThread] = find rule:DocTypeCode[docType=DocType{type='repimportedproduct_v4', num='46', ticketDocName='RepImportedProduct_v4'}, code=senderproducer] Rule[code=senderproducer, mode=ERROR, start=Отправитель отчета о производстве должен совпадать с производителем продукции, указанным в документе., reject=СИО отправителя документа не соответствует СИО производителя продукции, confirm=Проверка пройдена]
2025-06-19 13:47:46,522 DEBUG [] [PollThread] = checkQuantityFormat:DocType{type='repimportedproduct_v4', num='46', ticketDocName='RepImportedProduct_v4'}
2025-06-19 13:47:46,523 DEBUG [] [PollThread] = find rule:DocTypeCode[docType=DocType{type='repimportedproduct_v4', num='46', ticketDocName='RepImportedProduct_v4'}, code=quantity] Rule[code=quantity, mode=WARNING, start=Количество должно быть больше нуля, если значение «isUnpacked» - «0», проверяем что Quantity - целое число, reject=Значение количества продукции с кодом %s не соответствует формату, confirm=Проверка пройдена]
2025-06-19 13:47:46,524 DEBUG [] [PollThread] = find rule:DocTypeCode[docType=DocType{type='repimportedproduct_v4', num='46', ticketDocName='RepImportedProduct_v4'}, code=product] Rule[code=product, mode=SKIP, start=В документах ввода в оборот может быть указана только продукция, предварительно зарегистрированная во ФРАП и имеющая код ЕГАИС, reject=Продукция с кодами %s не зарегистрирована в ЕГАИС, confirm=Проверка пройдена]
2025-06-19 13:47:46,524 DEBUG [] [PollThread] = skip:product
2025-06-19 13:47:46,525 DEBUG [] [PollThread] = checkcUnionMembership [112] 
2025-06-19 13:47:46,525 DEBUG [] [PollThread] = SELECT 1
FROM
  subref.country_unions_lnk cul
  JOIN subref.country_unions cu ON cu.id = cul.country_unions_id
  AND cu.code = 'ЕАЭС'
WHERE
  cul.country_code = ?

2025-06-19 13:47:46,556 DEBUG [] [PollThread] = gen:IMP-0000000041
2025-06-19 13:47:46,558 DEBUG [] [PollThread] = Success
2025-06-19 13:47:46,558 DEBUG [] [PollThread] = Create ticket
2025-06-19 13:47:46,558 DEBUG [] [PollThread] = docUri:030000434308-6635f0eb-d36a-4982-90e2-a1fb1175e541
2025-06-19 13:47:46,558 DEBUG [] [PollThread] = date:2025-06-19T13:47:46.558222929
2025-06-19 13:47:46,558 DEBUG [] [PollThread] = ticketUri:030000434308-f051aea6-e96f-4b72-8c35-b7c55d46da01
2025-06-19 13:47:46,558 DEBUG [] [PollThread] = xmlTransportId:030000434308-6635f0eb-d36a-4982-90e2-a1fb1175e541
2025-06-19 13:47:46,558 DEBUG [] [PollThread] = templatePath:xml/ticket.xml
2025-06-19 13:47:46,559 DEBUG [] [PollThread] = <?xml version="1.0" encoding="utf-8"?>
<ns:Documents xmlns:tc="http://fsrar.ru/WEGAIS/Ticket"
              xmlns:oref="http://fsrar.ru/WEGAIS/ClientRef"
              xmlns:ns="http://fsrar.ru/WEGAIS/WB_DOC_SINGLE_01"
              xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
              Version="1.0">
    <ns:Owner>
        <ns:FSRAR_ID>3463047</ns:FSRAR_ID>
    </ns:Owner>
    <ns:Document>
        <ns:Ticket>
            <tc:TicketDate>2025-06-19T13:47:46.558</tc:TicketDate>
            <tc:Identity>00018</tc:Identity>
            <tc:DocId></tc:DocId>
            <tc:TransportId>030000434308-6635f0eb-d36a-4982-90e2-a1fb1175e541</tc:TransportId>
            <tc:RegID>IMP-0000000041</tc:RegID>
            <tc:DocHash/>
            <tc:DocType>RepImportedProduct_v4</tc:DocType>
            <tc:Result>
                <tc:Conclusion>Accepted</tc:Conclusion>
                <tc:ConclusionDate>2025-06-19T13:47:46.558</tc:ConclusionDate>
                <tc:Comments>Документ успешно принят системой на обработку.</tc:Comments>
            </tc:Result>
        </ns:Ticket>
    </ns:Document>
</ns:Documents>


2025-06-19 13:47:46,559 DEBUG [] [PollThread] = Для сохранения квитанции используем БД
2025-06-19 13:47:46,559 DEBUG [] [PollThread] = save ticket to DB: Ticket{xml='<?xml version="1.0" encoding="utf-8"?>
<ns:Documents xmlns:tc="http://fsrar.ru/WEGAIS/Ticket"
              xmlns:oref="http://fsrar.ru/WEGAIS/ClientRef"
              xmlns:ns="http://fsrar.ru/WEGAIS/WB_DOC_SINGLE_01"
              xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
              Version="1.0">
    <ns:Owner>
        <ns:FSRAR_ID>3463047</ns:FSRAR_ID>
    </ns:Owner>
    <ns:Document>
        <ns:Ticket>
            <tc:TicketDate>2025-06-19T13:47:46.558</tc:TicketDate>
            <tc:Identity>00018</tc:Identity>
            <tc:DocId></tc:DocId>
            <tc:TransportId>030000434308-6635f0eb-d36a-4982-90e2-a1fb1175e541</tc:TransportId>
            <tc:RegID>IMP-0000000041</tc:RegID>
            <tc:DocHash/>
            <tc:DocType>RepImportedProduct_v4</tc:DocType>
            <tc:Result>
                <tc:Conclusion>Accepted</tc:Conclusion>
                <tc:ConclusionDate>2025-06-19T13:47:46.558</tc:ConclusionDate>
                <tc:Comments>Документ успешно принят системой на обработку.</tc:Comments>
            </tc:Result>
        </ns:Ticket>
    </ns:Document>
</ns:Documents>

', nowDateTime=2025-06-19T13:47:46.558222929, ticketDate='2025-06-19', ticketDateTime='2025-06-19T13:47:46.558', docUri='030000434308-6635f0eb-d36a-4982-90e2-a1fb1175e541', ticketUri='030000434308-f051aea6-e96f-4b72-8c35-b7c55d46da01', ticketUUID='f051aea6-e96f-4b72-8c35-b7c55d46da01', fsrarId='030000434308', identity='00018', templater=ru.centerinform.svs.insp.Templater@149443d5, type=DocType{type='repimportedproduct_v4', num='46', ticketDocName='RepImportedProduct_v4'}}
2025-06-19 13:47:46,559 DEBUG [] [PollThread] = INSERT INTO filedata.outboxdata
    (uri, inboxuri, filedata)
    VALUES(?, ?, ?)

2025-06-19 13:47:46,559 DEBUG [] [PollThread] = f051aea6-e96f-4b72-8c35-b7c55d46da01 6635f0eb-d36a-4982-90e2-a1fb1175e541 <?xml version="1.0" encoding="utf-8"?>
<ns:Documents xmlns:tc="http://fsrar.ru/WEGAIS/Ticket"
              xmlns:oref="http://fsrar.ru/WEGAIS/ClientRef"
              xmlns:ns="http://fsrar.ru/WEGAIS/WB_DOC_SINGLE_01"
              xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
              Version="1.0">
    <ns:Owner>
        <ns:FSRAR_ID>3463047</ns:FSRAR_ID>
    </ns:Owner>
    <ns:Document>
        <ns:Ticket>
            <tc:TicketDate>2025-06-19T13:47:46.558</tc:TicketDate>
            <tc:Identity>00018</tc:Identity>
            <tc:DocId></tc:DocId>
            <tc:TransportId>030000434308-6635f0eb-d36a-4982-90e2-a1fb1175e541</tc:TransportId>
            <tc:RegID>IMP-0000000041</tc:RegID>
            <tc:DocHash/>
            <tc:DocType>RepImportedProduct_v4</tc:DocType>
            <tc:Result>
                <tc:Conclusion>Accepted</tc:Conclusion>
                <tc:ConclusionDate>2025-06-19T13:47:46.558</tc:ConclusionDate>
                <tc:Comments>Документ успешно принят системой на обработку.</tc:Comments>
            </tc:Result>
        </ns:Ticket>
    </ns:Document>
</ns:Documents>


2025-06-19 13:47:46,564 DEBUG [] [PollThread] = insert 1 rows
2025-06-19 13:47:46,565 DEBUG [] [PollThread] = INSERT INTO outbox.meta (dtype, fsrarid, uri, ts)
    VALUES (?, ?, ?, ?)

2025-06-19 13:47:46,565 DEBUG [] [PollThread] = ticket 30000434308 f051aea6-e96f-4b72-8c35-b7c55d46da01 2025-06-19T13:47:46.558+0300
2025-06-19 13:47:46,569 DEBUG [] [PollThread] = insert 1 rows
2025-06-19 13:47:46,574 DEBUG [] [PollThread] = {"date":"2025-06-05","uri":"030000434308-6635f0eb-d36a-4982-90e2-a1fb1175e541","type":"repimportedproduct_v4","DocId":"IMP-0000000041"}
2025-06-19 13:47:46,578 DEBUG [] [PollThread] = Success finish
2025-06-19 13:47:46,578 INFO [] [PollThread] = End processing. 92 ms
2025-06-19 13:47:46,578 DEBUG [] [PollThread] = repeat()
2025-06-19 13:47:46,578 DEBUG [] [PollThread] = repeatEnabled:true
2025-06-19 13:47:46,578 DEBUG [] [PollThread] = repeatRecords size:0
2025-06-19 13:47:46,578 DEBUG [] [PollThread] = records is empty
2025-06-19 13:47:46,581 DEBUG [] [PollThread] = commitSync()
2025-06-19 13:47:46,736 DEBUG [] [GtdPollThread] = poll:0

</pre>
}}
{{collapse(Часть лога)
<pre>
2025-06-19 13:47:46,524 DEBUG [] [PollThread] = find rule:DocTypeCode[docType=DocType{type='repimportedproduct_v4', num='46', ticketDocName='RepImportedProduct_v4'}, code=product] Rule[code=product, mode=SKIP, start=В документах ввода в оборот может быть указана только продукция, предварительно зарегистрированная во ФРАП и имеющая код ЕГАИС, reject=Продукция с кодами %s не зарегистрирована в ЕГАИС, confirm=Проверка пройдена]
2025-06-19 13:47:46,524 DEBUG [] [PollThread] = skip:product

</pre>
}}
*Полученный результат: Проверка определилась, статус прохождения проверки проставился корректно - УСПЕХ*
## warn {{collapse(БД)
<pre>
|id |document_name_format |document_format_version|check_code|date_begin|date_end  |ordernum|service_code|check_action|
|---|---------------------|-----------------------|----------|----------|----------|--------|------------|------------|
|75 |repimportedproduct_v4|4                      |product   |2025-02-20|2050-02-20|5       |inspector   |warning     |

</pre>
}}
{{collapse(Полный лог)
<pre>
2025-06-19 13:50:53,230 DEBUG [] [PollThread] = repeatEnabled:true
2025-06-19 13:50:53,230 DEBUG [] [PollThread] = repeatRecords size:0
2025-06-19 13:50:53,230 DEBUG [] [PollThread] = records is empty
2025-06-19 13:50:53,231 DEBUG [] [GtdPollThread] = commitSync()
2025-06-19 13:50:53,232 DEBUG [] [PollThread] = commitSync()
2025-06-19 13:50:53,930 DEBUG [] [PollThread] = poll:1
2025-06-19 13:50:53,931 DEBUG [] [PollThread] = consume. key:[null] value:[{"type":"repimportedproduct_v4","uri":"030000434308-6635f0eb-d36a-4982-90e2-a1fb1175e542","fsrarid":"030000434308","date":"2025-06-05","timezone":"+03:00","inn":"7841051711","kpp":""}] offset:[19300] topic:[confirmed])
2025-06-19 13:50:53,952 INFO [] [PollThread] = Start processing.
2025-06-19 13:50:53,987 DEBUG [] [PollThread] = Для получения файла используем БД
2025-06-19 13:50:53,987 DEBUG [] [PollThread] = Loading data by uri: 6635f0eb-d36a-4982-90e2-a1fb1175e542
2025-06-19 13:50:53,987 DEBUG [] [PollThread] = SELECT filedata FROM filedata.inboxdata
WHERE uri=?
ORDER BY id

2025-06-19 13:50:54,052 DEBUG [] [PollThread] = Doc type:DocType{type='repimportedproduct_v4', num='46', ticketDocName='RepImportedProduct_v4'} date:2025-06-19 number:00018
2025-06-19 13:50:54,052 DEBUG [] [PollThread] = 030000434308-6635f0eb-d36a-4982-90e2-a1fb1175e542
2025-06-19 13:50:54,052 DEBUG [] [PollThread] = Load:65 ms
2025-06-19 13:50:54,055 DEBUG [] [PollThread] = checkExist:repimportedproduct_v4
2025-06-19 13:50:54,063 DEBUG [] [PollThread] = find rule:DocTypeCode[docType=DocType{type='repimportedproduct_v4', num='46', ticketDocName='RepImportedProduct_v4'}, code=doubles] Rule[code=doubles, mode=ERROR, start=Проверка документа на повтор, reject=Документ с номером %s и датой %s уже зафиксирован в системе, confirm=Проверка пройдена]
2025-06-19 13:50:54,063 DEBUG [] [PollThread] = existRegistryDoc [030000434308] [repimportedproduct_v4] [00018] [2025-06-19]
2025-06-19 13:50:54,063 DEBUG [] [PollThread] = SELECT 1
FROM
  registry.documents
WHERE
  fsrarid = ?
  AND dtype = ?
  AND client_number = ?
  AND dt = ?
LIMIT 1

2025-06-19 13:50:54,071 DEBUG [] [PollThread] = 30000434308 repimportedproduct_v4 00018 2025-06-19
2025-06-19 13:50:54,079 DEBUG [] [PollThread] = docHash: 95c136f7dbcc1a62aa4e376ecbfebf12
2025-06-19 13:50:54,083 DEBUG [] [PollThread] = set docHash 95c136f7dbcc1a62aa4e376ecbfebf12 to redis
2025-06-19 13:50:54,083 DEBUG [] [PollThread] = checkDayShift:repimportedproduct_v4
2025-06-19 13:50:54,083 DEBUG [] [PollThread] = find rule:DocTypeCode[docType=DocType{type='repimportedproduct_v4', num='46', ticketDocName='RepImportedProduct_v4'}, code=daterange] Rule[code=daterange, mode=SKIP, start=Дата, указанная отправителем в документе, может отличаться от даты подачи документа в ЕГАИС на три дня в большую или меньшую сторону (с учетом часовых поясов), reject=Дата документа (%s) отличается от текущей более чем на три дня, confirm=Проверка пройдена]
2025-06-19 13:50:54,083 DEBUG [] [PollThread] = skip:daterange
2025-06-19 13:50:54,083 DEBUG [] [PollThread] = docDate:2025-06-19 
2025-06-19 13:50:54,086 DEBUG [] [PollThread] = importedDate:2025-06-19 
2025-06-19 13:50:54,086 DEBUG [] [PollThread] = betweenDays:0
2025-06-19 13:50:54,086 DEBUG [] [PollThread] = checkShipper:repimportedproduct_v4
2025-06-19 13:50:54,086 DEBUG [] [PollThread] = find rule:DocTypeCode[docType=DocType{type='repimportedproduct_v4', num='46', ticketDocName='RepImportedProduct_v4'}, code=senderproducer] Rule[code=senderproducer, mode=ERROR, start=Отправитель отчета о производстве должен совпадать с производителем продукции, указанным в документе., reject=СИО отправителя документа не соответствует СИО производителя продукции, confirm=Проверка пройдена]
2025-06-19 13:50:54,086 DEBUG [] [PollThread] = checkQuantityFormat:DocType{type='repimportedproduct_v4', num='46', ticketDocName='RepImportedProduct_v4'}
2025-06-19 13:50:54,087 DEBUG [] [PollThread] = find rule:DocTypeCode[docType=DocType{type='repimportedproduct_v4', num='46', ticketDocName='RepImportedProduct_v4'}, code=quantity] Rule[code=quantity, mode=WARNING, start=Количество должно быть больше нуля, если значение «isUnpacked» - «0», проверяем что Quantity - целое число, reject=Значение количества продукции с кодом %s не соответствует формату, confirm=Проверка пройдена]
2025-06-19 13:50:54,087 DEBUG [] [PollThread] = find rule:DocTypeCode[docType=DocType{type='repimportedproduct_v4', num='46', ticketDocName='RepImportedProduct_v4'}, code=product] Rule[code=product, mode=WARNING, start=В документах ввода в оборот может быть указана только продукция, предварительно зарегистрированная во ФРАП и имеющая код ЕГАИС, reject=Продукция с кодами %s не зарегистрирована в ЕГАИС, confirm=Проверка пройдена]
2025-06-19 13:50:54,087 DEBUG [] [PollThread] = enter to checkLicense.
2025-06-19 13:50:54,087 DEBUG [] [PollThread] = selectFromNsiProducts [[1300004343080000007]]
2025-06-19 13:50:54,088 DEBUG [] [PollThread] = SELECT
  pt.code_egais AS ProductType_Code,
  p.alc_code,
  p.country_id AS Country_Code,
  p.importer_fsrar_id AS Importer_OwnerID,
  pt.product_group_code AS ProductVid_Code,
  p.is_unpacked AS isUnpacked,
  p.producer_fsrar_id AS Owner_ID
FROM
  "references".product_snapshot p
  INNER JOIN "references".product_type pt ON pt.id = p.product_type_id
WHERE
  alc_code IN (
?)
2025-06-19 13:50:54,098 DEBUG [] [PollThread] = finish selectFromNsiProducts. size:[0]
2025-06-19 13:50:54,105 DEBUG [] [PollThread] = warning:{}
ru.centerinform.svs.insp.doc.HandleException: Документ от организации 030000434308 номер 00018 с датой 2025-06-19. Код продукции 1300004343080000007 не найден в справочнике.
	at ru.centerinform.svs.insp.doc.checker.Checker.ex(Checker.java:635) ~[insp-3.27.0.jar:?]
	at ru.centerinform.svs.insp.doc.ri.RIHandler.checkAlcCodesQuantity(RIHandler.java:179) ~[insp-3.27.0.jar:?]
	at ru.centerinform.svs.insp.doc.ri.RIHandler.checkLicense(RIHandler.java:140) ~[insp-3.27.0.jar:?]
	at ru.centerinform.svs.insp.doc.ri.RIHandler.lambda$checkProduct$0(RIHandler.java:86) ~[insp-3.27.0.jar:?]
	at ru.centerinform.svs.insp.doc.checker.Checker.check(Checker.java:97) ~[insp-3.27.0.jar:?]
	at ru.centerinform.svs.insp.doc.ri.RIHandler.checkProduct(RIHandler.java:86) ~[insp-3.27.0.jar:?]
	at ru.centerinform.svs.insp.doc.ri.RIHandler.check(RIHandler.java:71) ~[insp-3.27.0.jar:?]
	at ru.centerinform.svs.insp.doc.ri.RIHandler.handle(RIHandler.java:50) ~[insp-3.27.0.jar:?]
	at ru.centerinform.svs.insp.InspMessageHandler.handleImpl(InspMessageHandler.java:99) ~[insp-3.27.0.jar:?]
	at ru.centerinform.svs.insp.InspMessageHandler.handle(InspMessageHandler.java:76) ~[insp-3.27.0.jar:?]
	at ru.centerinform.svs.insp.kafka.Consumption.poll0(Consumption.java:223) ~[insp-3.27.0.jar:?]
	at ru.centerinform.svs.insp.kafka.Consumption.poll(Consumption.java:93) ~[insp-3.27.0.jar:?]
	at ru.centerinform.svs.insp.kafka.PollThread.run(PollThread.java:121) ~[insp-3.27.0.jar:?]
2025-06-19 13:50:54,105 DEBUG [] [PollThread] = checkcUnionMembership [112] 
2025-06-19 13:50:54,105 DEBUG [] [PollThread] = SELECT 1
FROM
  subref.country_unions_lnk cul
  JOIN subref.country_unions cu ON cu.id = cul.country_unions_id
  AND cu.code = 'ЕАЭС'
WHERE
  cul.country_code = ?

2025-06-19 13:50:54,130 DEBUG [] [PollThread] = gen:IMP-0000000042
2025-06-19 13:50:54,132 DEBUG [] [PollThread] = Success
2025-06-19 13:50:54,133 DEBUG [] [PollThread] = Create ticket
2025-06-19 13:50:54,136 DEBUG [] [PollThread] = docUri:030000434308-6635f0eb-d36a-4982-90e2-a1fb1175e542
2025-06-19 13:50:54,136 DEBUG [] [PollThread] = date:2025-06-19T13:50:54.136778978
2025-06-19 13:50:54,138 DEBUG [] [PollThread] = ticketUri:030000434308-9ad7afaf-f58a-4fd7-808e-4fcbf77248de
2025-06-19 13:50:54,138 DEBUG [] [PollThread] = xmlTransportId:030000434308-6635f0eb-d36a-4982-90e2-a1fb1175e542
2025-06-19 13:50:54,138 DEBUG [] [PollThread] = set warning comments: Продукция с кодами 1300004343080000007 не зарегистрирована в ЕГАИС
2025-06-19 13:50:54,139 DEBUG [] [PollThread] = templatePath:xml/ticket.xml
2025-06-19 13:50:54,149 DEBUG [] [PollThread] = <?xml version="1.0" encoding="utf-8"?>
<ns:Documents xmlns:tc="http://fsrar.ru/WEGAIS/Ticket"
              xmlns:oref="http://fsrar.ru/WEGAIS/ClientRef"
              xmlns:ns="http://fsrar.ru/WEGAIS/WB_DOC_SINGLE_01"
              xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
              Version="1.0">
    <ns:Owner>
        <ns:FSRAR_ID>3463047</ns:FSRAR_ID>
    </ns:Owner>
    <ns:Document>
        <ns:Ticket>
            <tc:TicketDate>2025-06-19T13:50:54.136</tc:TicketDate>
            <tc:Identity>00018</tc:Identity>
            <tc:DocId></tc:DocId>
            <tc:TransportId>030000434308-6635f0eb-d36a-4982-90e2-a1fb1175e542</tc:TransportId>
            <tc:RegID>IMP-0000000042</tc:RegID>
            <tc:DocHash/>
            <tc:DocType>RepImportedProduct_v4</tc:DocType>
            <tc:Result>
                <tc:Conclusion>Accepted</tc:Conclusion>
                <tc:ConclusionDate>2025-06-19T13:50:54.136</tc:ConclusionDate>
                <tc:Comments>Документ успешно принят системой на обработку. Продукция с кодами 1300004343080000007 не зарегистрирована в ЕГАИС</tc:Comments>
            </tc:Result>
        </ns:Ticket>
    </ns:Document>
</ns:Documents>


2025-06-19 13:50:54,149 DEBUG [] [PollThread] = Для сохранения квитанции используем БД
2025-06-19 13:50:54,151 DEBUG [] [PollThread] = save ticket to DB: Ticket{xml='<?xml version="1.0" encoding="utf-8"?>
<ns:Documents xmlns:tc="http://fsrar.ru/WEGAIS/Ticket"
              xmlns:oref="http://fsrar.ru/WEGAIS/ClientRef"
              xmlns:ns="http://fsrar.ru/WEGAIS/WB_DOC_SINGLE_01"
              xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
              Version="1.0">
    <ns:Owner>
        <ns:FSRAR_ID>3463047</ns:FSRAR_ID>
    </ns:Owner>
    <ns:Document>
        <ns:Ticket>
            <tc:TicketDate>2025-06-19T13:50:54.136</tc:TicketDate>
            <tc:Identity>00018</tc:Identity>
            <tc:DocId></tc:DocId>
            <tc:TransportId>030000434308-6635f0eb-d36a-4982-90e2-a1fb1175e542</tc:TransportId>
            <tc:RegID>IMP-0000000042</tc:RegID>
            <tc:DocHash/>
            <tc:DocType>RepImportedProduct_v4</tc:DocType>
            <tc:Result>
                <tc:Conclusion>Accepted</tc:Conclusion>
                <tc:ConclusionDate>2025-06-19T13:50:54.136</tc:ConclusionDate>
                <tc:Comments>Документ успешно принят системой на обработку. Продукция с кодами 1300004343080000007 не зарегистрирована в ЕГАИС</tc:Comments>
            </tc:Result>
        </ns:Ticket>
    </ns:Document>
</ns:Documents>

', nowDateTime=2025-06-19T13:50:54.136778978, ticketDate='2025-06-19', ticketDateTime='2025-06-19T13:50:54.136', docUri='030000434308-6635f0eb-d36a-4982-90e2-a1fb1175e542', ticketUri='030000434308-9ad7afaf-f58a-4fd7-808e-4fcbf77248de', ticketUUID='9ad7afaf-f58a-4fd7-808e-4fcbf77248de', fsrarId='030000434308', identity='00018', templater=ru.centerinform.svs.insp.Templater@cf932, type=DocType{type='repimportedproduct_v4', num='46', ticketDocName='RepImportedProduct_v4'}}
2025-06-19 13:50:54,152 DEBUG [] [PollThread] = INSERT INTO filedata.outboxdata
    (uri, inboxuri, filedata)
    VALUES(?, ?, ?)

2025-06-19 13:50:54,152 DEBUG [] [PollThread] = 9ad7afaf-f58a-4fd7-808e-4fcbf77248de 6635f0eb-d36a-4982-90e2-a1fb1175e542 <?xml version="1.0" encoding="utf-8"?>
<ns:Documents xmlns:tc="http://fsrar.ru/WEGAIS/Ticket"
              xmlns:oref="http://fsrar.ru/WEGAIS/ClientRef"
              xmlns:ns="http://fsrar.ru/WEGAIS/WB_DOC_SINGLE_01"
              xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
              Version="1.0">
    <ns:Owner>
        <ns:FSRAR_ID>3463047</ns:FSRAR_ID>
    </ns:Owner>
    <ns:Document>
        <ns:Ticket>
            <tc:TicketDate>2025-06-19T13:50:54.136</tc:TicketDate>
            <tc:Identity>00018</tc:Identity>
            <tc:DocId></tc:DocId>
            <tc:TransportId>030000434308-6635f0eb-d36a-4982-90e2-a1fb1175e542</tc:TransportId>
            <tc:RegID>IMP-0000000042</tc:RegID>
            <tc:DocHash/>
            <tc:DocType>RepImportedProduct_v4</tc:DocType>
            <tc:Result>
                <tc:Conclusion>Accepted</tc:Conclusion>
                <tc:ConclusionDate>2025-06-19T13:50:54.136</tc:ConclusionDate>
                <tc:Comments>Документ успешно принят системой на обработку. Продукция с кодами 1300004343080000007 не зарегистрирована в ЕГАИС</tc:Comments>
            </tc:Result>
        </ns:Ticket>
    </ns:Document>
</ns:Documents>


2025-06-19 13:50:54,157 DEBUG [] [PollThread] = insert 1 rows
2025-06-19 13:50:54,157 DEBUG [] [PollThread] = INSERT INTO outbox.meta (dtype, fsrarid, uri, ts)
    VALUES (?, ?, ?, ?)

2025-06-19 13:50:54,157 DEBUG [] [PollThread] = ticket 30000434308 9ad7afaf-f58a-4fd7-808e-4fcbf77248de 2025-06-19T13:50:54.136+0300
2025-06-19 13:50:54,162 DEBUG [] [PollThread] = insert 1 rows
2025-06-19 13:50:54,166 DEBUG [] [PollThread] = {"date":"2025-06-05","uri":"030000434308-6635f0eb-d36a-4982-90e2-a1fb1175e542","type":"repimportedproduct_v4","DocId":"IMP-0000000042"}
2025-06-19 13:50:54,174 DEBUG [] [PollThread] = Success finish
2025-06-19 13:50:54,174 INFO [] [PollThread] = End processing. 221 ms
2025-06-19 13:50:54,174 DEBUG [] [PollThread] = repeat()
2025-06-19 13:50:54,174 DEBUG [] [PollThread] = repeatEnabled:true
2025-06-19 13:50:54,174 DEBUG [] [PollThread] = repeatRecords size:0
2025-06-19 13:50:54,174 DEBUG [] [PollThread] = records is empty
2025-06-19 13:50:54,178 DEBUG [] [PollThread] = commitSync()
2025-06-19 13:50:54,232 DEBUG [] [GtdPollThread] = poll:0
2025-06-19 13:50:54,232 DEBUG [] [GtdPollThread] = repeat()
2025-06-19 13:50:54,232 DEBUG [] [GtdPollThread] = repeatEnabled:true
2025-06-19 13:50:54,232 DEBUG [] [GtdPollThread] = repeatRecords size:0

</pre>
}}
{{collapse(Часть лога)
<pre>
2025-06-19 13:50:54,087 DEBUG [] [PollThread] = find rule:DocTypeCode[docType=DocType{type='repimportedproduct_v4', num='46', ticketDocName='RepImportedProduct_v4'}, code=product] Rule[code=product, mode=WARNING, start=В документах ввода в оборот может быть указана только продукция, предварительно зарегистрированная во ФРАП и имеющая код ЕГАИС, reject=Продукция с кодами %s не зарегистрирована в ЕГАИС, confirm=Проверка пройдена]
2025-06-19 13:50:54,087 DEBUG [] [PollThread] = enter to checkLicense.
2025-06-19 13:50:54,087 DEBUG [] [PollThread] = selectFromNsiProducts [[1300004343080000007]]
2025-06-19 13:50:54,088 DEBUG [] [PollThread] = SELECT
  pt.code_egais AS ProductType_Code,
  p.alc_code,
  p.country_id AS Country_Code,
  p.importer_fsrar_id AS Importer_OwnerID,
  pt.product_group_code AS ProductVid_Code,
  p.is_unpacked AS isUnpacked,
  p.producer_fsrar_id AS Owner_ID
FROM
  "references".product_snapshot p
  INNER JOIN "references".product_type pt ON pt.id = p.product_type_id
WHERE
  alc_code IN (
?)
2025-06-19 13:50:54,098 DEBUG [] [PollThread] = finish selectFromNsiProducts. size:[0]
2025-06-19 13:50:54,105 DEBUG [] [PollThread] = warning:{}
ru.centerinform.svs.insp.doc.HandleException: Документ от организации 030000434308 номер 00018 с датой 2025-06-19. Код продукции 1300004343080000007 не найден в справочнике.
	at ru.centerinform.svs.insp.doc.checker.Checker.ex(Checker.java:635) ~[insp-3.27.0.jar:?]
	at ru.centerinform.svs.insp.doc.ri.RIHandler.checkAlcCodesQuantity(RIHandler.java:179) ~[insp-3.27.0.jar:?]
	at ru.centerinform.svs.insp.doc.ri.RIHandler.checkLicense(RIHandler.java:140) ~[insp-3.27.0.jar:?]
	at ru.centerinform.svs.insp.doc.ri.RIHandler.lambda$checkProduct$0(RIHandler.java:86) ~[insp-3.27.0.jar:?]
	at ru.centerinform.svs.insp.doc.checker.Checker.check(Checker.java:97) ~[insp-3.27.0.jar:?]
	at ru.centerinform.svs.insp.doc.ri.RIHandler.checkProduct(RIHandler.java:86) ~[insp-3.27.0.jar:?]
	at ru.centerinform.svs.insp.doc.ri.RIHandler.check(RIHandler.java:71) ~[insp-3.27.0.jar:?]
	at ru.centerinform.svs.insp.doc.ri.RIHandler.handle(RIHandler.java:50) ~[insp-3.27.0.jar:?]
	at ru.centerinform.svs.insp.InspMessageHandler.handleImpl(InspMessageHandler.java:99) ~[insp-3.27.0.jar:?]
	at ru.centerinform.svs.insp.InspMessageHandler.handle(InspMessageHandler.java:76) ~[insp-3.27.0.jar:?]
	at ru.centerinform.svs.insp.kafka.Consumption.poll0(Consumption.java:223) ~[insp-3.27.0.jar:?]
	at ru.centerinform.svs.insp.kafka.Consumption.poll(Consumption.java:93) ~[insp-3.27.0.jar:?]
	at ru.centerinform.svs.insp.kafka.PollThread.run(PollThread.java:121) ~[insp-3.27.0.jar:?]
2025-06-19 13:50:54,105 DEBUG [] [PollThread] = checkcUnionMembership [112] 
2025-06-19 13:50:54,105 DEBUG [] [PollThread] = SELECT 1
FROM
  subref.country_unions_lnk cul
  JOIN subref.country_unions cu ON cu.id = cul.country_unions_id
  AND cu.code = 'ЕАЭС'
WHERE
  cul.country_code = ?

2025-06-19 13:50:54,130 DEBUG [] [PollThread] = gen:IMP-0000000042
2025-06-19 13:50:54,132 DEBUG [] [PollThread] = Success
2025-06-19 13:50:54,133 DEBUG [] [PollThread] = Create ticket
2025-06-19 13:50:54,136 DEBUG [] [PollThread] = docUri:030000434308-6635f0eb-d36a-4982-90e2-a1fb1175e542
2025-06-19 13:50:54,136 DEBUG [] [PollThread] = date:2025-06-19T13:50:54.136778978
2025-06-19 13:50:54,138 DEBUG [] [PollThread] = ticketUri:030000434308-9ad7afaf-f58a-4fd7-808e-4fcbf77248de
2025-06-19 13:50:54,138 DEBUG [] [PollThread] = xmlTransportId:030000434308-6635f0eb-d36a-4982-90e2-a1fb1175e542
2025-06-19 13:50:54,138 DEBUG [] [PollThread] = set warning comments: Продукция с кодами 1300004343080000007 не зарегистрирована в ЕГАИС
2025-06-19 13:50:54,139 DEBUG [] [PollThread] = templatePath:xml/ticket.xml
2025-06-19 13:50:54,149 DEBUG [] [PollThread] = <?xml version="1.0" encoding="utf-8"?>
<ns:Documents xmlns:tc="http://fsrar.ru/WEGAIS/Ticket"
              xmlns:oref="http://fsrar.ru/WEGAIS/ClientRef"
              xmlns:ns="http://fsrar.ru/WEGAIS/WB_DOC_SINGLE_01"
              xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
              Version="1.0">
    <ns:Owner>
        <ns:FSRAR_ID>3463047</ns:FSRAR_ID>
    </ns:Owner>
    <ns:Document>
        <ns:Ticket>
            <tc:TicketDate>2025-06-19T13:50:54.136</tc:TicketDate>
            <tc:Identity>00018</tc:Identity>
            <tc:DocId></tc:DocId>
            <tc:TransportId>030000434308-6635f0eb-d36a-4982-90e2-a1fb1175e542</tc:TransportId>
            <tc:RegID>IMP-0000000042</tc:RegID>
            <tc:DocHash/>
            <tc:DocType>RepImportedProduct_v4</tc:DocType>
            <tc:Result>
                <tc:Conclusion>Accepted</tc:Conclusion>
                <tc:ConclusionDate>2025-06-19T13:50:54.136</tc:ConclusionDate>
                <tc:Comments>Документ успешно принят системой на обработку. Продукция с кодами 1300004343080000007 не зарегистрирована в ЕГАИС</tc:Comments>
            </tc:Result>
        </ns:Ticket>
    </ns:Document>
</ns:Documents>

</pre>
}}
*Полученный результат: Проверка определилась, статус прохождения проверки проставился корректно, тикет успешный с предупреждением - УСПЕХ*
## error {{collapse(БД)
<pre>
|id |document_name_format |document_format_version|check_code|date_begin|date_end  |ordernum|service_code|check_action|
|---|---------------------|-----------------------|----------|----------|----------|--------|------------|------------|
|75 |repimportedproduct_v4|4                      |product   |2025-02-20|2050-02-20|5       |inspector   |error       |

</pre>
}}
{{collapse(Полный лог)
<pre>
2025-06-19 13:54:06,898 DEBUG [] [PollThread] = repeatEnabled:true
2025-06-19 13:54:06,898 DEBUG [] [PollThread] = repeatRecords size:0
2025-06-19 13:54:06,898 DEBUG [] [PollThread] = records is empty
2025-06-19 13:54:06,901 DEBUG [] [PollThread] = commitSync()
2025-06-19 13:54:07,174 DEBUG [] [PollThread] = poll:1
2025-06-19 13:54:07,174 DEBUG [] [PollThread] = consume. key:[null] value:[{"type":"repimportedproduct_v4","uri":"030000434308-6635f0eb-d36a-4982-90e2-a1fb1175e544","fsrarid":"030000434308","date":"2025-06-05","timezone":"+03:00","inn":"7841051711","kpp":""}] offset:[19302] topic:[confirmed])
2025-06-19 13:54:07,177 INFO [] [PollThread] = Start processing.
2025-06-19 13:54:07,229 DEBUG [] [PollThread] = Для получения файла используем БД
2025-06-19 13:54:07,230 DEBUG [] [PollThread] = Loading data by uri: 6635f0eb-d36a-4982-90e2-a1fb1175e544
2025-06-19 13:54:07,230 DEBUG [] [PollThread] = SELECT filedata FROM filedata.inboxdata
WHERE uri=?
ORDER BY id

2025-06-19 13:54:07,292 DEBUG [] [PollThread] = Doc type:DocType{type='repimportedproduct_v4', num='46', ticketDocName='RepImportedProduct_v4'} date:2025-06-19 number:00018
2025-06-19 13:54:07,292 DEBUG [] [PollThread] = 030000434308-6635f0eb-d36a-4982-90e2-a1fb1175e544
2025-06-19 13:54:07,293 DEBUG [] [PollThread] = Load:63 ms
2025-06-19 13:54:07,296 DEBUG [] [PollThread] = checkExist:repimportedproduct_v4
2025-06-19 13:54:07,305 DEBUG [] [PollThread] = find rule:DocTypeCode[docType=DocType{type='repimportedproduct_v4', num='46', ticketDocName='RepImportedProduct_v4'}, code=doubles] Rule[code=doubles, mode=ERROR, start=Проверка документа на повтор, reject=Документ с номером %s и датой %s уже зафиксирован в системе, confirm=Проверка пройдена]
2025-06-19 13:54:07,306 DEBUG [] [PollThread] = existRegistryDoc [030000434308] [repimportedproduct_v4] [00018] [2025-06-19]
2025-06-19 13:54:07,306 DEBUG [] [PollThread] = SELECT 1
FROM
  registry.documents
WHERE
  fsrarid = ?
  AND dtype = ?
  AND client_number = ?
  AND dt = ?
LIMIT 1

2025-06-19 13:54:07,313 DEBUG [] [PollThread] = 30000434308 repimportedproduct_v4 00018 2025-06-19
2025-06-19 13:54:07,320 DEBUG [] [PollThread] = docHash: fc72ecfd9fbfe9c13b65383651638cb6
2025-06-19 13:54:07,325 DEBUG [] [PollThread] = set docHash fc72ecfd9fbfe9c13b65383651638cb6 to redis
2025-06-19 13:54:07,325 DEBUG [] [PollThread] = checkDayShift:repimportedproduct_v4
2025-06-19 13:54:07,325 DEBUG [] [PollThread] = find rule:DocTypeCode[docType=DocType{type='repimportedproduct_v4', num='46', ticketDocName='RepImportedProduct_v4'}, code=daterange] Rule[code=daterange, mode=SKIP, start=Дата, указанная отправителем в документе, может отличаться от даты подачи документа в ЕГАИС на три дня в большую или меньшую сторону (с учетом часовых поясов), reject=Дата документа (%s) отличается от текущей более чем на три дня, confirm=Проверка пройдена]
2025-06-19 13:54:07,325 DEBUG [] [PollThread] = skip:daterange
2025-06-19 13:54:07,325 DEBUG [] [PollThread] = docDate:2025-06-19 
2025-06-19 13:54:07,327 DEBUG [] [PollThread] = importedDate:2025-06-19 
2025-06-19 13:54:07,327 DEBUG [] [PollThread] = betweenDays:0
2025-06-19 13:54:07,327 DEBUG [] [PollThread] = checkShipper:repimportedproduct_v4
2025-06-19 13:54:07,328 DEBUG [] [PollThread] = find rule:DocTypeCode[docType=DocType{type='repimportedproduct_v4', num='46', ticketDocName='RepImportedProduct_v4'}, code=senderproducer] Rule[code=senderproducer, mode=ERROR, start=Отправитель отчета о производстве должен совпадать с производителем продукции, указанным в документе., reject=СИО отправителя документа не соответствует СИО производителя продукции, confirm=Проверка пройдена]
2025-06-19 13:54:07,328 DEBUG [] [PollThread] = checkQuantityFormat:DocType{type='repimportedproduct_v4', num='46', ticketDocName='RepImportedProduct_v4'}
2025-06-19 13:54:07,328 DEBUG [] [PollThread] = find rule:DocTypeCode[docType=DocType{type='repimportedproduct_v4', num='46', ticketDocName='RepImportedProduct_v4'}, code=quantity] Rule[code=quantity, mode=WARNING, start=Количество должно быть больше нуля, если значение «isUnpacked» - «0», проверяем что Quantity - целое число, reject=Значение количества продукции с кодом %s не соответствует формату, confirm=Проверка пройдена]
2025-06-19 13:54:07,329 DEBUG [] [PollThread] = find rule:DocTypeCode[docType=DocType{type='repimportedproduct_v4', num='46', ticketDocName='RepImportedProduct_v4'}, code=product] Rule[code=product, mode=ERROR, start=В документах ввода в оборот может быть указана только продукция, предварительно зарегистрированная во ФРАП и имеющая код ЕГАИС, reject=Продукция с кодами %s не зарегистрирована в ЕГАИС, confirm=Проверка пройдена]
2025-06-19 13:54:07,329 DEBUG [] [PollThread] = enter to checkLicense.
2025-06-19 13:54:07,329 DEBUG [] [PollThread] = selectFromNsiProducts [[1300004343080000007]]
2025-06-19 13:54:07,329 DEBUG [] [PollThread] = SELECT
  pt.code_egais AS ProductType_Code,
  p.alc_code,
  p.country_id AS Country_Code,
  p.importer_fsrar_id AS Importer_OwnerID,
  pt.product_group_code AS ProductVid_Code,
  p.is_unpacked AS isUnpacked,
  p.producer_fsrar_id AS Owner_ID
FROM
  "references".product_snapshot p
  INNER JOIN "references".product_type pt ON pt.id = p.product_type_id
WHERE
  alc_code IN (
?)
2025-06-19 13:54:07,339 DEBUG [] [PollThread] = finish selectFromNsiProducts. size:[0]
2025-06-19 13:54:07,340 DEBUG [] [PollThread] = error:{}
ru.centerinform.svs.insp.doc.HandleException: Документ от организации 030000434308 номер 00018 с датой 2025-06-19. Код продукции 1300004343080000007 не найден в справочнике.
	at ru.centerinform.svs.insp.doc.checker.Checker.ex(Checker.java:635) ~[insp-3.27.0.jar:?]
	at ru.centerinform.svs.insp.doc.ri.RIHandler.checkAlcCodesQuantity(RIHandler.java:179) ~[insp-3.27.0.jar:?]
	at ru.centerinform.svs.insp.doc.ri.RIHandler.checkLicense(RIHandler.java:140) ~[insp-3.27.0.jar:?]
	at ru.centerinform.svs.insp.doc.ri.RIHandler.lambda$checkProduct$0(RIHandler.java:86) ~[insp-3.27.0.jar:?]
	at ru.centerinform.svs.insp.doc.checker.Checker.check(Checker.java:109) ~[insp-3.27.0.jar:?]
	at ru.centerinform.svs.insp.doc.ri.RIHandler.checkProduct(RIHandler.java:86) ~[insp-3.27.0.jar:?]
	at ru.centerinform.svs.insp.doc.ri.RIHandler.check(RIHandler.java:71) ~[insp-3.27.0.jar:?]
	at ru.centerinform.svs.insp.doc.ri.RIHandler.handle(RIHandler.java:50) ~[insp-3.27.0.jar:?]
	at ru.centerinform.svs.insp.InspMessageHandler.handleImpl(InspMessageHandler.java:99) ~[insp-3.27.0.jar:?]
	at ru.centerinform.svs.insp.InspMessageHandler.handle(InspMessageHandler.java:76) ~[insp-3.27.0.jar:?]
	at ru.centerinform.svs.insp.kafka.Consumption.poll0(Consumption.java:223) ~[insp-3.27.0.jar:?]
	at ru.centerinform.svs.insp.kafka.Consumption.poll(Consumption.java:93) ~[insp-3.27.0.jar:?]
	at ru.centerinform.svs.insp.kafka.PollThread.run(PollThread.java:121) ~[insp-3.27.0.jar:?]
2025-06-19 13:54:07,340 ERROR [] [PollThread] = handle error
ru.centerinform.svs.insp.doc.HandleException: Документ от организации 030000434308 номер 00018 с датой 2025-06-19. Код продукции 1300004343080000007 не найден в справочнике.
	at ru.centerinform.svs.insp.doc.checker.Checker.ex(Checker.java:635) ~[insp-3.27.0.jar:?]
	at ru.centerinform.svs.insp.doc.ri.RIHandler.checkAlcCodesQuantity(RIHandler.java:179) ~[insp-3.27.0.jar:?]
	at ru.centerinform.svs.insp.doc.ri.RIHandler.checkLicense(RIHandler.java:140) ~[insp-3.27.0.jar:?]
	at ru.centerinform.svs.insp.doc.ri.RIHandler.lambda$checkProduct$0(RIHandler.java:86) ~[insp-3.27.0.jar:?]
	at ru.centerinform.svs.insp.doc.checker.Checker.check(Checker.java:109) ~[insp-3.27.0.jar:?]
	at ru.centerinform.svs.insp.doc.ri.RIHandler.checkProduct(RIHandler.java:86) ~[insp-3.27.0.jar:?]
	at ru.centerinform.svs.insp.doc.ri.RIHandler.check(RIHandler.java:71) ~[insp-3.27.0.jar:?]
	at ru.centerinform.svs.insp.doc.ri.RIHandler.handle(RIHandler.java:50) ~[insp-3.27.0.jar:?]
	at ru.centerinform.svs.insp.InspMessageHandler.handleImpl(InspMessageHandler.java:99) ~[insp-3.27.0.jar:?]
	at ru.centerinform.svs.insp.InspMessageHandler.handle(InspMessageHandler.java:76) ~[insp-3.27.0.jar:?]
	at ru.centerinform.svs.insp.kafka.Consumption.poll0(Consumption.java:223) ~[insp-3.27.0.jar:?]
	at ru.centerinform.svs.insp.kafka.Consumption.poll(Consumption.java:93) ~[insp-3.27.0.jar:?]
	at ru.centerinform.svs.insp.kafka.PollThread.run(PollThread.java:121) ~[insp-3.27.0.jar:?]
2025-06-19 13:54:07,341 ERROR [] [PollThread] = Fail
ru.centerinform.svs.insp.doc.HandleException: Документ от организации 030000434308 номер 00018 с датой 2025-06-19. Код продукции 1300004343080000007 не найден в справочнике.
	at ru.centerinform.svs.insp.doc.checker.Checker.ex(Checker.java:635) ~[insp-3.27.0.jar:?]
	at ru.centerinform.svs.insp.doc.ri.RIHandler.checkAlcCodesQuantity(RIHandler.java:179) ~[insp-3.27.0.jar:?]
	at ru.centerinform.svs.insp.doc.ri.RIHandler.checkLicense(RIHandler.java:140) ~[insp-3.27.0.jar:?]
	at ru.centerinform.svs.insp.doc.ri.RIHandler.lambda$checkProduct$0(RIHandler.java:86) ~[insp-3.27.0.jar:?]
	at ru.centerinform.svs.insp.doc.checker.Checker.check(Checker.java:109) ~[insp-3.27.0.jar:?]
	at ru.centerinform.svs.insp.doc.ri.RIHandler.checkProduct(RIHandler.java:86) ~[insp-3.27.0.jar:?]
	at ru.centerinform.svs.insp.doc.ri.RIHandler.check(RIHandler.java:71) ~[insp-3.27.0.jar:?]
	at ru.centerinform.svs.insp.doc.ri.RIHandler.handle(RIHandler.java:50) ~[insp-3.27.0.jar:?]
	at ru.centerinform.svs.insp.InspMessageHandler.handleImpl(InspMessageHandler.java:99) ~[insp-3.27.0.jar:?]
	at ru.centerinform.svs.insp.InspMessageHandler.handle(InspMessageHandler.java:76) ~[insp-3.27.0.jar:?]
	at ru.centerinform.svs.insp.kafka.Consumption.poll0(Consumption.java:223) ~[insp-3.27.0.jar:?]
	at ru.centerinform.svs.insp.kafka.Consumption.poll(Consumption.java:93) ~[insp-3.27.0.jar:?]
	at ru.centerinform.svs.insp.kafka.PollThread.run(PollThread.java:121) ~[insp-3.27.0.jar:?]
2025-06-19 13:54:07,341 DEBUG [] [PollThread] = Remove docHash:fc72ecfd9fbfe9c13b65383651638cb6 from redis cache
2025-06-19 13:54:07,367 DEBUG [] [PollThread] = docUri:030000434308-6635f0eb-d36a-4982-90e2-a1fb1175e544
2025-06-19 13:54:07,368 DEBUG [] [PollThread] = date:2025-06-19T13:54:07.367683374
2025-06-19 13:54:07,372 DEBUG [] [PollThread] = ticketUri:030000434308-53337429-832d-491e-b3de-3037fbcc8efc
2025-06-19 13:54:07,372 DEBUG [] [PollThread] = xmlTransportId:030000434308-6635f0eb-d36a-4982-90e2-a1fb1175e544
2025-06-19 13:54:07,372 DEBUG [] [PollThread] = set comments: Продукция с кодами 1300004343080000007 не зарегистрирована в ЕГАИС
2025-06-19 13:54:07,372 DEBUG [] [PollThread] = templatePath:xml/ticket.xml
2025-06-19 13:54:07,390 DEBUG [] [PollThread] = <?xml version="1.0" encoding="utf-8"?>
<ns:Documents xmlns:tc="http://fsrar.ru/WEGAIS/Ticket"
              xmlns:oref="http://fsrar.ru/WEGAIS/ClientRef"
              xmlns:ns="http://fsrar.ru/WEGAIS/WB_DOC_SINGLE_01"
              xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
              Version="1.0">
    <ns:Owner>
        <ns:FSRAR_ID>3463047</ns:FSRAR_ID>
    </ns:Owner>
    <ns:Document>
        <ns:Ticket>
            <tc:TicketDate>2025-06-19T13:54:07.367</tc:TicketDate>
            <tc:Identity>00018</tc:Identity>
            <tc:DocId></tc:DocId>
            <tc:TransportId>030000434308-6635f0eb-d36a-4982-90e2-a1fb1175e544</tc:TransportId>
            <tc:RegID></tc:RegID>
            <tc:DocHash/>
            <tc:DocType>RepImportedProduct_v4</tc:DocType>
            <tc:Result>
                <tc:Conclusion>Rejected</tc:Conclusion>
                <tc:ConclusionDate></tc:ConclusionDate>
                <tc:Comments>Продукция с кодами 1300004343080000007 не зарегистрирована в ЕГАИС</tc:Comments>
            </tc:Result>
        </ns:Ticket>
    </ns:Document>
</ns:Documents>


2025-06-19 13:54:07,390 DEBUG [] [PollThread] = Для сохранения квитанции используем БД
2025-06-19 13:54:07,395 DEBUG [] [PollThread] = save ticket to DB: Ticket{xml='<?xml version="1.0" encoding="utf-8"?>
<ns:Documents xmlns:tc="http://fsrar.ru/WEGAIS/Ticket"
              xmlns:oref="http://fsrar.ru/WEGAIS/ClientRef"
              xmlns:ns="http://fsrar.ru/WEGAIS/WB_DOC_SINGLE_01"
              xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
              Version="1.0">
    <ns:Owner>
        <ns:FSRAR_ID>3463047</ns:FSRAR_ID>
    </ns:Owner>
    <ns:Document>
        <ns:Ticket>
            <tc:TicketDate>2025-06-19T13:54:07.367</tc:TicketDate>
            <tc:Identity>00018</tc:Identity>
            <tc:DocId></tc:DocId>
            <tc:TransportId>030000434308-6635f0eb-d36a-4982-90e2-a1fb1175e544</tc:TransportId>
            <tc:RegID></tc:RegID>
            <tc:DocHash/>
            <tc:DocType>RepImportedProduct_v4</tc:DocType>
            <tc:Result>
                <tc:Conclusion>Rejected</tc:Conclusion>
                <tc:ConclusionDate></tc:ConclusionDate>
                <tc:Comments>Продукция с кодами 1300004343080000007 не зарегистрирована в ЕГАИС</tc:Comments>
            </tc:Result>
        </ns:Ticket>
    </ns:Document>
</ns:Documents>

', nowDateTime=2025-06-19T13:54:07.367683374, ticketDate='2025-06-19', ticketDateTime='2025-06-19T13:54:07.367', docUri='030000434308-6635f0eb-d36a-4982-90e2-a1fb1175e544', ticketUri='030000434308-53337429-832d-491e-b3de-3037fbcc8efc', ticketUUID='53337429-832d-491e-b3de-3037fbcc8efc', fsrarId='030000434308', identity='00018', templater=ru.centerinform.svs.insp.Templater@1c711787, type=DocType{type='repimportedproduct_v4', num='46', ticketDocName='RepImportedProduct_v4'}}
2025-06-19 13:54:07,395 DEBUG [] [PollThread] = INSERT INTO filedata.outboxdata
    (uri, inboxuri, filedata)
    VALUES(?, ?, ?)

2025-06-19 13:54:07,396 DEBUG [] [PollThread] = 53337429-832d-491e-b3de-3037fbcc8efc 6635f0eb-d36a-4982-90e2-a1fb1175e544 <?xml version="1.0" encoding="utf-8"?>
<ns:Documents xmlns:tc="http://fsrar.ru/WEGAIS/Ticket"
              xmlns:oref="http://fsrar.ru/WEGAIS/ClientRef"
              xmlns:ns="http://fsrar.ru/WEGAIS/WB_DOC_SINGLE_01"
              xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
              Version="1.0">
    <ns:Owner>
        <ns:FSRAR_ID>3463047</ns:FSRAR_ID>
    </ns:Owner>
    <ns:Document>
        <ns:Ticket>
            <tc:TicketDate>2025-06-19T13:54:07.367</tc:TicketDate>
            <tc:Identity>00018</tc:Identity>
            <tc:DocId></tc:DocId>
            <tc:TransportId>030000434308-6635f0eb-d36a-4982-90e2-a1fb1175e544</tc:TransportId>
            <tc:RegID></tc:RegID>
            <tc:DocHash/>
            <tc:DocType>RepImportedProduct_v4</tc:DocType>
            <tc:Result>
                <tc:Conclusion>Rejected</tc:Conclusion>
                <tc:ConclusionDate></tc:ConclusionDate>
                <tc:Comments>Продукция с кодами 1300004343080000007 не зарегистрирована в ЕГАИС</tc:Comments>
            </tc:Result>
        </ns:Ticket>
    </ns:Document>
</ns:Documents>


2025-06-19 13:54:07,404 DEBUG [] [PollThread] = insert 1 rows
2025-06-19 13:54:07,404 DEBUG [] [PollThread] = INSERT INTO outbox.meta (dtype, fsrarid, uri, ts)
    VALUES (?, ?, ?, ?)

2025-06-19 13:54:07,406 DEBUG [] [PollThread] = ticket 30000434308 53337429-832d-491e-b3de-3037fbcc8efc 2025-06-19T13:54:07.367+0300
2025-06-19 13:54:07,412 DEBUG [] [PollThread] = insert 1 rows
2025-06-19 13:54:07,416 DEBUG [] [PollThread] = Fail finish
2025-06-19 13:54:07,416 INFO [] [PollThread] = End processing. 239 ms
2025-06-19 13:54:07,416 DEBUG [] [PollThread] = repeat()
2025-06-19 13:54:07,417 DEBUG [] [PollThread] = repeatEnabled:true
2025-06-19 13:54:07,417 DEBUG [] [PollThread] = repeatRecords size:0
2025-06-19 13:54:07,417 DEBUG [] [PollThread] = records is empty

</pre>
}}
{{collapse(Часть лога)
<pre>
2025-06-19 13:54:07,395 DEBUG [] [PollThread] = save ticket to DB: Ticket{xml='<?xml version="1.0" encoding="utf-8"?>
<ns:Documents xmlns:tc="http://fsrar.ru/WEGAIS/Ticket"
              xmlns:oref="http://fsrar.ru/WEGAIS/ClientRef"
              xmlns:ns="http://fsrar.ru/WEGAIS/WB_DOC_SINGLE_01"
              xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
              Version="1.0">
    <ns:Owner>
        <ns:FSRAR_ID>3463047</ns:FSRAR_ID>
    </ns:Owner>
    <ns:Document>
        <ns:Ticket>
            <tc:TicketDate>2025-06-19T13:54:07.367</tc:TicketDate>
            <tc:Identity>00018</tc:Identity>
            <tc:DocId></tc:DocId>
            <tc:TransportId>030000434308-6635f0eb-d36a-4982-90e2-a1fb1175e544</tc:TransportId>
            <tc:RegID></tc:RegID>
            <tc:DocHash/>
            <tc:DocType>RepImportedProduct_v4</tc:DocType>
            <tc:Result>
                <tc:Conclusion>Rejected</tc:Conclusion>
                <tc:ConclusionDate></tc:ConclusionDate>
                <tc:Comments>Продукция с кодами 1300004343080000007 не зарегистрирована в ЕГАИС</tc:Comments>
            </tc:Result>
        </ns:Ticket>
    </ns:Document>
</ns:Documents>

</pre>
}}
*Полученный результат: Проверка определилась, статус проверки определился корректно, проверка провалилась корректно с корректной ошибкой - УСПЕХ*
# quantity
## skip {{collapse(БД)
<pre>
|id |document_name_format |document_format_version|check_code|date_begin|date_end  |ordernum|service_code|check_action|
|---|---------------------|-----------------------|----------|----------|----------|--------|------------|------------|
|74 |repimportedproduct_v4|4                      |quantity  |2025-02-20|2050-02-20|4       |inspector   |skip        |

</pre>
}}
{{collapse(Полный лог)
<pre>
2025-06-19 14:00:18,162 DEBUG [] [GtdPollThread] = commitSync()
2025-06-19 14:00:19,024 DEBUG [] [PollThread] = poll:0
2025-06-19 14:00:19,024 DEBUG [] [PollThread] = repeat()
2025-06-19 14:00:19,024 DEBUG [] [PollThread] = repeatEnabled:true
2025-06-19 14:00:19,024 DEBUG [] [PollThread] = repeatRecords size:0
2025-06-19 14:00:19,024 DEBUG [] [PollThread] = records is empty
2025-06-19 14:00:19,027 DEBUG [] [PollThread] = commitSync()
2025-06-19 14:00:19,163 DEBUG [] [GtdPollThread] = poll:0
2025-06-19 14:00:19,163 DEBUG [] [GtdPollThread] = repeat()
2025-06-19 14:00:19,163 DEBUG [] [GtdPollThread] = repeatEnabled:true
2025-06-19 14:00:19,163 DEBUG [] [GtdPollThread] = repeatRecords size:0
2025-06-19 14:00:19,163 DEBUG [] [GtdPollThread] = records is empty
2025-06-19 14:00:19,166 DEBUG [] [GtdPollThread] = commitSync()
2025-06-19 14:00:19,504 DEBUG [] [PollThread] = poll:1
2025-06-19 14:00:19,504 DEBUG [] [PollThread] = consume. key:[null] value:[{"type":"repimportedproduct_v4","uri":"030000434308-6635f0eb-d36a-4982-90e2-a1fb1175e545","fsrarid":"030000434308","date":"2025-06-05","timezone":"+03:00","inn":"7841051711","kpp":""}] offset:[20744] topic:[confirmed])
2025-06-19 14:00:19,504 INFO [] [PollThread] = Start processing.
2025-06-19 14:00:19,578 DEBUG [] [PollThread] = Для получения файла используем БД
2025-06-19 14:00:19,579 DEBUG [] [PollThread] = Loading data by uri: 6635f0eb-d36a-4982-90e2-a1fb1175e545
2025-06-19 14:00:19,580 DEBUG [] [PollThread] = SELECT filedata FROM filedata.inboxdata
WHERE uri=?
ORDER BY id

2025-06-19 14:00:19,663 DEBUG [] [PollThread] = Doc type:DocType{type='repimportedproduct_v4', num='46', ticketDocName='RepImportedProduct_v4'} date:2025-06-19 number:00018
2025-06-19 14:00:19,663 DEBUG [] [PollThread] = 030000434308-6635f0eb-d36a-4982-90e2-a1fb1175e545
2025-06-19 14:00:19,663 DEBUG [] [PollThread] = Load:85 ms
2025-06-19 14:00:19,667 DEBUG [] [PollThread] = checkExist:repimportedproduct_v4
2025-06-19 14:00:19,676 DEBUG [] [PollThread] = find rule:DocTypeCode[docType=DocType{type='repimportedproduct_v4', num='46', ticketDocName='RepImportedProduct_v4'}, code=doubles] Rule[code=doubles, mode=ERROR, start=Проверка документа на повтор, reject=Документ с номером %s и датой %s уже зафиксирован в системе, confirm=Проверка пройдена]
2025-06-19 14:00:19,676 DEBUG [] [PollThread] = existRegistryDoc [030000434308] [repimportedproduct_v4] [00018] [2025-06-19]
2025-06-19 14:00:19,676 DEBUG [] [PollThread] = SELECT 1
FROM
  registry.documents
WHERE
  fsrarid = ?
  AND dtype = ?
  AND client_number = ?
  AND dt = ?
LIMIT 1

2025-06-19 14:00:19,889 DEBUG [] [PollThread] = 30000434308 repimportedproduct_v4 00018 2025-06-19
2025-06-19 14:00:19,896 DEBUG [] [PollThread] = docHash: fe90dfcb1ccb05d8c5263400a0b74d5e
2025-06-19 14:00:19,904 DEBUG [] [PollThread] = set docHash fe90dfcb1ccb05d8c5263400a0b74d5e to redis
2025-06-19 14:00:19,904 DEBUG [] [PollThread] = checkDayShift:repimportedproduct_v4
2025-06-19 14:00:19,905 DEBUG [] [PollThread] = find rule:DocTypeCode[docType=DocType{type='repimportedproduct_v4', num='46', ticketDocName='RepImportedProduct_v4'}, code=daterange] Rule[code=daterange, mode=SKIP, start=Дата, указанная отправителем в документе, может отличаться от даты подачи документа в ЕГАИС на три дня в большую или меньшую сторону (с учетом часовых поясов), reject=Дата документа (%s) отличается от текущей более чем на три дня, confirm=Проверка пройдена]
2025-06-19 14:00:19,905 DEBUG [] [PollThread] = skip:daterange
2025-06-19 14:00:19,905 DEBUG [] [PollThread] = docDate:2025-06-19 
2025-06-19 14:00:19,908 DEBUG [] [PollThread] = importedDate:2025-06-19 
2025-06-19 14:00:19,909 DEBUG [] [PollThread] = betweenDays:0
2025-06-19 14:00:19,909 DEBUG [] [PollThread] = checkShipper:repimportedproduct_v4
2025-06-19 14:00:19,909 DEBUG [] [PollThread] = find rule:DocTypeCode[docType=DocType{type='repimportedproduct_v4', num='46', ticketDocName='RepImportedProduct_v4'}, code=senderproducer] Rule[code=senderproducer, mode=ERROR, start=Отправитель отчета о производстве должен совпадать с производителем продукции, указанным в документе., reject=СИО отправителя документа не соответствует СИО производителя продукции, confirm=Проверка пройдена]
2025-06-19 14:00:19,909 DEBUG [] [PollThread] = checkQuantityFormat:DocType{type='repimportedproduct_v4', num='46', ticketDocName='RepImportedProduct_v4'}
2025-06-19 14:00:19,909 DEBUG [] [PollThread] = find rule:DocTypeCode[docType=DocType{type='repimportedproduct_v4', num='46', ticketDocName='RepImportedProduct_v4'}, code=quantity] Rule[code=quantity, mode=SKIP, start=Количество должно быть больше нуля, если значение «isUnpacked» - «0», проверяем что Quantity - целое число, reject=Значение количества продукции с кодом %s не соответствует формату, confirm=Проверка пройдена]
2025-06-19 14:00:19,909 DEBUG [] [PollThread] = skip:quantity
2025-06-19 14:00:19,910 DEBUG [] [PollThread] = find rule:DocTypeCode[docType=DocType{type='repimportedproduct_v4', num='46', ticketDocName='RepImportedProduct_v4'}, code=product] Rule[code=product, mode=WARNING, start=В документах ввода в оборот может быть указана только продукция, предварительно зарегистрированная во ФРАП и имеющая код ЕГАИС, reject=Продукция с кодами %s не зарегистрирована в ЕГАИС, confirm=Проверка пройдена]
2025-06-19 14:00:19,910 DEBUG [] [PollThread] = enter to checkLicense.
2025-06-19 14:00:19,910 DEBUG [] [PollThread] = selectFromNsiProducts [[0300004343080000007]]
2025-06-19 14:00:19,910 DEBUG [] [PollThread] = SELECT
  pt.code_egais AS ProductType_Code,
  p.alc_code,
  p.country_id AS Country_Code,
  p.importer_fsrar_id AS Importer_OwnerID,
  pt.product_group_code AS ProductVid_Code,
  p.is_unpacked AS isUnpacked,
  p.producer_fsrar_id AS Owner_ID
FROM
  "references".product_snapshot p
  INNER JOIN "references".product_type pt ON pt.id = p.product_type_id
WHERE
  alc_code IN (
?)
2025-06-19 14:00:19,922 DEBUG [] [PollThread] = finish selectFromNsiProducts. size:[1]
2025-06-19 14:00:19,922 DEBUG [] [PollThread] = isKfk() fsrarId = [030000434308]
2025-06-19 14:00:19,922 DEBUG [] [PollThread] = SELECT 1
FROM
  "references".org_snapshot t
WHERE
  t.fsrar_id = ?
  AND length(t.inn) <> 10

2025-06-19 14:00:19,927 DEBUG [] [PollThread] = result:false
2025-06-19 14:00:19,927 DEBUG [] [PollThread] = extp [[28015]]
2025-06-19 14:00:19,927 DEBUG [] [PollThread] =   SELECT
    ptp.code AS ExclusionType,
    pt.code_egais AS ProductType_Code
  FROM
    "references".product_type pt
    JOIN subref.product_type_props_lnk ptpl ON ptpl.product_type_id = pt.id
    JOIN subref.product_type_props ptp ON ptp.id = ptpl.product_type_props_id
  WHERE
    ptpl.is_active = true
    AND pt.code_egais IN  (
?)
2025-06-19 14:00:19,932 DEBUG [] [PollThread] = checkLic [[28015]]
2025-06-19 14:00:19,932 DEBUG [] [PollThread] = SELECT
  COUNT(ptpl.id) AS count_id
FROM
  "references".product_type pt
  JOIN subref.product_type_props_lnk ptpl ON ptpl.product_type_id = pt.id
  JOIN subref.product_type_props ptp ON ptp.id = ptpl.product_type_props_id
WHERE
  ptp.code = 'UnLicense'
  AND pt.code_egais IN (
?)
2025-06-19 14:00:19,937 DEBUG [] [PollThread] = productTypeCodes:1
2025-06-19 14:00:19,937 DEBUG [] [PollThread] = selectFromClientsPeriodLicense [030000434308], [2025-06-19]
2025-06-19 14:00:19,937 DEBUG [] [PollThread] = SELECT 1
FROM
  registries.registry r
WHERE
  r.fsrar_id = ?
  AND ? BETWEEN r.inclusion_date
  AND COALESCE(
    r.expiration_date, CURRENT_DATE + INTERVAL '30 days'
  )
  AND (
    r.row_validity_end IS NULL
    OR r.row_validity_end < CURRENT_TIMESTAMP
  )

2025-06-19 14:00:19,941 DEBUG [] [PollThread] = exist:true 
2025-06-19 14:00:19,942 DEBUG [] [PollThread] = enter to checkUnMarked
2025-06-19 14:00:19,943 ERROR [] [PollThread] = handle error
ru.centerinform.svs.insp.doc.HandleException: Документ от организации 030000434308 номер 00018 с датой 2025-06-19. Количество ФСМ не совпадает с количеством, указанным в позиции.
	at ru.centerinform.svs.insp.doc.checker.Checker.ex(Checker.java:635) ~[insp-3.27.0.jar:?]
	at ru.centerinform.svs.insp.doc.checker.Checker.checkActualQuantityPos(Checker.java:319) ~[insp-3.27.0.jar:?]
	at ru.centerinform.svs.insp.doc.checker.Checker.checkActualQuantity(Checker.java:304) ~[insp-3.27.0.jar:?]
	at ru.centerinform.svs.insp.doc.ri.RIHandler.check(RIHandler.java:73) ~[insp-3.27.0.jar:?]
	at ru.centerinform.svs.insp.doc.ri.RIHandler.handle(RIHandler.java:50) ~[insp-3.27.0.jar:?]
	at ru.centerinform.svs.insp.InspMessageHandler.handleImpl(InspMessageHandler.java:99) ~[insp-3.27.0.jar:?]
	at ru.centerinform.svs.insp.InspMessageHandler.handle(InspMessageHandler.java:76) ~[insp-3.27.0.jar:?]
	at ru.centerinform.svs.insp.kafka.Consumption.poll0(Consumption.java:223) ~[insp-3.27.0.jar:?]
	at ru.centerinform.svs.insp.kafka.Consumption.poll(Consumption.java:93) ~[insp-3.27.0.jar:?]
	at ru.centerinform.svs.insp.kafka.PollThread.run(PollThread.java:121) ~[insp-3.27.0.jar:?]
2025-06-19 14:00:19,960 ERROR [] [PollThread] = Fail
ru.centerinform.svs.insp.doc.HandleException: Документ от организации 030000434308 номер 00018 с датой 2025-06-19. Количество ФСМ не совпадает с количеством, указанным в позиции.
	at ru.centerinform.svs.insp.doc.checker.Checker.ex(Checker.java:635) ~[insp-3.27.0.jar:?]
	at ru.centerinform.svs.insp.doc.checker.Checker.checkActualQuantityPos(Checker.java:319) ~[insp-3.27.0.jar:?]
	at ru.centerinform.svs.insp.doc.checker.Checker.checkActualQuantity(Checker.java:304) ~[insp-3.27.0.jar:?]
	at ru.centerinform.svs.insp.doc.ri.RIHandler.check(RIHandler.java:73) ~[insp-3.27.0.jar:?]
	at ru.centerinform.svs.insp.doc.ri.RIHandler.handle(RIHandler.java:50) ~[insp-3.27.0.jar:?]
	at ru.centerinform.svs.insp.InspMessageHandler.handleImpl(InspMessageHandler.java:99) ~[insp-3.27.0.jar:?]
	at ru.centerinform.svs.insp.InspMessageHandler.handle(InspMessageHandler.java:76) ~[insp-3.27.0.jar:?]
	at ru.centerinform.svs.insp.kafka.Consumption.poll0(Consumption.java:223) ~[insp-3.27.0.jar:?]
	at ru.centerinform.svs.insp.kafka.Consumption.poll(Consumption.java:93) ~[insp-3.27.0.jar:?]
	at ru.centerinform.svs.insp.kafka.PollThread.run(PollThread.java:121) ~[insp-3.27.0.jar:?]
2025-06-19 14:00:19,960 DEBUG [] [PollThread] = Remove docHash:fe90dfcb1ccb05d8c5263400a0b74d5e from redis cache
2025-06-19 14:00:19,963 DEBUG [] [PollThread] = docUri:030000434308-6635f0eb-d36a-4982-90e2-a1fb1175e545
2025-06-19 14:00:19,963 DEBUG [] [PollThread] = date:2025-06-19T14:00:19.963369815
2025-06-19 14:00:19,964 DEBUG [] [PollThread] = ticketUri:030000434308-c7c44658-d086-4fe6-b34b-eebd1c5a2988
2025-06-19 14:00:19,964 DEBUG [] [PollThread] = xmlTransportId:030000434308-6635f0eb-d36a-4982-90e2-a1fb1175e545
2025-06-19 14:00:19,964 DEBUG [] [PollThread] = set comments: Документ от организации 030000434308 номер 00018 с датой 2025-06-19. Количество ФСМ не совпадает с количеством, указанным в позиции.
2025-06-19 14:00:19,965 DEBUG [] [PollThread] = templatePath:xml/ticket.xml
2025-06-19 14:00:19,981 DEBUG [] [PollThread] = <?xml version="1.0" encoding="utf-8"?>
<ns:Documents xmlns:tc="http://fsrar.ru/WEGAIS/Ticket"
              xmlns:oref="http://fsrar.ru/WEGAIS/ClientRef"
              xmlns:ns="http://fsrar.ru/WEGAIS/WB_DOC_SINGLE_01"
              xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
              Version="1.0">
    <ns:Owner>
        <ns:FSRAR_ID>3463047</ns:FSRAR_ID>
    </ns:Owner>
    <ns:Document>
        <ns:Ticket>
            <tc:TicketDate>2025-06-19T14:00:19.963</tc:TicketDate>
            <tc:Identity>00018</tc:Identity>
            <tc:DocId></tc:DocId>
            <tc:TransportId>030000434308-6635f0eb-d36a-4982-90e2-a1fb1175e545</tc:TransportId>
            <tc:RegID></tc:RegID>
            <tc:DocHash/>
            <tc:DocType>RepImportedProduct_v4</tc:DocType>
            <tc:Result>
                <tc:Conclusion>Rejected</tc:Conclusion>
                <tc:ConclusionDate></tc:ConclusionDate>
                <tc:Comments>Документ от организации 030000434308 номер 00018 с датой 2025-06-19. Количество ФСМ не совпадает с количеством, указанным в позиции.</tc:Comments>
            </tc:Result>
        </ns:Ticket>
    </ns:Document>
</ns:Documents>


2025-06-19 14:00:19,981 DEBUG [] [PollThread] = Для сохранения квитанции используем БД
2025-06-19 14:00:19,984 DEBUG [] [PollThread] = save ticket to DB: Ticket{xml='<?xml version="1.0" encoding="utf-8"?>
<ns:Documents xmlns:tc="http://fsrar.ru/WEGAIS/Ticket"
              xmlns:oref="http://fsrar.ru/WEGAIS/ClientRef"
              xmlns:ns="http://fsrar.ru/WEGAIS/WB_DOC_SINGLE_01"
              xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
              Version="1.0">
    <ns:Owner>
        <ns:FSRAR_ID>3463047</ns:FSRAR_ID>
    </ns:Owner>
    <ns:Document>
        <ns:Ticket>
            <tc:TicketDate>2025-06-19T14:00:19.963</tc:TicketDate>
            <tc:Identity>00018</tc:Identity>
            <tc:DocId></tc:DocId>
            <tc:TransportId>030000434308-6635f0eb-d36a-4982-90e2-a1fb1175e545</tc:TransportId>
            <tc:RegID></tc:RegID>
            <tc:DocHash/>
            <tc:DocType>RepImportedProduct_v4</tc:DocType>
            <tc:Result>
                <tc:Conclusion>Rejected</tc:Conclusion>
                <tc:ConclusionDate></tc:ConclusionDate>
                <tc:Comments>Документ от организации 030000434308 номер 00018 с датой 2025-06-19. Количество ФСМ не совпадает с количеством, указанным в позиции.</tc:Comments>
            </tc:Result>
        </ns:Ticket>
    </ns:Document>
</ns:Documents>

', nowDateTime=2025-06-19T14:00:19.963369815, ticketDate='2025-06-19', ticketDateTime='2025-06-19T14:00:19.963', docUri='030000434308-6635f0eb-d36a-4982-90e2-a1fb1175e545', ticketUri='030000434308-c7c44658-d086-4fe6-b34b-eebd1c5a2988', ticketUUID='c7c44658-d086-4fe6-b34b-eebd1c5a2988', fsrarId='030000434308', identity='00018', templater=ru.centerinform.svs.insp.Templater@76c6e2fc, type=DocType{type='repimportedproduct_v4', num='46', ticketDocName='RepImportedProduct_v4'}}
2025-06-19 14:00:19,984 DEBUG [] [PollThread] = INSERT INTO filedata.outboxdata
    (uri, inboxuri, filedata)
    VALUES(?, ?, ?)

2025-06-19 14:00:19,984 DEBUG [] [PollThread] = c7c44658-d086-4fe6-b34b-eebd1c5a2988 6635f0eb-d36a-4982-90e2-a1fb1175e545 <?xml version="1.0" encoding="utf-8"?>
<ns:Documents xmlns:tc="http://fsrar.ru/WEGAIS/Ticket"
              xmlns:oref="http://fsrar.ru/WEGAIS/ClientRef"
              xmlns:ns="http://fsrar.ru/WEGAIS/WB_DOC_SINGLE_01"
              xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
              Version="1.0">
    <ns:Owner>
        <ns:FSRAR_ID>3463047</ns:FSRAR_ID>
    </ns:Owner>
    <ns:Document>
        <ns:Ticket>
            <tc:TicketDate>2025-06-19T14:00:19.963</tc:TicketDate>
            <tc:Identity>00018</tc:Identity>
            <tc:DocId></tc:DocId>
            <tc:TransportId>030000434308-6635f0eb-d36a-4982-90e2-a1fb1175e545</tc:TransportId>
            <tc:RegID></tc:RegID>
            <tc:DocHash/>
            <tc:DocType>RepImportedProduct_v4</tc:DocType>
            <tc:Result>
                <tc:Conclusion>Rejected</tc:Conclusion>
                <tc:ConclusionDate></tc:ConclusionDate>
                <tc:Comments>Документ от организации 030000434308 номер 00018 с датой 2025-06-19. Количество ФСМ не совпадает с количеством, указанным в позиции.</tc:Comments>
            </tc:Result>
        </ns:Ticket>
    </ns:Document>
</ns:Documents>


2025-06-19 14:00:19,990 DEBUG [] [PollThread] = insert 1 rows
2025-06-19 14:00:19,990 DEBUG [] [PollThread] = INSERT INTO outbox.meta (dtype, fsrarid, uri, ts)
    VALUES (?, ?, ?, ?)

2025-06-19 14:00:19,991 DEBUG [] [PollThread] = ticket 30000434308 c7c44658-d086-4fe6-b34b-eebd1c5a2988 2025-06-19T14:00:19.963+0300
2025-06-19 14:00:19,997 DEBUG [] [PollThread] = insert 1 rows
2025-06-19 14:00:20,001 DEBUG [] [PollThread] = Fail finish
2025-06-19 14:00:20,001 INFO [] [PollThread] = End processing. 497 ms
2025-06-19 14:00:20,001 DEBUG [] [PollThread] = repeat()
2025-06-19 14:00:20,001 DEBUG [] [PollThread] = repeatEnabled:true
2025-06-19 14:00:20,001 DEBUG [] [PollThread] = repeatRecords size:0

</pre>
}}
{{collapse(Часть лога)
<pre>
2025-06-19 14:00:19,909 DEBUG [] [PollThread] = checkQuantityFormat:DocType{type='repimportedproduct_v4', num='46', ticketDocName='RepImportedProduct_v4'}
2025-06-19 14:00:19,909 DEBUG [] [PollThread] = find rule:DocTypeCode[docType=DocType{type='repimportedproduct_v4', num='46', ticketDocName='RepImportedProduct_v4'}, code=quantity] Rule[code=quantity, mode=SKIP, start=Количество должно быть больше нуля, если значение «isUnpacked» - «0», проверяем что Quantity - целое число, reject=Значение количества продукции с кодом %s не соответствует формату, confirm=Проверка пройдена]
2025-06-19 14:00:19,909 DEBUG [] [PollThread] = skip:quantity

</pre>
}}
*Полученный результат: Пока не очень понятно как воспроизвести именно эту проверку. Так как она перекрывается другой проверкой по тэгу Quantity*
## warn {{collapse(БД)
<pre>
|id |document_name_format |document_format_version|check_code|date_begin|date_end  |ordernum|service_code|check_action|
|---|---------------------|-----------------------|----------|----------|----------|--------|------------|------------|
|74 |repimportedproduct_v4|4                      |quantity  |2025-02-20|2050-02-20|4       |inspector   |warning     |

</pre>
}}
{{collapse(Полный лог)
<pre>
2025-06-19 14:02:40,394 DEBUG [] [PollThread] = commitSync()
2025-06-19 14:02:40,915 INFO [] [PollThread] = [Consumer clientId=consumer-insp-0-1, groupId=insp-0] Successfully joined group with generation Generation{generationId=211, memberId='consumer-insp-0-1-baa06610-0819-44a9-b558-59ff55d75d53', protocol='range'}
2025-06-19 14:02:40,915 INFO [] [GtdPollThread] = [Consumer clientId=consumer-insp-0-2, groupId=insp-0] Successfully joined group with generation Generation{generationId=211, memberId='consumer-insp-0-2-62cc9a81-be31-415c-8ef0-78022805f3ce', protocol='range'}
2025-06-19 14:02:41,390 DEBUG [] [GtdPollThread] = poll:0
2025-06-19 14:02:41,390 DEBUG [] [GtdPollThread] = repeat()
2025-06-19 14:02:41,390 DEBUG [] [GtdPollThread] = repeatEnabled:true
2025-06-19 14:02:41,390 DEBUG [] [GtdPollThread] = repeatRecords size:0
2025-06-19 14:02:41,390 DEBUG [] [GtdPollThread] = records is empty
2025-06-19 14:02:41,390 DEBUG [] [GtdPollThread] = commitSync()
2025-06-19 14:02:42,390 DEBUG [] [GtdPollThread] = poll:0
2025-06-19 14:02:42,390 DEBUG [] [GtdPollThread] = repeat()
2025-06-19 14:02:42,390 DEBUG [] [GtdPollThread] = repeatEnabled:true
2025-06-19 14:02:42,390 DEBUG [] [GtdPollThread] = repeatRecords size:0
2025-06-19 14:02:42,390 DEBUG [] [GtdPollThread] = records is empty
2025-06-19 14:02:42,390 DEBUG [] [GtdPollThread] = commitSync()
2025-06-19 14:02:43,390 DEBUG [] [GtdPollThread] = poll:0
2025-06-19 14:02:43,390 DEBUG [] [GtdPollThread] = repeat()
2025-06-19 14:02:43,390 DEBUG [] [GtdPollThread] = repeatEnabled:true
2025-06-19 14:02:43,390 DEBUG [] [GtdPollThread] = repeatRecords size:0
2025-06-19 14:02:43,390 DEBUG [] [GtdPollThread] = records is empty
2025-06-19 14:02:43,390 DEBUG [] [GtdPollThread] = commitSync()
2025-06-19 14:02:44,391 DEBUG [] [GtdPollThread] = poll:0
2025-06-19 14:02:44,391 DEBUG [] [GtdPollThread] = repeat()
2025-06-19 14:02:44,391 DEBUG [] [GtdPollThread] = repeatEnabled:true
2025-06-19 14:02:44,391 DEBUG [] [GtdPollThread] = repeatRecords size:0
2025-06-19 14:02:44,391 DEBUG [] [GtdPollThread] = records is empty
2025-06-19 14:02:44,391 DEBUG [] [GtdPollThread] = commitSync()
2025-06-19 14:02:45,391 DEBUG [] [GtdPollThread] = poll:0
2025-06-19 14:02:45,391 DEBUG [] [GtdPollThread] = repeat()
2025-06-19 14:02:45,391 DEBUG [] [GtdPollThread] = repeatEnabled:true
2025-06-19 14:02:45,391 DEBUG [] [GtdPollThread] = repeatRecords size:0
2025-06-19 14:02:45,391 DEBUG [] [GtdPollThread] = records is empty
2025-06-19 14:02:45,391 DEBUG [] [GtdPollThread] = commitSync()
2025-06-19 14:02:45,948 INFO [] [PollThread] = [Consumer clientId=consumer-insp-0-1, groupId=insp-0] Finished assignment for group at generation 211: {consumer-insp-0-2-62cc9a81-be31-415c-8ef0-78022805f3ce=Assignment(partitions=[test-smev-leveler-out-response-0]), consumer-insp-0-1-baa06610-0819-44a9-b558-59ff55d75d53=Assignment(partitions=[confirmed-0])}
2025-06-19 14:02:45,951 DEBUG [] [PollThread] = poll:0
2025-06-19 14:02:45,951 DEBUG [] [PollThread] = repeat()
2025-06-19 14:02:45,951 DEBUG [] [PollThread] = repeatEnabled:true
2025-06-19 14:02:45,951 DEBUG [] [PollThread] = repeatRecords size:0
2025-06-19 14:02:45,951 DEBUG [] [PollThread] = records is empty
2025-06-19 14:02:45,951 DEBUG [] [PollThread] = commitSync()
2025-06-19 14:02:45,953 INFO [] [PollThread] = [Consumer clientId=consumer-insp-0-1, groupId=insp-0] Successfully synced group in generation Generation{generationId=211, memberId='consumer-insp-0-1-baa06610-0819-44a9-b558-59ff55d75d53', protocol='range'}
2025-06-19 14:02:45,953 INFO [] [PollThread] = [Consumer clientId=consumer-insp-0-1, groupId=insp-0] Notifying assignor about the new Assignment(partitions=[confirmed-0])
2025-06-19 14:02:45,953 INFO [] [GtdPollThread] = [Consumer clientId=consumer-insp-0-2, groupId=insp-0] Successfully synced group in generation Generation{generationId=211, memberId='consumer-insp-0-2-62cc9a81-be31-415c-8ef0-78022805f3ce', protocol='range'}
2025-06-19 14:02:45,954 INFO [] [GtdPollThread] = [Consumer clientId=consumer-insp-0-2, groupId=insp-0] Notifying assignor about the new Assignment(partitions=[test-smev-leveler-out-response-0])
2025-06-19 14:02:45,954 INFO [] [PollThread] = [Consumer clientId=consumer-insp-0-1, groupId=insp-0] Adding newly assigned partitions: confirmed-0
2025-06-19 14:02:45,954 INFO [] [GtdPollThread] = [Consumer clientId=consumer-insp-0-2, groupId=insp-0] Adding newly assigned partitions: test-smev-leveler-out-response-0
2025-06-19 14:02:45,961 INFO [] [PollThread] = [Consumer clientId=consumer-insp-0-1, groupId=insp-0] Setting offset for partition confirmed-0 to the committed offset FetchPosition{offset=20745, offsetEpoch=Optional[53], currentLeader=LeaderAndEpoch{leader=Optional[test-kafka2.fsrar.ru:9092 (id: 1 rack: null)], epoch=53}}
2025-06-19 14:02:45,961 INFO [] [GtdPollThread] = [Consumer clientId=consumer-insp-0-2, groupId=insp-0] Setting offset for partition test-smev-leveler-out-response-0 to the committed offset FetchPosition{offset=99322, offsetEpoch=Optional[8], currentLeader=LeaderAndEpoch{leader=Optional[test-kafka1.fsrar.ru:9092 (id: 0 rack: null)], epoch=8}}
2025-06-19 14:02:46,003 DEBUG [] [PollThread] = poll:2
2025-06-19 14:02:46,003 DEBUG [] [PollThread] = consume. key:[null] value:[{"type":"repimportedproduct_v4","uri":"030000434308-6635f0eb-d36a-4982-90e2-a1fb1175e546","fsrarid":"030000434308","date":"2025-06-05","timezone":"+03:00","inn":"7841051711","kpp":""}] offset:[20745] topic:[confirmed])
2025-06-19 14:02:46,020 INFO [] [PollThread] = Start processing.
2025-06-19 14:02:46,065 DEBUG [] [PollThread] = Для получения файла используем БД
2025-06-19 14:02:46,066 DEBUG [] [PollThread] = Loading data by uri: 6635f0eb-d36a-4982-90e2-a1fb1175e546
2025-06-19 14:02:46,066 DEBUG [] [PollThread] = SELECT filedata FROM filedata.inboxdata
WHERE uri=?
ORDER BY id

2025-06-19 14:02:46,121 DEBUG [] [PollThread] = Doc type:DocType{type='repimportedproduct_v4', num='46', ticketDocName='RepImportedProduct_v4'} date:2025-06-19 number:00018
2025-06-19 14:02:46,122 DEBUG [] [PollThread] = 030000434308-6635f0eb-d36a-4982-90e2-a1fb1175e546
2025-06-19 14:02:46,122 DEBUG [] [PollThread] = Load:56 ms
2025-06-19 14:02:46,125 DEBUG [] [PollThread] = checkExist:repimportedproduct_v4
2025-06-19 14:02:46,133 DEBUG [] [PollThread] = find rule:DocTypeCode[docType=DocType{type='repimportedproduct_v4', num='46', ticketDocName='RepImportedProduct_v4'}, code=doubles] Rule[code=doubles, mode=ERROR, start=Проверка документа на повтор, reject=Документ с номером %s и датой %s уже зафиксирован в системе, confirm=Проверка пройдена]
2025-06-19 14:02:46,134 DEBUG [] [PollThread] = existRegistryDoc [030000434308] [repimportedproduct_v4] [00018] [2025-06-19]
2025-06-19 14:02:46,134 DEBUG [] [PollThread] = SELECT 1
FROM
  registry.documents
WHERE
  fsrarid = ?
  AND dtype = ?
  AND client_number = ?
  AND dt = ?
LIMIT 1

2025-06-19 14:02:46,140 DEBUG [] [PollThread] = 30000434308 repimportedproduct_v4 00018 2025-06-19
2025-06-19 14:02:46,148 DEBUG [] [PollThread] = docHash: 4a7efb33a1843082aff6560b12f1198e
2025-06-19 14:02:46,153 DEBUG [] [PollThread] = set docHash 4a7efb33a1843082aff6560b12f1198e to redis
2025-06-19 14:02:46,153 DEBUG [] [PollThread] = checkDayShift:repimportedproduct_v4
2025-06-19 14:02:46,154 DEBUG [] [PollThread] = find rule:DocTypeCode[docType=DocType{type='repimportedproduct_v4', num='46', ticketDocName='RepImportedProduct_v4'}, code=daterange] Rule[code=daterange, mode=SKIP, start=Дата, указанная отправителем в документе, может отличаться от даты подачи документа в ЕГАИС на три дня в большую или меньшую сторону (с учетом часовых поясов), reject=Дата документа (%s) отличается от текущей более чем на три дня, confirm=Проверка пройдена]
2025-06-19 14:02:46,154 DEBUG [] [PollThread] = skip:daterange
2025-06-19 14:02:46,154 DEBUG [] [PollThread] = docDate:2025-06-19 
2025-06-19 14:02:46,156 DEBUG [] [PollThread] = importedDate:2025-06-19 
2025-06-19 14:02:46,156 DEBUG [] [PollThread] = betweenDays:0
2025-06-19 14:02:46,156 DEBUG [] [PollThread] = checkShipper:repimportedproduct_v4
2025-06-19 14:02:46,156 DEBUG [] [PollThread] = find rule:DocTypeCode[docType=DocType{type='repimportedproduct_v4', num='46', ticketDocName='RepImportedProduct_v4'}, code=senderproducer] Rule[code=senderproducer, mode=ERROR, start=Отправитель отчета о производстве должен совпадать с производителем продукции, указанным в документе., reject=СИО отправителя документа не соответствует СИО производителя продукции, confirm=Проверка пройдена]
2025-06-19 14:02:46,157 DEBUG [] [PollThread] = checkQuantityFormat:DocType{type='repimportedproduct_v4', num='46', ticketDocName='RepImportedProduct_v4'}
2025-06-19 14:02:46,157 DEBUG [] [PollThread] = find rule:DocTypeCode[docType=DocType{type='repimportedproduct_v4', num='46', ticketDocName='RepImportedProduct_v4'}, code=quantity] Rule[code=quantity, mode=WARNING, start=Количество должно быть больше нуля, если значение «isUnpacked» - «0», проверяем что Quantity - целое число, reject=Значение количества продукции с кодом %s не соответствует формату, confirm=Проверка пройдена]
2025-06-19 14:02:46,157 DEBUG [] [PollThread] = quantity:0.5
2025-06-19 14:02:46,158 DEBUG [] [PollThread] = warning:{}
ru.centerinform.svs.insp.doc.HandleException: Документ от организации 030000434308 номер 00018 с датой 2025-06-19. Количество не соответствует формату.
	at ru.centerinform.svs.insp.doc.checker.Checker.ex(Checker.java:635) ~[insp-3.27.0.jar:?]
	at ru.centerinform.svs.insp.doc.checker.Checker.checkQuantityFormatPos(Checker.java:275) ~[insp-3.27.0.jar:?]
	at ru.centerinform.svs.insp.doc.checker.Checker.checkQuantityFormatImpl(Checker.java:260) ~[insp-3.27.0.jar:?]
	at ru.centerinform.svs.insp.doc.checker.Checker.lambda$checkQuantityFormat$6(Checker.java:284) ~[insp-3.27.0.jar:?]
	at ru.centerinform.svs.insp.doc.checker.Checker.check(Checker.java:97) ~[insp-3.27.0.jar:?]
	at ru.centerinform.svs.insp.doc.checker.Checker.checkQuantityFormat(Checker.java:284) ~[insp-3.27.0.jar:?]
	at ru.centerinform.svs.insp.doc.ri.RIHandler.check(RIHandler.java:69) ~[insp-3.27.0.jar:?]
	at ru.centerinform.svs.insp.doc.ri.RIHandler.handle(RIHandler.java:50) ~[insp-3.27.0.jar:?]
	at ru.centerinform.svs.insp.InspMessageHandler.handleImpl(InspMessageHandler.java:99) ~[insp-3.27.0.jar:?]
	at ru.centerinform.svs.insp.InspMessageHandler.handle(InspMessageHandler.java:76) ~[insp-3.27.0.jar:?]
	at ru.centerinform.svs.insp.kafka.Consumption.poll0(Consumption.java:223) ~[insp-3.27.0.jar:?]
	at ru.centerinform.svs.insp.kafka.Consumption.poll(Consumption.java:93) ~[insp-3.27.0.jar:?]
	at ru.centerinform.svs.insp.kafka.PollThread.run(PollThread.java:121) ~[insp-3.27.0.jar:?]
2025-06-19 14:02:46,158 DEBUG [] [PollThread] = find rule:DocTypeCode[docType=DocType{type='repimportedproduct_v4', num='46', ticketDocName='RepImportedProduct_v4'}, code=product] Rule[code=product, mode=WARNING, start=В документах ввода в оборот может быть указана только продукция, предварительно зарегистрированная во ФРАП и имеющая код ЕГАИС, reject=Продукция с кодами %s не зарегистрирована в ЕГАИС, confirm=Проверка пройдена]
2025-06-19 14:02:46,158 DEBUG [] [PollThread] = enter to checkLicense.
2025-06-19 14:02:46,158 DEBUG [] [PollThread] = selectFromNsiProducts [[0300004343080000007]]
2025-06-19 14:02:46,159 DEBUG [] [PollThread] = SELECT
  pt.code_egais AS ProductType_Code,
  p.alc_code,
  p.country_id AS Country_Code,
  p.importer_fsrar_id AS Importer_OwnerID,
  pt.product_group_code AS ProductVid_Code,
  p.is_unpacked AS isUnpacked,
  p.producer_fsrar_id AS Owner_ID
FROM
  "references".product_snapshot p
  INNER JOIN "references".product_type pt ON pt.id = p.product_type_id
WHERE
  alc_code IN (
?)
2025-06-19 14:02:46,170 DEBUG [] [PollThread] = finish selectFromNsiProducts. size:[1]
2025-06-19 14:02:46,170 DEBUG [] [PollThread] = isKfk() fsrarId = [030000434308]
2025-06-19 14:02:46,170 DEBUG [] [PollThread] = SELECT 1
FROM
  "references".org_snapshot t
WHERE
  t.fsrar_id = ?
  AND length(t.inn) <> 10

2025-06-19 14:02:46,174 DEBUG [] [PollThread] = result:false
2025-06-19 14:02:46,174 DEBUG [] [PollThread] = extp [[28015]]
2025-06-19 14:02:46,174 DEBUG [] [PollThread] =   SELECT
    ptp.code AS ExclusionType,
    pt.code_egais AS ProductType_Code
  FROM
    "references".product_type pt
    JOIN subref.product_type_props_lnk ptpl ON ptpl.product_type_id = pt.id
    JOIN subref.product_type_props ptp ON ptp.id = ptpl.product_type_props_id
  WHERE
    ptpl.is_active = true
    AND pt.code_egais IN  (
?)
2025-06-19 14:02:46,179 DEBUG [] [PollThread] = checkLic [[28015]]
2025-06-19 14:02:46,179 DEBUG [] [PollThread] = SELECT
  COUNT(ptpl.id) AS count_id
FROM
  "references".product_type pt
  JOIN subref.product_type_props_lnk ptpl ON ptpl.product_type_id = pt.id
  JOIN subref.product_type_props ptp ON ptp.id = ptpl.product_type_props_id
WHERE
  ptp.code = 'UnLicense'
  AND pt.code_egais IN (
?)
2025-06-19 14:02:46,184 DEBUG [] [PollThread] = productTypeCodes:1
2025-06-19 14:02:46,185 DEBUG [] [PollThread] = selectFromClientsPeriodLicense [030000434308], [2025-06-19]
2025-06-19 14:02:46,185 DEBUG [] [PollThread] = SELECT 1
FROM
  registries.registry r
WHERE
  r.fsrar_id = ?
  AND ? BETWEEN r.inclusion_date
  AND COALESCE(
    r.expiration_date, CURRENT_DATE + INTERVAL '30 days'
  )
  AND (
    r.row_validity_end IS NULL
    OR r.row_validity_end < CURRENT_TIMESTAMP
  )

2025-06-19 14:02:46,189 DEBUG [] [PollThread] = exist:true 
2025-06-19 14:02:46,189 DEBUG [] [PollThread] = enter to checkUnMarked
2025-06-19 14:02:46,190 ERROR [] [PollThread] = handle error
ru.centerinform.svs.insp.doc.HandleException: Документ от организации 030000434308 номер 00018 с датой 2025-06-19. Количество ФСМ не совпадает с количеством, указанным в позиции.
	at ru.centerinform.svs.insp.doc.checker.Checker.ex(Checker.java:635) ~[insp-3.27.0.jar:?]
	at ru.centerinform.svs.insp.doc.checker.Checker.checkActualQuantityPos(Checker.java:319) ~[insp-3.27.0.jar:?]
	at ru.centerinform.svs.insp.doc.checker.Checker.checkActualQuantity(Checker.java:304) ~[insp-3.27.0.jar:?]
	at ru.centerinform.svs.insp.doc.ri.RIHandler.check(RIHandler.java:73) ~[insp-3.27.0.jar:?]
	at ru.centerinform.svs.insp.doc.ri.RIHandler.handle(RIHandler.java:50) ~[insp-3.27.0.jar:?]
	at ru.centerinform.svs.insp.InspMessageHandler.handleImpl(InspMessageHandler.java:99) ~[insp-3.27.0.jar:?]
	at ru.centerinform.svs.insp.InspMessageHandler.handle(InspMessageHandler.java:76) ~[insp-3.27.0.jar:?]
	at ru.centerinform.svs.insp.kafka.Consumption.poll0(Consumption.java:223) ~[insp-3.27.0.jar:?]
	at ru.centerinform.svs.insp.kafka.Consumption.poll(Consumption.java:93) ~[insp-3.27.0.jar:?]
	at ru.centerinform.svs.insp.kafka.PollThread.run(PollThread.java:121) ~[insp-3.27.0.jar:?]
2025-06-19 14:02:46,191 ERROR [] [PollThread] = Fail
ru.centerinform.svs.insp.doc.HandleException: Документ от организации 030000434308 номер 00018 с датой 2025-06-19. Количество ФСМ не совпадает с количеством, указанным в позиции.
	at ru.centerinform.svs.insp.doc.checker.Checker.ex(Checker.java:635) ~[insp-3.27.0.jar:?]
	at ru.centerinform.svs.insp.doc.checker.Checker.checkActualQuantityPos(Checker.java:319) ~[insp-3.27.0.jar:?]
	at ru.centerinform.svs.insp.doc.checker.Checker.checkActualQuantity(Checker.java:304) ~[insp-3.27.0.jar:?]
	at ru.centerinform.svs.insp.doc.ri.RIHandler.check(RIHandler.java:73) ~[insp-3.27.0.jar:?]
	at ru.centerinform.svs.insp.doc.ri.RIHandler.handle(RIHandler.java:50) ~[insp-3.27.0.jar:?]
	at ru.centerinform.svs.insp.InspMessageHandler.handleImpl(InspMessageHandler.java:99) ~[insp-3.27.0.jar:?]
	at ru.centerinform.svs.insp.InspMessageHandler.handle(InspMessageHandler.java:76) ~[insp-3.27.0.jar:?]
	at ru.centerinform.svs.insp.kafka.Consumption.poll0(Consumption.java:223) ~[insp-3.27.0.jar:?]
	at ru.centerinform.svs.insp.kafka.Consumption.poll(Consumption.java:93) ~[insp-3.27.0.jar:?]
	at ru.centerinform.svs.insp.kafka.PollThread.run(PollThread.java:121) ~[insp-3.27.0.jar:?]
2025-06-19 14:02:46,192 DEBUG [] [PollThread] = Remove docHash:4a7efb33a1843082aff6560b12f1198e from redis cache
2025-06-19 14:02:46,194 DEBUG [] [PollThread] = docUri:030000434308-6635f0eb-d36a-4982-90e2-a1fb1175e546
2025-06-19 14:02:46,194 DEBUG [] [PollThread] = date:2025-06-19T14:02:46.194725500
2025-06-19 14:02:46,195 DEBUG [] [PollThread] = ticketUri:030000434308-914369dd-abac-4f85-879b-3d0e0270a97e
2025-06-19 14:02:46,195 DEBUG [] [PollThread] = xmlTransportId:030000434308-6635f0eb-d36a-4982-90e2-a1fb1175e546
2025-06-19 14:02:46,195 DEBUG [] [PollThread] = set comments: Документ от организации 030000434308 номер 00018 с датой 2025-06-19. Количество ФСМ не совпадает с количеством, указанным в позиции.
2025-06-19 14:02:46,195 DEBUG [] [PollThread] = templatePath:xml/ticket.xml
2025-06-19 14:02:46,209 DEBUG [] [PollThread] = <?xml version="1.0" encoding="utf-8"?>
<ns:Documents xmlns:tc="http://fsrar.ru/WEGAIS/Ticket"
              xmlns:oref="http://fsrar.ru/WEGAIS/ClientRef"
              xmlns:ns="http://fsrar.ru/WEGAIS/WB_DOC_SINGLE_01"
              xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
              Version="1.0">
    <ns:Owner>
        <ns:FSRAR_ID>3463047</ns:FSRAR_ID>
    </ns:Owner>
    <ns:Document>
        <ns:Ticket>
            <tc:TicketDate>2025-06-19T14:02:46.194</tc:TicketDate>
            <tc:Identity>00018</tc:Identity>
            <tc:DocId></tc:DocId>
            <tc:TransportId>030000434308-6635f0eb-d36a-4982-90e2-a1fb1175e546</tc:TransportId>
            <tc:RegID></tc:RegID>
            <tc:DocHash/>
            <tc:DocType>RepImportedProduct_v4</tc:DocType>
            <tc:Result>
                <tc:Conclusion>Rejected</tc:Conclusion>
                <tc:ConclusionDate></tc:ConclusionDate>
                <tc:Comments>Документ от организации 030000434308 номер 00018 с датой 2025-06-19. Количество ФСМ не совпадает с количеством, указанным в позиции.</tc:Comments>
            </tc:Result>
        </ns:Ticket>
    </ns:Document>
</ns:Documents>


2025-06-19 14:02:46,209 DEBUG [] [PollThread] = Для сохранения квитанции используем БД
2025-06-19 14:02:46,211 DEBUG [] [PollThread] = save ticket to DB: Ticket{xml='<?xml version="1.0" encoding="utf-8"?>
<ns:Documents xmlns:tc="http://fsrar.ru/WEGAIS/Ticket"
              xmlns:oref="http://fsrar.ru/WEGAIS/ClientRef"
              xmlns:ns="http://fsrar.ru/WEGAIS/WB_DOC_SINGLE_01"
              xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
              Version="1.0">
    <ns:Owner>
        <ns:FSRAR_ID>3463047</ns:FSRAR_ID>
    </ns:Owner>
    <ns:Document>
        <ns:Ticket>
            <tc:TicketDate>2025-06-19T14:02:46.194</tc:TicketDate>
            <tc:Identity>00018</tc:Identity>
            <tc:DocId></tc:DocId>
            <tc:TransportId>030000434308-6635f0eb-d36a-4982-90e2-a1fb1175e546</tc:TransportId>
            <tc:RegID></tc:RegID>
            <tc:DocHash/>
            <tc:DocType>RepImportedProduct_v4</tc:DocType>
            <tc:Result>
                <tc:Conclusion>Rejected</tc:Conclusion>
                <tc:ConclusionDate></tc:ConclusionDate>
                <tc:Comments>Документ от организации 030000434308 номер 00018 с датой 2025-06-19. Количество ФСМ не совпадает с количеством, указанным в позиции.</tc:Comments>
            </tc:Result>
        </ns:Ticket>
    </ns:Document>
</ns:Documents>

', nowDateTime=2025-06-19T14:02:46.194725500, ticketDate='2025-06-19', ticketDateTime='2025-06-19T14:02:46.194', docUri='030000434308-6635f0eb-d36a-4982-90e2-a1fb1175e546', ticketUri='030000434308-914369dd-abac-4f85-879b-3d0e0270a97e', ticketUUID='914369dd-abac-4f85-879b-3d0e0270a97e', fsrarId='030000434308', identity='00018', templater=ru.centerinform.svs.insp.Templater@75aafbda, type=DocType{type='repimportedproduct_v4', num='46', ticketDocName='RepImportedProduct_v4'}}
2025-06-19 14:02:46,211 DEBUG [] [PollThread] = INSERT INTO filedata.outboxdata
    (uri, inboxuri, filedata)
    VALUES(?, ?, ?)

2025-06-19 14:02:46,211 DEBUG [] [PollThread] = 914369dd-abac-4f85-879b-3d0e0270a97e 6635f0eb-d36a-4982-90e2-a1fb1175e546 <?xml version="1.0" encoding="utf-8"?>
<ns:Documents xmlns:tc="http://fsrar.ru/WEGAIS/Ticket"
              xmlns:oref="http://fsrar.ru/WEGAIS/ClientRef"
              xmlns:ns="http://fsrar.ru/WEGAIS/WB_DOC_SINGLE_01"
              xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
              Version="1.0">
    <ns:Owner>
        <ns:FSRAR_ID>3463047</ns:FSRAR_ID>
    </ns:Owner>
    <ns:Document>
        <ns:Ticket>
            <tc:TicketDate>2025-06-19T14:02:46.194</tc:TicketDate>
            <tc:Identity>00018</tc:Identity>
            <tc:DocId></tc:DocId>
            <tc:TransportId>030000434308-6635f0eb-d36a-4982-90e2-a1fb1175e546</tc:TransportId>
            <tc:RegID></tc:RegID>
            <tc:DocHash/>
            <tc:DocType>RepImportedProduct_v4</tc:DocType>
            <tc:Result>
                <tc:Conclusion>Rejected</tc:Conclusion>
                <tc:ConclusionDate></tc:ConclusionDate>
                <tc:Comments>Документ от организации 030000434308 номер 00018 с датой 2025-06-19. Количество ФСМ не совпадает с количеством, указанным в позиции.</tc:Comments>
            </tc:Result>
        </ns:Ticket>
    </ns:Document>
</ns:Documents>


2025-06-19 14:02:46,216 DEBUG [] [PollThread] = insert 1 rows
2025-06-19 14:02:46,216 DEBUG [] [PollThread] = INSERT INTO outbox.meta (dtype, fsrarid, uri, ts)
    VALUES (?, ?, ?, ?)

2025-06-19 14:02:46,217 DEBUG [] [PollThread] = ticket 30000434308 914369dd-abac-4f85-879b-3d0e0270a97e 2025-06-19T14:02:46.194+0300
2025-06-19 14:02:46,222 DEBUG [] [PollThread] = insert 1 rows
2025-06-19 14:02:46,226 DEBUG [] [PollThread] = Fail finish
2025-06-19 14:02:46,226 INFO [] [PollThread] = End processing. 205 ms

</pre>
}}
{{collapse(Часть лога)
<pre>
2025-06-19 14:02:46,157 DEBUG [] [PollThread] = find rule:DocTypeCode[docType=DocType{type='repimportedproduct_v4', num='46', ticketDocName='RepImportedProduct_v4'}, code=quantity] Rule[code=quantity, mode=WARNING, start=Количество должно быть больше нуля, если значение «isUnpacked» - «0», проверяем что Quantity - целое число, reject=Значение количества продукции с кодом %s не соответствует формату, confirm=Проверка пройдена]
2025-06-19 14:02:46,157 DEBUG [] [PollThread] = quantity:0.5
2025-06-19 14:02:46,158 DEBUG [] [PollThread] = warning:{}
ru.centerinform.svs.insp.doc.HandleException: Документ от организации 030000434308 номер 00018 с датой 2025-06-19. Количество не соответствует формату.

</pre>
}}
*Полученный результат: Пока не очень понятно как воспроизвести именно эту проверку. Так как она перекрывается другой проверкой по тэгу Quantity*
## error {{collapse(БД)
<pre>
|id |document_name_format |document_format_version|check_code|date_begin|date_end  |ordernum|service_code|check_action|
|---|---------------------|-----------------------|----------|----------|----------|--------|------------|------------|
|74 |repimportedproduct_v4|4                      |quantity  |2025-02-20|2050-02-20|4       |inspector   |error       |

</pre>
}}
{{collapse(Полный лог)
<pre>
2025-06-19 14:05:44,829 DEBUG [] [GtdPollThread] = poll:0
2025-06-19 14:05:44,829 DEBUG [] [GtdPollThread] = repeat()
2025-06-19 14:05:44,829 DEBUG [] [GtdPollThread] = repeatEnabled:true
2025-06-19 14:05:44,829 DEBUG [] [GtdPollThread] = repeatRecords size:0
2025-06-19 14:05:44,829 DEBUG [] [GtdPollThread] = records is empty
2025-06-19 14:05:44,832 DEBUG [] [GtdPollThread] = commitSync()
2025-06-19 14:05:44,981 DEBUG [] [PollThread] = Для получения файла используем БД
2025-06-19 14:05:44,982 DEBUG [] [PollThread] = Loading data by uri: 6635f0eb-d36a-4982-90e2-a1fb1175e547
2025-06-19 14:05:44,982 DEBUG [] [PollThread] = SELECT filedata FROM filedata.inboxdata
WHERE uri=?
ORDER BY id

2025-06-19 14:05:45,078 DEBUG [] [PollThread] = Doc type:DocType{type='repimportedproduct_v4', num='46', ticketDocName='RepImportedProduct_v4'} date:2025-06-19 number:00018
2025-06-19 14:05:45,078 DEBUG [] [PollThread] = 030000434308-6635f0eb-d36a-4982-90e2-a1fb1175e547
2025-06-19 14:05:45,078 DEBUG [] [PollThread] = Load:97 ms
2025-06-19 14:05:45,081 DEBUG [] [PollThread] = checkExist:repimportedproduct_v4
2025-06-19 14:05:45,090 DEBUG [] [PollThread] = find rule:DocTypeCode[docType=DocType{type='repimportedproduct_v4', num='46', ticketDocName='RepImportedProduct_v4'}, code=doubles] Rule[code=doubles, mode=ERROR, start=Проверка документа на повтор, reject=Документ с номером %s и датой %s уже зафиксирован в системе, confirm=Проверка пройдена]
2025-06-19 14:05:45,091 DEBUG [] [PollThread] = existRegistryDoc [030000434308] [repimportedproduct_v4] [00018] [2025-06-19]
2025-06-19 14:05:45,091 DEBUG [] [PollThread] = SELECT 1
FROM
  registry.documents
WHERE
  fsrarid = ?
  AND dtype = ?
  AND client_number = ?
  AND dt = ?
LIMIT 1

2025-06-19 14:05:45,098 DEBUG [] [PollThread] = 30000434308 repimportedproduct_v4 00018 2025-06-19
2025-06-19 14:05:45,106 DEBUG [] [PollThread] = docHash: 51bafce541ad471cc9ca377924ef62b2
2025-06-19 14:05:45,113 DEBUG [] [PollThread] = set docHash 51bafce541ad471cc9ca377924ef62b2 to redis
2025-06-19 14:05:45,113 DEBUG [] [PollThread] = checkDayShift:repimportedproduct_v4
2025-06-19 14:05:45,113 DEBUG [] [PollThread] = find rule:DocTypeCode[docType=DocType{type='repimportedproduct_v4', num='46', ticketDocName='RepImportedProduct_v4'}, code=daterange] Rule[code=daterange, mode=SKIP, start=Дата, указанная отправителем в документе, может отличаться от даты подачи документа в ЕГАИС на три дня в большую или меньшую сторону (с учетом часовых поясов), reject=Дата документа (%s) отличается от текущей более чем на три дня, confirm=Проверка пройдена]
2025-06-19 14:05:45,113 DEBUG [] [PollThread] = skip:daterange
2025-06-19 14:05:45,113 DEBUG [] [PollThread] = docDate:2025-06-19 
2025-06-19 14:05:45,116 DEBUG [] [PollThread] = importedDate:2025-06-19 
2025-06-19 14:05:45,116 DEBUG [] [PollThread] = betweenDays:0
2025-06-19 14:05:45,116 DEBUG [] [PollThread] = checkShipper:repimportedproduct_v4
2025-06-19 14:05:45,117 DEBUG [] [PollThread] = find rule:DocTypeCode[docType=DocType{type='repimportedproduct_v4', num='46', ticketDocName='RepImportedProduct_v4'}, code=senderproducer] Rule[code=senderproducer, mode=ERROR, start=Отправитель отчета о производстве должен совпадать с производителем продукции, указанным в документе., reject=СИО отправителя документа не соответствует СИО производителя продукции, confirm=Проверка пройдена]
2025-06-19 14:05:45,117 DEBUG [] [PollThread] = checkQuantityFormat:DocType{type='repimportedproduct_v4', num='46', ticketDocName='RepImportedProduct_v4'}
2025-06-19 14:05:45,117 DEBUG [] [PollThread] = find rule:DocTypeCode[docType=DocType{type='repimportedproduct_v4', num='46', ticketDocName='RepImportedProduct_v4'}, code=quantity] Rule[code=quantity, mode=ERROR, start=Количество должно быть больше нуля, если значение «isUnpacked» - «0», проверяем что Quantity - целое число, reject=Значение количества продукции с кодом %s не соответствует формату, confirm=Проверка пройдена]
2025-06-19 14:05:45,117 DEBUG [] [PollThread] = quantity:0.5
2025-06-19 14:05:45,118 DEBUG [] [PollThread] = error:{}
ru.centerinform.svs.insp.doc.HandleException: Документ от организации 030000434308 номер 00018 с датой 2025-06-19. Количество не соответствует формату.
	at ru.centerinform.svs.insp.doc.checker.Checker.ex(Checker.java:635) ~[insp-3.27.0.jar:?]
	at ru.centerinform.svs.insp.doc.checker.Checker.checkQuantityFormatPos(Checker.java:275) ~[insp-3.27.0.jar:?]
	at ru.centerinform.svs.insp.doc.checker.Checker.checkQuantityFormatImpl(Checker.java:260) ~[insp-3.27.0.jar:?]
	at ru.centerinform.svs.insp.doc.checker.Checker.lambda$checkQuantityFormat$6(Checker.java:284) ~[insp-3.27.0.jar:?]
	at ru.centerinform.svs.insp.doc.checker.Checker.check(Checker.java:109) ~[insp-3.27.0.jar:?]
	at ru.centerinform.svs.insp.doc.checker.Checker.checkQuantityFormat(Checker.java:284) ~[insp-3.27.0.jar:?]
	at ru.centerinform.svs.insp.doc.ri.RIHandler.check(RIHandler.java:69) ~[insp-3.27.0.jar:?]
	at ru.centerinform.svs.insp.doc.ri.RIHandler.handle(RIHandler.java:50) ~[insp-3.27.0.jar:?]
	at ru.centerinform.svs.insp.InspMessageHandler.handleImpl(InspMessageHandler.java:99) ~[insp-3.27.0.jar:?]
	at ru.centerinform.svs.insp.InspMessageHandler.handle(InspMessageHandler.java:76) ~[insp-3.27.0.jar:?]
	at ru.centerinform.svs.insp.kafka.Consumption.poll0(Consumption.java:223) ~[insp-3.27.0.jar:?]
	at ru.centerinform.svs.insp.kafka.Consumption.poll(Consumption.java:93) ~[insp-3.27.0.jar:?]
	at ru.centerinform.svs.insp.kafka.PollThread.run(PollThread.java:121) ~[insp-3.27.0.jar:?]
2025-06-19 14:05:45,118 ERROR [] [PollThread] = handle error
ru.centerinform.svs.insp.doc.HandleException: Документ от организации 030000434308 номер 00018 с датой 2025-06-19. Количество не соответствует формату.
	at ru.centerinform.svs.insp.doc.checker.Checker.ex(Checker.java:635) ~[insp-3.27.0.jar:?]
	at ru.centerinform.svs.insp.doc.checker.Checker.checkQuantityFormatPos(Checker.java:275) ~[insp-3.27.0.jar:?]
	at ru.centerinform.svs.insp.doc.checker.Checker.checkQuantityFormatImpl(Checker.java:260) ~[insp-3.27.0.jar:?]
	at ru.centerinform.svs.insp.doc.checker.Checker.lambda$checkQuantityFormat$6(Checker.java:284) ~[insp-3.27.0.jar:?]
	at ru.centerinform.svs.insp.doc.checker.Checker.check(Checker.java:109) ~[insp-3.27.0.jar:?]
	at ru.centerinform.svs.insp.doc.checker.Checker.checkQuantityFormat(Checker.java:284) ~[insp-3.27.0.jar:?]
	at ru.centerinform.svs.insp.doc.ri.RIHandler.check(RIHandler.java:69) ~[insp-3.27.0.jar:?]
	at ru.centerinform.svs.insp.doc.ri.RIHandler.handle(RIHandler.java:50) ~[insp-3.27.0.jar:?]
	at ru.centerinform.svs.insp.InspMessageHandler.handleImpl(InspMessageHandler.java:99) ~[insp-3.27.0.jar:?]
	at ru.centerinform.svs.insp.InspMessageHandler.handle(InspMessageHandler.java:76) ~[insp-3.27.0.jar:?]
	at ru.centerinform.svs.insp.kafka.Consumption.poll0(Consumption.java:223) ~[insp-3.27.0.jar:?]
	at ru.centerinform.svs.insp.kafka.Consumption.poll(Consumption.java:93) ~[insp-3.27.0.jar:?]
	at ru.centerinform.svs.insp.kafka.PollThread.run(PollThread.java:121) ~[insp-3.27.0.jar:?]
2025-06-19 14:05:45,119 ERROR [] [PollThread] = Fail
ru.centerinform.svs.insp.doc.HandleException: Документ от организации 030000434308 номер 00018 с датой 2025-06-19. Количество не соответствует формату.
	at ru.centerinform.svs.insp.doc.checker.Checker.ex(Checker.java:635) ~[insp-3.27.0.jar:?]
	at ru.centerinform.svs.insp.doc.checker.Checker.checkQuantityFormatPos(Checker.java:275) ~[insp-3.27.0.jar:?]
	at ru.centerinform.svs.insp.doc.checker.Checker.checkQuantityFormatImpl(Checker.java:260) ~[insp-3.27.0.jar:?]
	at ru.centerinform.svs.insp.doc.checker.Checker.lambda$checkQuantityFormat$6(Checker.java:284) ~[insp-3.27.0.jar:?]
	at ru.centerinform.svs.insp.doc.checker.Checker.check(Checker.java:109) ~[insp-3.27.0.jar:?]
	at ru.centerinform.svs.insp.doc.checker.Checker.checkQuantityFormat(Checker.java:284) ~[insp-3.27.0.jar:?]
	at ru.centerinform.svs.insp.doc.ri.RIHandler.check(RIHandler.java:69) ~[insp-3.27.0.jar:?]
	at ru.centerinform.svs.insp.doc.ri.RIHandler.handle(RIHandler.java:50) ~[insp-3.27.0.jar:?]
	at ru.centerinform.svs.insp.InspMessageHandler.handleImpl(InspMessageHandler.java:99) ~[insp-3.27.0.jar:?]
	at ru.centerinform.svs.insp.InspMessageHandler.handle(InspMessageHandler.java:76) ~[insp-3.27.0.jar:?]
	at ru.centerinform.svs.insp.kafka.Consumption.poll0(Consumption.java:223) ~[insp-3.27.0.jar:?]
	at ru.centerinform.svs.insp.kafka.Consumption.poll(Consumption.java:93) ~[insp-3.27.0.jar:?]
	at ru.centerinform.svs.insp.kafka.PollThread.run(PollThread.java:121) ~[insp-3.27.0.jar:?]
2025-06-19 14:05:45,119 DEBUG [] [PollThread] = Remove docHash:51bafce541ad471cc9ca377924ef62b2 from redis cache
2025-06-19 14:05:45,121 DEBUG [] [PollThread] = docUri:030000434308-6635f0eb-d36a-4982-90e2-a1fb1175e547
2025-06-19 14:05:45,121 DEBUG [] [PollThread] = date:2025-06-19T14:05:45.121192973
2025-06-19 14:05:45,121 DEBUG [] [PollThread] = ticketUri:030000434308-8605dbfa-5419-4c81-b61d-9fc79853fbbb
2025-06-19 14:05:45,122 DEBUG [] [PollThread] = xmlTransportId:030000434308-6635f0eb-d36a-4982-90e2-a1fb1175e547
2025-06-19 14:05:45,122 DEBUG [] [PollThread] = set comments: Значение количества продукции с кодом  не соответствует формату
2025-06-19 14:05:45,122 DEBUG [] [PollThread] = templatePath:xml/ticket.xml
2025-06-19 14:05:45,131 DEBUG [] [PollThread] = <?xml version="1.0" encoding="utf-8"?>
<ns:Documents xmlns:tc="http://fsrar.ru/WEGAIS/Ticket"
              xmlns:oref="http://fsrar.ru/WEGAIS/ClientRef"
              xmlns:ns="http://fsrar.ru/WEGAIS/WB_DOC_SINGLE_01"
              xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
              Version="1.0">
    <ns:Owner>
        <ns:FSRAR_ID>3463047</ns:FSRAR_ID>
    </ns:Owner>
    <ns:Document>
        <ns:Ticket>
            <tc:TicketDate>2025-06-19T14:05:45.121</tc:TicketDate>
            <tc:Identity>00018</tc:Identity>
            <tc:DocId></tc:DocId>
            <tc:TransportId>030000434308-6635f0eb-d36a-4982-90e2-a1fb1175e547</tc:TransportId>
            <tc:RegID></tc:RegID>
            <tc:DocHash/>
            <tc:DocType>RepImportedProduct_v4</tc:DocType>
            <tc:Result>
                <tc:Conclusion>Rejected</tc:Conclusion>
                <tc:ConclusionDate></tc:ConclusionDate>
                <tc:Comments>Значение количества продукции с кодом  не соответствует формату</tc:Comments>
            </tc:Result>
        </ns:Ticket>
    </ns:Document>
</ns:Documents>


2025-06-19 14:05:45,131 DEBUG [] [PollThread] = Для сохранения квитанции используем БД
2025-06-19 14:05:45,133 DEBUG [] [PollThread] = save ticket to DB: Ticket{xml='<?xml version="1.0" encoding="utf-8"?>
<ns:Documents xmlns:tc="http://fsrar.ru/WEGAIS/Ticket"
              xmlns:oref="http://fsrar.ru/WEGAIS/ClientRef"
              xmlns:ns="http://fsrar.ru/WEGAIS/WB_DOC_SINGLE_01"
              xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
              Version="1.0">
    <ns:Owner>
        <ns:FSRAR_ID>3463047</ns:FSRAR_ID>
    </ns:Owner>
    <ns:Document>
        <ns:Ticket>
            <tc:TicketDate>2025-06-19T14:05:45.121</tc:TicketDate>
            <tc:Identity>00018</tc:Identity>
            <tc:DocId></tc:DocId>
            <tc:TransportId>030000434308-6635f0eb-d36a-4982-90e2-a1fb1175e547</tc:TransportId>
            <tc:RegID></tc:RegID>
            <tc:DocHash/>
            <tc:DocType>RepImportedProduct_v4</tc:DocType>
            <tc:Result>
                <tc:Conclusion>Rejected</tc:Conclusion>
                <tc:ConclusionDate></tc:ConclusionDate>
                <tc:Comments>Значение количества продукции с кодом  не соответствует формату</tc:Comments>
            </tc:Result>
        </ns:Ticket>
    </ns:Document>
</ns:Documents>

', nowDateTime=2025-06-19T14:05:45.121192973, ticketDate='2025-06-19', ticketDateTime='2025-06-19T14:05:45.121', docUri='030000434308-6635f0eb-d36a-4982-90e2-a1fb1175e547', ticketUri='030000434308-8605dbfa-5419-4c81-b61d-9fc79853fbbb', ticketUUID='8605dbfa-5419-4c81-b61d-9fc79853fbbb', fsrarId='030000434308', identity='00018', templater=ru.centerinform.svs.insp.Templater@4f4fe10e, type=DocType{type='repimportedproduct_v4', num='46', ticketDocName='RepImportedProduct_v4'}}
2025-06-19 14:05:45,133 DEBUG [] [PollThread] = INSERT INTO filedata.outboxdata
    (uri, inboxuri, filedata)
    VALUES(?, ?, ?)

2025-06-19 14:05:45,133 DEBUG [] [PollThread] = 8605dbfa-5419-4c81-b61d-9fc79853fbbb 6635f0eb-d36a-4982-90e2-a1fb1175e547 <?xml version="1.0" encoding="utf-8"?>
<ns:Documents xmlns:tc="http://fsrar.ru/WEGAIS/Ticket"
              xmlns:oref="http://fsrar.ru/WEGAIS/ClientRef"
              xmlns:ns="http://fsrar.ru/WEGAIS/WB_DOC_SINGLE_01"
              xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
              Version="1.0">
    <ns:Owner>
        <ns:FSRAR_ID>3463047</ns:FSRAR_ID>
    </ns:Owner>
    <ns:Document>
        <ns:Ticket>
            <tc:TicketDate>2025-06-19T14:05:45.121</tc:TicketDate>
            <tc:Identity>00018</tc:Identity>
            <tc:DocId></tc:DocId>
            <tc:TransportId>030000434308-6635f0eb-d36a-4982-90e2-a1fb1175e547</tc:TransportId>
            <tc:RegID></tc:RegID>
            <tc:DocHash/>
            <tc:DocType>RepImportedProduct_v4</tc:DocType>
            <tc:Result>
                <tc:Conclusion>Rejected</tc:Conclusion>
                <tc:ConclusionDate></tc:ConclusionDate>
                <tc:Comments>Значение количества продукции с кодом  не соответствует формату</tc:Comments>
            </tc:Result>
        </ns:Ticket>
    </ns:Document>
</ns:Documents>


2025-06-19 14:05:45,139 DEBUG [] [PollThread] = insert 1 rows
2025-06-19 14:05:45,139 DEBUG [] [PollThread] = INSERT INTO outbox.meta (dtype, fsrarid, uri, ts)
    VALUES (?, ?, ?, ?)

2025-06-19 14:05:45,140 DEBUG [] [PollThread] = ticket 30000434308 8605dbfa-5419-4c81-b61d-9fc79853fbbb 2025-06-19T14:05:45.121+0300
2025-06-19 14:05:45,146 DEBUG [] [PollThread] = insert 1 rows
2025-06-19 14:05:45,150 DEBUG [] [PollThread] = Fail finish
2025-06-19 14:05:45,150 INFO [] [PollThread] = End processing. 5227 ms
2025-06-19 14:05:45,150 DEBUG [] [PollThread] = repeat()
2025-06-19 14:05:45,150 DEBUG [] [PollThread] = repeatEnabled:true
2025-06-19 14:05:45,150 DEBUG [] [PollThread] = repeatRecords size:0
2025-06-19 14:05:45,150 DEBUG [] [PollThread] = records is empty
2025-06-19 14:05:45,153 DEBUG [] [PollThread] = commitSync()
2025-06-19 14:05:45,833 DEBUG [] [GtdPollThread] = poll:0
2025-06-19 14:05:45,833 DEBUG [] [GtdPollThread] = repeat()
2025-06-19 14:05:45,833 DEBUG [] [GtdPollThread] = repeatEnabled:true
2025-06-19 14:05:45,833 DEBUG [] [GtdPollThread] = repeatRecords size:0
2025-06-19 14:05:45,833 DEBUG [] [GtdPollThread] = records is empty

</pre>
}}
{{collapse(Часть лога)
<pre>
Значение количества продукции с кодом %s не соответствует формату

2025-06-19 14:05:45,131 DEBUG [] [PollThread] = <?xml version="1.0" encoding="utf-8"?>
<ns:Documents xmlns:tc="http://fsrar.ru/WEGAIS/Ticket"
              xmlns:oref="http://fsrar.ru/WEGAIS/ClientRef"
              xmlns:ns="http://fsrar.ru/WEGAIS/WB_DOC_SINGLE_01"
              xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
              Version="1.0">
    <ns:Owner>
        <ns:FSRAR_ID>3463047</ns:FSRAR_ID>
    </ns:Owner>
    <ns:Document>
        <ns:Ticket>
            <tc:TicketDate>2025-06-19T14:05:45.121</tc:TicketDate>
            <tc:Identity>00018</tc:Identity>
            <tc:DocId></tc:DocId>
            <tc:TransportId>030000434308-6635f0eb-d36a-4982-90e2-a1fb1175e547</tc:TransportId>
            <tc:RegID></tc:RegID>
            <tc:DocHash/>
            <tc:DocType>RepImportedProduct_v4</tc:DocType>
            <tc:Result>
                <tc:Conclusion>Rejected</tc:Conclusion>
                <tc:ConclusionDate></tc:ConclusionDate>
                <tc:Comments>Значение количества продукции с кодом  не соответствует формату</tc:Comments>
            </tc:Result>
        </ns:Ticket>
    </ns:Document>
</ns:Documents>

</pre>
}}
*Полученный результат: Проверка определилась, статус проверки определился корректно, проверка провалилась корректно с частично корректной ошибкой(код продукции отсутствует "Значение количества продукции с кодом  не соответствует формату") - ОШИБКА*
# daterange
## skip {{collapse(БД)
<pre>
|id |document_name_format |document_format_version|check_code|date_begin|date_end  |ordernum|service_code|check_action|
|---|---------------------|-----------------------|----------|----------|----------|--------|------------|------------|
|73 |repimportedproduct_v4|4                      |daterange |2025-02-20|2050-02-20|2       |inspector   |skip        |

</pre>
}}
{{collapse(Полный лог)
<pre>
2025-06-19 14:12:22,995 DEBUG [] [PollThread] = commitSync()
2025-06-19 14:12:23,776 DEBUG [] [GtdPollThread] = poll:0
2025-06-19 14:12:23,776 DEBUG [] [GtdPollThread] = repeat()
2025-06-19 14:12:23,776 DEBUG [] [GtdPollThread] = repeatEnabled:true
2025-06-19 14:12:23,776 DEBUG [] [GtdPollThread] = repeatRecords size:0
2025-06-19 14:12:23,776 DEBUG [] [GtdPollThread] = records is empty
2025-06-19 14:12:23,780 DEBUG [] [GtdPollThread] = commitSync()
2025-06-19 14:12:23,964 DEBUG [] [PollThread] = poll:1
2025-06-19 14:12:23,965 DEBUG [] [PollThread] = consume. key:[null] value:[{"type":"repimportedproduct_v4","uri":"030000434308-6635f0eb-d36a-4982-90e2-a1fb1175e548","fsrarid":"030000434308","date":"2025-06-05","timezone":"+03:00","inn":"7841051711","kpp":""}] offset:[20748] topic:[confirmed])
2025-06-19 14:12:23,971 INFO [] [PollThread] = Start processing.
2025-06-19 14:12:24,057 DEBUG [] [PollThread] = Для получения файла используем БД
2025-06-19 14:12:24,058 DEBUG [] [PollThread] = Loading data by uri: 6635f0eb-d36a-4982-90e2-a1fb1175e548
2025-06-19 14:12:24,058 DEBUG [] [PollThread] = SELECT filedata FROM filedata.inboxdata
WHERE uri=?
ORDER BY id

2025-06-19 14:12:24,120 DEBUG [] [PollThread] = Doc type:DocType{type='repimportedproduct_v4', num='46', ticketDocName='RepImportedProduct_v4'} date:2025-06-15 number:00019
2025-06-19 14:12:24,120 DEBUG [] [PollThread] = 030000434308-6635f0eb-d36a-4982-90e2-a1fb1175e548
2025-06-19 14:12:24,121 DEBUG [] [PollThread] = Load:63 ms
2025-06-19 14:12:24,124 DEBUG [] [PollThread] = checkExist:repimportedproduct_v4
2025-06-19 14:12:24,133 DEBUG [] [PollThread] = find rule:DocTypeCode[docType=DocType{type='repimportedproduct_v4', num='46', ticketDocName='RepImportedProduct_v4'}, code=doubles] Rule[code=doubles, mode=ERROR, start=Проверка документа на повтор, reject=Документ с номером %s и датой %s уже зафиксирован в системе, confirm=Проверка пройдена]
2025-06-19 14:12:24,133 DEBUG [] [PollThread] = existRegistryDoc [030000434308] [repimportedproduct_v4] [00019] [2025-06-15]
2025-06-19 14:12:24,133 DEBUG [] [PollThread] = SELECT 1
FROM
  registry.documents
WHERE
  fsrarid = ?
  AND dtype = ?
  AND client_number = ?
  AND dt = ?
LIMIT 1

2025-06-19 14:12:24,140 DEBUG [] [PollThread] = 30000434308 repimportedproduct_v4 00019 2025-06-15
2025-06-19 14:12:24,148 DEBUG [] [PollThread] = docHash: baeb0551fe4f3ffa97ca0f4aca6d56e0
2025-06-19 14:12:24,153 DEBUG [] [PollThread] = set docHash baeb0551fe4f3ffa97ca0f4aca6d56e0 to redis
2025-06-19 14:12:24,153 DEBUG [] [PollThread] = checkDayShift:repimportedproduct_v4
2025-06-19 14:12:24,154 DEBUG [] [PollThread] = find rule:DocTypeCode[docType=DocType{type='repimportedproduct_v4', num='46', ticketDocName='RepImportedProduct_v4'}, code=daterange] Rule[code=daterange, mode=SKIP, start=Дата, указанная отправителем в документе, может отличаться от даты подачи документа в ЕГАИС на три дня в большую или меньшую сторону (с учетом часовых поясов), reject=Дата документа (%s) отличается от текущей более чем на три дня, confirm=Проверка пройдена]
2025-06-19 14:12:24,154 DEBUG [] [PollThread] = skip:daterange
2025-06-19 14:12:24,154 DEBUG [] [PollThread] = docDate:2025-06-15 
2025-06-19 14:12:24,156 DEBUG [] [PollThread] = importedDate:2025-06-15 
2025-06-19 14:12:24,156 DEBUG [] [PollThread] = betweenDays:0
2025-06-19 14:12:24,156 DEBUG [] [PollThread] = checkShipper:repimportedproduct_v4
2025-06-19 14:12:24,157 DEBUG [] [PollThread] = find rule:DocTypeCode[docType=DocType{type='repimportedproduct_v4', num='46', ticketDocName='RepImportedProduct_v4'}, code=senderproducer] Rule[code=senderproducer, mode=ERROR, start=Отправитель отчета о производстве должен совпадать с производителем продукции, указанным в документе., reject=СИО отправителя документа не соответствует СИО производителя продукции, confirm=Проверка пройдена]
2025-06-19 14:12:24,157 DEBUG [] [PollThread] = checkQuantityFormat:DocType{type='repimportedproduct_v4', num='46', ticketDocName='RepImportedProduct_v4'}
2025-06-19 14:12:24,157 DEBUG [] [PollThread] = find rule:DocTypeCode[docType=DocType{type='repimportedproduct_v4', num='46', ticketDocName='RepImportedProduct_v4'}, code=quantity] Rule[code=quantity, mode=ERROR, start=Количество должно быть больше нуля, если значение «isUnpacked» - «0», проверяем что Quantity - целое число, reject=Значение количества продукции с кодом %s не соответствует формату, confirm=Проверка пройдена]
2025-06-19 14:12:24,158 DEBUG [] [PollThread] = find rule:DocTypeCode[docType=DocType{type='repimportedproduct_v4', num='46', ticketDocName='RepImportedProduct_v4'}, code=product] Rule[code=product, mode=WARNING, start=В документах ввода в оборот может быть указана только продукция, предварительно зарегистрированная во ФРАП и имеющая код ЕГАИС, reject=Продукция с кодами %s не зарегистрирована в ЕГАИС, confirm=Проверка пройдена]
2025-06-19 14:12:24,158 DEBUG [] [PollThread] = enter to checkLicense.
2025-06-19 14:12:24,158 DEBUG [] [PollThread] = selectFromNsiProducts [[0300004343080000007]]
2025-06-19 14:12:24,158 DEBUG [] [PollThread] = SELECT
  pt.code_egais AS ProductType_Code,
  p.alc_code,
  p.country_id AS Country_Code,
  p.importer_fsrar_id AS Importer_OwnerID,
  pt.product_group_code AS ProductVid_Code,
  p.is_unpacked AS isUnpacked,
  p.producer_fsrar_id AS Owner_ID
FROM
  "references".product_snapshot p
  INNER JOIN "references".product_type pt ON pt.id = p.product_type_id
WHERE
  alc_code IN (
?)
2025-06-19 14:12:24,169 DEBUG [] [PollThread] = finish selectFromNsiProducts. size:[1]
2025-06-19 14:12:24,169 DEBUG [] [PollThread] = isKfk() fsrarId = [030000434308]
2025-06-19 14:12:24,169 DEBUG [] [PollThread] = SELECT 1
FROM
  "references".org_snapshot t
WHERE
  t.fsrar_id = ?
  AND length(t.inn) <> 10

2025-06-19 14:12:24,173 DEBUG [] [PollThread] = result:false
2025-06-19 14:12:24,173 DEBUG [] [PollThread] = extp [[28015]]
2025-06-19 14:12:24,173 DEBUG [] [PollThread] =   SELECT
    ptp.code AS ExclusionType,
    pt.code_egais AS ProductType_Code
  FROM
    "references".product_type pt
    JOIN subref.product_type_props_lnk ptpl ON ptpl.product_type_id = pt.id
    JOIN subref.product_type_props ptp ON ptp.id = ptpl.product_type_props_id
  WHERE
    ptpl.is_active = true
    AND pt.code_egais IN  (
?)
2025-06-19 14:12:24,178 DEBUG [] [PollThread] = checkLic [[28015]]
2025-06-19 14:12:24,178 DEBUG [] [PollThread] = SELECT
  COUNT(ptpl.id) AS count_id
FROM
  "references".product_type pt
  JOIN subref.product_type_props_lnk ptpl ON ptpl.product_type_id = pt.id
  JOIN subref.product_type_props ptp ON ptp.id = ptpl.product_type_props_id
WHERE
  ptp.code = 'UnLicense'
  AND pt.code_egais IN (
?)
2025-06-19 14:12:24,183 DEBUG [] [PollThread] = productTypeCodes:1
2025-06-19 14:12:24,183 DEBUG [] [PollThread] = selectFromClientsPeriodLicense [030000434308], [2025-06-15]
2025-06-19 14:12:24,183 DEBUG [] [PollThread] = SELECT 1
FROM
  registries.registry r
WHERE
  r.fsrar_id = ?
  AND ? BETWEEN r.inclusion_date
  AND COALESCE(
    r.expiration_date, CURRENT_DATE + INTERVAL '30 days'
  )
  AND (
    r.row_validity_end IS NULL
    OR r.row_validity_end < CURRENT_TIMESTAMP
  )

2025-06-19 14:12:24,188 DEBUG [] [PollThread] = exist:true 
2025-06-19 14:12:24,188 DEBUG [] [PollThread] = enter to checkUnMarked
2025-06-19 14:12:24,189 DEBUG [] [PollThread] = checkcUnionMembership [112] 
2025-06-19 14:12:24,189 DEBUG [] [PollThread] = SELECT 1
FROM
  subref.country_unions_lnk cul
  JOIN subref.country_unions cu ON cu.id = cul.country_unions_id
  AND cu.code = 'ЕАЭС'
WHERE
  cul.country_code = ?

2025-06-19 14:12:24,212 DEBUG [] [PollThread] = gen:IMP-0000000044
2025-06-19 14:12:24,213 DEBUG [] [PollThread] = Success
2025-06-19 14:12:24,214 DEBUG [] [PollThread] = Create ticket
2025-06-19 14:12:24,215 DEBUG [] [PollThread] = docUri:030000434308-6635f0eb-d36a-4982-90e2-a1fb1175e548
2025-06-19 14:12:24,215 DEBUG [] [PollThread] = date:2025-06-19T14:12:24.215601723
2025-06-19 14:12:24,216 DEBUG [] [PollThread] = ticketUri:030000434308-1081fac3-6454-42e7-bf0e-e7838c40ea8c
2025-06-19 14:12:24,216 DEBUG [] [PollThread] = xmlTransportId:030000434308-6635f0eb-d36a-4982-90e2-a1fb1175e548
2025-06-19 14:12:24,216 DEBUG [] [PollThread] = templatePath:xml/ticket.xml
2025-06-19 14:12:24,228 DEBUG [] [PollThread] = <?xml version="1.0" encoding="utf-8"?>
<ns:Documents xmlns:tc="http://fsrar.ru/WEGAIS/Ticket"
              xmlns:oref="http://fsrar.ru/WEGAIS/ClientRef"
              xmlns:ns="http://fsrar.ru/WEGAIS/WB_DOC_SINGLE_01"
              xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
              Version="1.0">
    <ns:Owner>
        <ns:FSRAR_ID>3463047</ns:FSRAR_ID>
    </ns:Owner>
    <ns:Document>
        <ns:Ticket>
            <tc:TicketDate>2025-06-19T14:12:24.215</tc:TicketDate>
            <tc:Identity>00019</tc:Identity>
            <tc:DocId></tc:DocId>
            <tc:TransportId>030000434308-6635f0eb-d36a-4982-90e2-a1fb1175e548</tc:TransportId>
            <tc:RegID>IMP-0000000044</tc:RegID>
            <tc:DocHash/>
            <tc:DocType>RepImportedProduct_v4</tc:DocType>
            <tc:Result>
                <tc:Conclusion>Accepted</tc:Conclusion>
                <tc:ConclusionDate>2025-06-19T14:12:24.215</tc:ConclusionDate>
                <tc:Comments>Документ успешно принят системой на обработку.</tc:Comments>
            </tc:Result>
        </ns:Ticket>
    </ns:Document>
</ns:Documents>


2025-06-19 14:12:24,229 DEBUG [] [PollThread] = Для сохранения квитанции используем БД
2025-06-19 14:12:24,231 DEBUG [] [PollThread] = save ticket to DB: Ticket{xml='<?xml version="1.0" encoding="utf-8"?>
<ns:Documents xmlns:tc="http://fsrar.ru/WEGAIS/Ticket"
              xmlns:oref="http://fsrar.ru/WEGAIS/ClientRef"
              xmlns:ns="http://fsrar.ru/WEGAIS/WB_DOC_SINGLE_01"
              xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
              Version="1.0">
    <ns:Owner>
        <ns:FSRAR_ID>3463047</ns:FSRAR_ID>
    </ns:Owner>
    <ns:Document>
        <ns:Ticket>
            <tc:TicketDate>2025-06-19T14:12:24.215</tc:TicketDate>
            <tc:Identity>00019</tc:Identity>
            <tc:DocId></tc:DocId>
            <tc:TransportId>030000434308-6635f0eb-d36a-4982-90e2-a1fb1175e548</tc:TransportId>
            <tc:RegID>IMP-0000000044</tc:RegID>
            <tc:DocHash/>
            <tc:DocType>RepImportedProduct_v4</tc:DocType>
            <tc:Result>
                <tc:Conclusion>Accepted</tc:Conclusion>
                <tc:ConclusionDate>2025-06-19T14:12:24.215</tc:ConclusionDate>
                <tc:Comments>Документ успешно принят системой на обработку.</tc:Comments>
            </tc:Result>
        </ns:Ticket>
    </ns:Document>
</ns:Documents>

', nowDateTime=2025-06-19T14:12:24.215601723, ticketDate='2025-06-19', ticketDateTime='2025-06-19T14:12:24.215', docUri='030000434308-6635f0eb-d36a-4982-90e2-a1fb1175e548', ticketUri='030000434308-1081fac3-6454-42e7-bf0e-e7838c40ea8c', ticketUUID='1081fac3-6454-42e7-bf0e-e7838c40ea8c', fsrarId='030000434308', identity='00019', templater=ru.centerinform.svs.insp.Templater@4732a0a8, type=DocType{type='repimportedproduct_v4', num='46', ticketDocName='RepImportedProduct_v4'}}
2025-06-19 14:12:24,231 DEBUG [] [PollThread] = INSERT INTO filedata.outboxdata
    (uri, inboxuri, filedata)
    VALUES(?, ?, ?)

2025-06-19 14:12:24,231 DEBUG [] [PollThread] = 1081fac3-6454-42e7-bf0e-e7838c40ea8c 6635f0eb-d36a-4982-90e2-a1fb1175e548 <?xml version="1.0" encoding="utf-8"?>
<ns:Documents xmlns:tc="http://fsrar.ru/WEGAIS/Ticket"
              xmlns:oref="http://fsrar.ru/WEGAIS/ClientRef"
              xmlns:ns="http://fsrar.ru/WEGAIS/WB_DOC_SINGLE_01"
              xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
              Version="1.0">
    <ns:Owner>
        <ns:FSRAR_ID>3463047</ns:FSRAR_ID>
    </ns:Owner>
    <ns:Document>
        <ns:Ticket>
            <tc:TicketDate>2025-06-19T14:12:24.215</tc:TicketDate>
            <tc:Identity>00019</tc:Identity>
            <tc:DocId></tc:DocId>
            <tc:TransportId>030000434308-6635f0eb-d36a-4982-90e2-a1fb1175e548</tc:TransportId>
            <tc:RegID>IMP-0000000044</tc:RegID>
            <tc:DocHash/>
            <tc:DocType>RepImportedProduct_v4</tc:DocType>
            <tc:Result>
                <tc:Conclusion>Accepted</tc:Conclusion>
                <tc:ConclusionDate>2025-06-19T14:12:24.215</tc:ConclusionDate>
                <tc:Comments>Документ успешно принят системой на обработку.</tc:Comments>
            </tc:Result>
        </ns:Ticket>
    </ns:Document>
</ns:Documents>


2025-06-19 14:12:24,237 DEBUG [] [PollThread] = insert 1 rows
2025-06-19 14:12:24,237 DEBUG [] [PollThread] = INSERT INTO outbox.meta (dtype, fsrarid, uri, ts)
    VALUES (?, ?, ?, ?)

2025-06-19 14:12:24,238 DEBUG [] [PollThread] = ticket 30000434308 1081fac3-6454-42e7-bf0e-e7838c40ea8c 2025-06-19T14:12:24.215+0300
2025-06-19 14:12:24,243 DEBUG [] [PollThread] = insert 1 rows
2025-06-19 14:12:24,247 DEBUG [] [PollThread] = {"date":"2025-06-05","uri":"030000434308-6635f0eb-d36a-4982-90e2-a1fb1175e548","type":"repimportedproduct_v4","DocId":"IMP-0000000044"}
2025-06-19 14:12:24,255 DEBUG [] [PollThread] = Success finish
2025-06-19 14:12:24,255 INFO [] [PollThread] = End processing. 283 ms
2025-06-19 14:12:24,255 DEBUG [] [PollThread] = repeat()
2025-06-19 14:12:24,255 DEBUG [] [PollThread] = repeatEnabled:true
2025-06-19 14:12:24,255 DEBUG [] [PollThread] = repeatRecords size:0
2025-06-19 14:12:24,255 DEBUG [] [PollThread] = records is empty
2025-06-19 14:12:24,259 DEBUG [] [PollThread] = commitSync()

</pre>
}}
{{collapse(Часть лога)
<pre>
2025-06-19 14:12:24,154 DEBUG [] [PollThread] = find rule:DocTypeCode[docType=DocType{type='repimportedproduct_v4', num='46', ticketDocName='RepImportedProduct_v4'}, code=daterange] Rule[code=daterange, mode=SKIP, start=Дата, указанная отправителем в документе, может отличаться от даты подачи документа в ЕГАИС на три дня в большую или меньшую сторону (с учетом часовых поясов), reject=Дата документа (%s) отличается от текущей более чем на три дня, confirm=Проверка пройдена]
2025-06-19 14:12:24,154 DEBUG [] [PollThread] = skip:daterange
</pre>
}}
*Полученный результат: Проверка определилась, статус прохождения проверки проставился корректно - УСПЕХ*
## warn {{collapse(БД)
<pre>
|id |document_name_format |document_format_version|check_code|date_begin|date_end  |ordernum|service_code|check_action|
|---|---------------------|-----------------------|----------|----------|----------|--------|------------|------------|
|73 |repimportedproduct_v4|4                      |daterange |2025-02-20|2050-02-20|2       |inspector   |warning     |

</pre>
}}
{{collapse(Полный лог)
<pre>
2025-06-19 14:14:25,443 DEBUG [] [GtdPollThread] = repeatRecords size:0
2025-06-19 14:14:25,443 DEBUG [] [GtdPollThread] = records is empty
2025-06-19 14:14:25,446 DEBUG [] [PollThread] = commitSync()
2025-06-19 14:14:25,448 DEBUG [] [GtdPollThread] = commitSync()
2025-06-19 14:14:26,344 DEBUG [] [PollThread] = poll:1
2025-06-19 14:14:26,344 DEBUG [] [PollThread] = consume. key:[null] value:[{"type":"repimportedproduct_v4","uri":"030000434308-6635f0eb-d36a-4982-90e2-a1fb1175e549","fsrarid":"030000434308","date":"2025-06-05","timezone":"+03:00","inn":"7841051711","kpp":""}] offset:[20749] topic:[confirmed])
2025-06-19 14:14:26,347 INFO [] [PollThread] = Start processing.
2025-06-19 14:14:26,394 DEBUG [] [PollThread] = Для получения файла используем БД
2025-06-19 14:14:26,394 DEBUG [] [PollThread] = Loading data by uri: 6635f0eb-d36a-4982-90e2-a1fb1175e549
2025-06-19 14:14:26,394 DEBUG [] [PollThread] = SELECT filedata FROM filedata.inboxdata
WHERE uri=?
ORDER BY id

2025-06-19 14:14:26,448 DEBUG [] [GtdPollThread] = poll:0
2025-06-19 14:14:26,448 DEBUG [] [GtdPollThread] = repeat()
2025-06-19 14:14:26,448 DEBUG [] [GtdPollThread] = repeatEnabled:true
2025-06-19 14:14:26,448 DEBUG [] [GtdPollThread] = repeatRecords size:0
2025-06-19 14:14:26,448 DEBUG [] [GtdPollThread] = records is empty
2025-06-19 14:14:26,452 DEBUG [] [GtdPollThread] = commitSync()
2025-06-19 14:14:26,458 DEBUG [] [PollThread] = Doc type:DocType{type='repimportedproduct_v4', num='46', ticketDocName='RepImportedProduct_v4'} date:2025-06-15 number:00019
2025-06-19 14:14:26,458 DEBUG [] [PollThread] = 030000434308-6635f0eb-d36a-4982-90e2-a1fb1175e549
2025-06-19 14:14:26,458 DEBUG [] [PollThread] = Load:64 ms
2025-06-19 14:14:26,461 DEBUG [] [PollThread] = checkExist:repimportedproduct_v4
2025-06-19 14:14:26,470 DEBUG [] [PollThread] = find rule:DocTypeCode[docType=DocType{type='repimportedproduct_v4', num='46', ticketDocName='RepImportedProduct_v4'}, code=doubles] Rule[code=doubles, mode=ERROR, start=Проверка документа на повтор, reject=Документ с номером %s и датой %s уже зафиксирован в системе, confirm=Проверка пройдена]
2025-06-19 14:14:26,471 DEBUG [] [PollThread] = existRegistryDoc [030000434308] [repimportedproduct_v4] [00019] [2025-06-15]
2025-06-19 14:14:26,471 DEBUG [] [PollThread] = SELECT 1
FROM
  registry.documents
WHERE
  fsrarid = ?
  AND dtype = ?
  AND client_number = ?
  AND dt = ?
LIMIT 1

2025-06-19 14:14:26,478 DEBUG [] [PollThread] = 30000434308 repimportedproduct_v4 00019 2025-06-15
2025-06-19 14:14:26,486 DEBUG [] [PollThread] = docHash: ee7ca9c9cea945b74996e9676c841644
2025-06-19 14:14:26,490 DEBUG [] [PollThread] = set docHash ee7ca9c9cea945b74996e9676c841644 to redis
2025-06-19 14:14:26,490 DEBUG [] [PollThread] = checkDayShift:repimportedproduct_v4
2025-06-19 14:14:26,491 DEBUG [] [PollThread] = find rule:DocTypeCode[docType=DocType{type='repimportedproduct_v4', num='46', ticketDocName='RepImportedProduct_v4'}, code=daterange] Rule[code=daterange, mode=WARNING, start=Дата, указанная отправителем в документе, может отличаться от даты подачи документа в ЕГАИС на три дня в большую или меньшую сторону (с учетом часовых поясов), reject=Дата документа (%s) отличается от текущей более чем на три дня, confirm=Проверка пройдена]
2025-06-19 14:14:26,491 DEBUG [] [PollThread] = CheckDayShift. date:2025-06-15
2025-06-19 14:14:26,493 DEBUG [] [PollThread] = docDate:2025-06-15 currentDate:2025-06-19
2025-06-19 14:14:26,494 DEBUG [] [PollThread] = betweenDays:-4 
2025-06-19 14:14:26,494 DEBUG [] [PollThread] = warning:{}
ru.centerinform.svs.insp.doc.HandleException: Документ от организации 030000434308 номер 00019 с датой 2025-06-15. Отклонение даты документа от текущей даты превышает трое суток.
	at ru.centerinform.svs.insp.doc.checker.Checker.ex(Checker.java:635) ~[insp-3.27.0.jar:?]
	at ru.centerinform.svs.insp.doc.checker.Checker.checkDayShiftImpl(Checker.java:207) ~[insp-3.27.0.jar:?]
	at ru.centerinform.svs.insp.doc.checker.Checker.lambda$checkDayShift$4(Checker.java:198) ~[insp-3.27.0.jar:?]
	at ru.centerinform.svs.insp.doc.checker.Checker.check(Checker.java:97) ~[insp-3.27.0.jar:?]
	at ru.centerinform.svs.insp.doc.checker.Checker.checkDayShift(Checker.java:198) ~[insp-3.27.0.jar:?]
	at ru.centerinform.svs.insp.doc.ri.RIHandler.check(RIHandler.java:63) ~[insp-3.27.0.jar:?]
	at ru.centerinform.svs.insp.doc.ri.RIHandler.handle(RIHandler.java:50) ~[insp-3.27.0.jar:?]
	at ru.centerinform.svs.insp.InspMessageHandler.handleImpl(InspMessageHandler.java:99) ~[insp-3.27.0.jar:?]
	at ru.centerinform.svs.insp.InspMessageHandler.handle(InspMessageHandler.java:76) ~[insp-3.27.0.jar:?]
	at ru.centerinform.svs.insp.kafka.Consumption.poll0(Consumption.java:223) ~[insp-3.27.0.jar:?]
	at ru.centerinform.svs.insp.kafka.Consumption.poll(Consumption.java:93) ~[insp-3.27.0.jar:?]
	at ru.centerinform.svs.insp.kafka.PollThread.run(PollThread.java:121) ~[insp-3.27.0.jar:?]
2025-06-19 14:14:26,494 DEBUG [] [PollThread] = docDate:2025-06-15 
2025-06-19 14:14:26,495 DEBUG [] [PollThread] = importedDate:2025-06-15 
2025-06-19 14:14:26,495 DEBUG [] [PollThread] = betweenDays:0
2025-06-19 14:14:26,495 DEBUG [] [PollThread] = checkShipper:repimportedproduct_v4
2025-06-19 14:14:26,495 DEBUG [] [PollThread] = find rule:DocTypeCode[docType=DocType{type='repimportedproduct_v4', num='46', ticketDocName='RepImportedProduct_v4'}, code=senderproducer] Rule[code=senderproducer, mode=ERROR, start=Отправитель отчета о производстве должен совпадать с производителем продукции, указанным в документе., reject=СИО отправителя документа не соответствует СИО производителя продукции, confirm=Проверка пройдена]
2025-06-19 14:14:26,495 DEBUG [] [PollThread] = checkQuantityFormat:DocType{type='repimportedproduct_v4', num='46', ticketDocName='RepImportedProduct_v4'}
2025-06-19 14:14:26,496 DEBUG [] [PollThread] = find rule:DocTypeCode[docType=DocType{type='repimportedproduct_v4', num='46', ticketDocName='RepImportedProduct_v4'}, code=quantity] Rule[code=quantity, mode=ERROR, start=Количество должно быть больше нуля, если значение «isUnpacked» - «0», проверяем что Quantity - целое число, reject=Значение количества продукции с кодом %s не соответствует формату, confirm=Проверка пройдена]
2025-06-19 14:14:26,496 DEBUG [] [PollThread] = find rule:DocTypeCode[docType=DocType{type='repimportedproduct_v4', num='46', ticketDocName='RepImportedProduct_v4'}, code=product] Rule[code=product, mode=WARNING, start=В документах ввода в оборот может быть указана только продукция, предварительно зарегистрированная во ФРАП и имеющая код ЕГАИС, reject=Продукция с кодами %s не зарегистрирована в ЕГАИС, confirm=Проверка пройдена]
2025-06-19 14:14:26,496 DEBUG [] [PollThread] = enter to checkLicense.
2025-06-19 14:14:26,496 DEBUG [] [PollThread] = selectFromNsiProducts [[0300004343080000007]]
2025-06-19 14:14:26,497 DEBUG [] [PollThread] = SELECT
  pt.code_egais AS ProductType_Code,
  p.alc_code,
  p.country_id AS Country_Code,
  p.importer_fsrar_id AS Importer_OwnerID,
  pt.product_group_code AS ProductVid_Code,
  p.is_unpacked AS isUnpacked,
  p.producer_fsrar_id AS Owner_ID
FROM
  "references".product_snapshot p
  INNER JOIN "references".product_type pt ON pt.id = p.product_type_id
WHERE
  alc_code IN (
?)
2025-06-19 14:14:26,507 DEBUG [] [PollThread] = finish selectFromNsiProducts. size:[1]
2025-06-19 14:14:26,507 DEBUG [] [PollThread] = isKfk() fsrarId = [030000434308]
2025-06-19 14:14:26,507 DEBUG [] [PollThread] = SELECT 1
FROM
  "references".org_snapshot t
WHERE
  t.fsrar_id = ?
  AND length(t.inn) <> 10

2025-06-19 14:14:26,512 DEBUG [] [PollThread] = result:false
2025-06-19 14:14:26,512 DEBUG [] [PollThread] = extp [[28015]]
2025-06-19 14:14:26,512 DEBUG [] [PollThread] =   SELECT
    ptp.code AS ExclusionType,
    pt.code_egais AS ProductType_Code
  FROM
    "references".product_type pt
    JOIN subref.product_type_props_lnk ptpl ON ptpl.product_type_id = pt.id
    JOIN subref.product_type_props ptp ON ptp.id = ptpl.product_type_props_id
  WHERE
    ptpl.is_active = true
    AND pt.code_egais IN  (
?)
2025-06-19 14:14:26,517 DEBUG [] [PollThread] = checkLic [[28015]]
2025-06-19 14:14:26,517 DEBUG [] [PollThread] = SELECT
  COUNT(ptpl.id) AS count_id
FROM
  "references".product_type pt
  JOIN subref.product_type_props_lnk ptpl ON ptpl.product_type_id = pt.id
  JOIN subref.product_type_props ptp ON ptp.id = ptpl.product_type_props_id
WHERE
  ptp.code = 'UnLicense'
  AND pt.code_egais IN (
?)
2025-06-19 14:14:26,522 DEBUG [] [PollThread] = productTypeCodes:1
2025-06-19 14:14:26,523 DEBUG [] [PollThread] = selectFromClientsPeriodLicense [030000434308], [2025-06-15]
2025-06-19 14:14:26,523 DEBUG [] [PollThread] = SELECT 1
FROM
  registries.registry r
WHERE
  r.fsrar_id = ?
  AND ? BETWEEN r.inclusion_date
  AND COALESCE(
    r.expiration_date, CURRENT_DATE + INTERVAL '30 days'
  )
  AND (
    r.row_validity_end IS NULL
    OR r.row_validity_end < CURRENT_TIMESTAMP
  )

2025-06-19 14:14:26,527 DEBUG [] [PollThread] = exist:true 
2025-06-19 14:14:26,527 DEBUG [] [PollThread] = enter to checkUnMarked
2025-06-19 14:14:26,528 DEBUG [] [PollThread] = checkcUnionMembership [112] 
2025-06-19 14:14:26,528 DEBUG [] [PollThread] = SELECT 1
FROM
  subref.country_unions_lnk cul
  JOIN subref.country_unions cu ON cu.id = cul.country_unions_id
  AND cu.code = 'ЕАЭС'
WHERE
  cul.country_code = ?

2025-06-19 14:14:26,551 DEBUG [] [PollThread] = gen:IMP-0000000045
2025-06-19 14:14:26,553 DEBUG [] [PollThread] = Success
2025-06-19 14:14:26,553 DEBUG [] [PollThread] = Create ticket
2025-06-19 14:14:26,554 DEBUG [] [PollThread] = docUri:030000434308-6635f0eb-d36a-4982-90e2-a1fb1175e549
2025-06-19 14:14:26,554 DEBUG [] [PollThread] = date:2025-06-19T14:14:26.554771348
2025-06-19 14:14:26,555 DEBUG [] [PollThread] = ticketUri:030000434308-8ae5f34b-96dc-4048-9f56-0aee7df95cac
2025-06-19 14:14:26,555 DEBUG [] [PollThread] = xmlTransportId:030000434308-6635f0eb-d36a-4982-90e2-a1fb1175e549
2025-06-19 14:14:26,556 DEBUG [] [PollThread] = set warning comments: Дата документа (2025-06-15) отличается от текущей более чем на три дня
2025-06-19 14:14:26,556 DEBUG [] [PollThread] = templatePath:xml/ticket.xml
2025-06-19 14:14:26,568 DEBUG [] [PollThread] = <?xml version="1.0" encoding="utf-8"?>
<ns:Documents xmlns:tc="http://fsrar.ru/WEGAIS/Ticket"
              xmlns:oref="http://fsrar.ru/WEGAIS/ClientRef"
              xmlns:ns="http://fsrar.ru/WEGAIS/WB_DOC_SINGLE_01"
              xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
              Version="1.0">
    <ns:Owner>
        <ns:FSRAR_ID>3463047</ns:FSRAR_ID>
    </ns:Owner>
    <ns:Document>
        <ns:Ticket>
            <tc:TicketDate>2025-06-19T14:14:26.554</tc:TicketDate>
            <tc:Identity>00019</tc:Identity>
            <tc:DocId></tc:DocId>
            <tc:TransportId>030000434308-6635f0eb-d36a-4982-90e2-a1fb1175e549</tc:TransportId>
            <tc:RegID>IMP-0000000045</tc:RegID>
            <tc:DocHash/>
            <tc:DocType>RepImportedProduct_v4</tc:DocType>
            <tc:Result>
                <tc:Conclusion>Accepted</tc:Conclusion>
                <tc:ConclusionDate>2025-06-19T14:14:26.554</tc:ConclusionDate>
                <tc:Comments>Документ успешно принят системой на обработку. Дата документа (2025-06-15) отличается от текущей более чем на три дня</tc:Comments>
            </tc:Result>
        </ns:Ticket>
    </ns:Document>
</ns:Documents>


2025-06-19 14:14:26,568 DEBUG [] [PollThread] = Для сохранения квитанции используем БД
2025-06-19 14:14:26,570 DEBUG [] [PollThread] = save ticket to DB: Ticket{xml='<?xml version="1.0" encoding="utf-8"?>
<ns:Documents xmlns:tc="http://fsrar.ru/WEGAIS/Ticket"
              xmlns:oref="http://fsrar.ru/WEGAIS/ClientRef"
              xmlns:ns="http://fsrar.ru/WEGAIS/WB_DOC_SINGLE_01"
              xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
              Version="1.0">
    <ns:Owner>
        <ns:FSRAR_ID>3463047</ns:FSRAR_ID>
    </ns:Owner>
    <ns:Document>
        <ns:Ticket>
            <tc:TicketDate>2025-06-19T14:14:26.554</tc:TicketDate>
            <tc:Identity>00019</tc:Identity>
            <tc:DocId></tc:DocId>
            <tc:TransportId>030000434308-6635f0eb-d36a-4982-90e2-a1fb1175e549</tc:TransportId>
            <tc:RegID>IMP-0000000045</tc:RegID>
            <tc:DocHash/>
            <tc:DocType>RepImportedProduct_v4</tc:DocType>
            <tc:Result>
                <tc:Conclusion>Accepted</tc:Conclusion>
                <tc:ConclusionDate>2025-06-19T14:14:26.554</tc:ConclusionDate>
                <tc:Comments>Документ успешно принят системой на обработку. Дата документа (2025-06-15) отличается от текущей более чем на три дня</tc:Comments>
            </tc:Result>
        </ns:Ticket>
    </ns:Document>
</ns:Documents>

', nowDateTime=2025-06-19T14:14:26.554771348, ticketDate='2025-06-19', ticketDateTime='2025-06-19T14:14:26.554', docUri='030000434308-6635f0eb-d36a-4982-90e2-a1fb1175e549', ticketUri='030000434308-8ae5f34b-96dc-4048-9f56-0aee7df95cac', ticketUUID='8ae5f34b-96dc-4048-9f56-0aee7df95cac', fsrarId='030000434308', identity='00019', templater=ru.centerinform.svs.insp.Templater@75e012f3, type=DocType{type='repimportedproduct_v4', num='46', ticketDocName='RepImportedProduct_v4'}}
2025-06-19 14:14:26,570 DEBUG [] [PollThread] = INSERT INTO filedata.outboxdata
    (uri, inboxuri, filedata)
    VALUES(?, ?, ?)

2025-06-19 14:14:26,570 DEBUG [] [PollThread] = 8ae5f34b-96dc-4048-9f56-0aee7df95cac 6635f0eb-d36a-4982-90e2-a1fb1175e549 <?xml version="1.0" encoding="utf-8"?>
<ns:Documents xmlns:tc="http://fsrar.ru/WEGAIS/Ticket"
              xmlns:oref="http://fsrar.ru/WEGAIS/ClientRef"
              xmlns:ns="http://fsrar.ru/WEGAIS/WB_DOC_SINGLE_01"
              xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
              Version="1.0">
    <ns:Owner>
        <ns:FSRAR_ID>3463047</ns:FSRAR_ID>
    </ns:Owner>
    <ns:Document>
        <ns:Ticket>
            <tc:TicketDate>2025-06-19T14:14:26.554</tc:TicketDate>
            <tc:Identity>00019</tc:Identity>
            <tc:DocId></tc:DocId>
            <tc:TransportId>030000434308-6635f0eb-d36a-4982-90e2-a1fb1175e549</tc:TransportId>
            <tc:RegID>IMP-0000000045</tc:RegID>
            <tc:DocHash/>
            <tc:DocType>RepImportedProduct_v4</tc:DocType>
            <tc:Result>
                <tc:Conclusion>Accepted</tc:Conclusion>
                <tc:ConclusionDate>2025-06-19T14:14:26.554</tc:ConclusionDate>
                <tc:Comments>Документ успешно принят системой на обработку. Дата документа (2025-06-15) отличается от текущей более чем на три дня</tc:Comments>
            </tc:Result>
        </ns:Ticket>
    </ns:Document>
</ns:Documents>


2025-06-19 14:14:26,576 DEBUG [] [PollThread] = insert 1 rows
2025-06-19 14:14:26,576 DEBUG [] [PollThread] = INSERT INTO outbox.meta (dtype, fsrarid, uri, ts)
    VALUES (?, ?, ?, ?)

2025-06-19 14:14:26,577 DEBUG [] [PollThread] = ticket 30000434308 8ae5f34b-96dc-4048-9f56-0aee7df95cac 2025-06-19T14:14:26.554+0300
2025-06-19 14:14:26,582 DEBUG [] [PollThread] = insert 1 rows
2025-06-19 14:14:26,586 DEBUG [] [PollThread] = {"date":"2025-06-05","uri":"030000434308-6635f0eb-d36a-4982-90e2-a1fb1175e549","type":"repimportedproduct_v4","DocId":"IMP-0000000045"}
2025-06-19 14:14:26,601 DEBUG [] [PollThread] = Success finish
2025-06-19 14:14:26,603 INFO [] [PollThread] = End processing. 254 ms
2025-06-19 14:14:26,603 DEBUG [] [PollThread] = repeat()
2025-06-19 14:14:26,604 DEBUG [] [PollThread] = repeatEnabled:true
2025-06-19 14:14:26,604 DEBUG [] [PollThread] = repeatRecords size:0
2025-06-19 14:14:26,604 DEBUG [] [PollThread] = records is empty
2025-06-19 14:14:26,612 DEBUG [] [PollThread] = commitSync()
2025-06-19 14:14:27,453 DEBUG [] [GtdPollThread] = poll:0

</pre>
}}
{{collapse(Часть лога)
<pre>

2025-06-19 14:14:26,491 DEBUG [] [PollThread] = find rule:DocTypeCode[docType=DocType{type='repimportedproduct_v4', num='46', ticketDocName='RepImportedProduct_v4'}, code=daterange] Rule[code=daterange, mode=WARNING, start=Дата, указанная отправителем в документе, может отличаться от даты подачи документа в ЕГАИС на три дня в большую или меньшую сторону (с учетом часовых поясов), reject=Дата документа (%s) отличается от текущей более чем на три дня, confirm=Проверка пройдена]
2025-06-19 14:14:26,491 DEBUG [] [PollThread] = CheckDayShift. date:2025-06-15
2025-06-19 14:14:26,493 DEBUG [] [PollThread] = docDate:2025-06-15 currentDate:2025-06-19
2025-06-19 14:14:26,494 DEBUG [] [PollThread] = betweenDays:-4 
2025-06-19 14:14:26,494 DEBUG [] [PollThread] = warning:{}
ru.centerinform.svs.insp.doc.HandleException: Документ от организации 030000434308 номер 00019 с датой 2025-06-15. Отклонение даты документа от текущей даты превышает трое суток.

2025-06-19 14:14:26,568 DEBUG [] [PollThread] = <?xml version="1.0" encoding="utf-8"?>
<ns:Documents xmlns:tc="http://fsrar.ru/WEGAIS/Ticket"
              xmlns:oref="http://fsrar.ru/WEGAIS/ClientRef"
              xmlns:ns="http://fsrar.ru/WEGAIS/WB_DOC_SINGLE_01"
              xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
              Version="1.0">
    <ns:Owner>
        <ns:FSRAR_ID>3463047</ns:FSRAR_ID>
    </ns:Owner>
    <ns:Document>
        <ns:Ticket>
            <tc:TicketDate>2025-06-19T14:14:26.554</tc:TicketDate>
            <tc:Identity>00019</tc:Identity>
            <tc:DocId></tc:DocId>
            <tc:TransportId>030000434308-6635f0eb-d36a-4982-90e2-a1fb1175e549</tc:TransportId>
            <tc:RegID>IMP-0000000045</tc:RegID>
            <tc:DocHash/>
            <tc:DocType>RepImportedProduct_v4</tc:DocType>
            <tc:Result>
                <tc:Conclusion>Accepted</tc:Conclusion>
                <tc:ConclusionDate>2025-06-19T14:14:26.554</tc:ConclusionDate>
                <tc:Comments>Документ успешно принят системой на обработку. Дата документа (2025-06-15) отличается от текущей более чем на три дня</tc:Comments>
            </tc:Result>
        </ns:Ticket>
    </ns:Document>
</ns:Documents>

</pre>
}}
*Полученный результат: Проверка определилась, статус прохождения проверки проставился корректно, тикет успешный с предупреждением - УСПЕХ*
## error {{collapse(БД)
<pre>
|id |document_name_format |document_format_version|check_code|date_begin|date_end  |ordernum|service_code|check_action|
|---|---------------------|-----------------------|----------|----------|----------|--------|------------|------------|
|73 |repimportedproduct_v4|4                      |daterange |2025-02-20|2050-02-20|2       |inspector   |error       |

</pre>
}}
{{collapse(Полный лог)
<pre>
2025-06-19 14:21:57,697 DEBUG [] [GtdPollThread] = repeat()
2025-06-19 14:21:57,697 DEBUG [] [GtdPollThread] = repeatEnabled:true
2025-06-19 14:21:57,697 DEBUG [] [GtdPollThread] = repeatRecords size:0
2025-06-19 14:21:57,697 DEBUG [] [GtdPollThread] = records is empty
2025-06-19 14:21:57,700 DEBUG [] [GtdPollThread] = commitSync()
2025-06-19 14:21:58,274 DEBUG [] [PollThread] = poll:0
2025-06-19 14:21:58,274 DEBUG [] [PollThread] = repeat()
2025-06-19 14:21:58,274 DEBUG [] [PollThread] = repeatEnabled:true
2025-06-19 14:21:58,274 DEBUG [] [PollThread] = repeatRecords size:0
2025-06-19 14:21:58,274 DEBUG [] [PollThread] = records is empty
2025-06-19 14:21:58,278 DEBUG [] [PollThread] = commitSync()
2025-06-19 14:21:58,388 DEBUG [] [PollThread] = poll:1
2025-06-19 14:21:58,389 DEBUG [] [PollThread] = consume. key:[null] value:[{"type":"repimportedproduct_v4","uri":"030000434308-6635f0eb-d36a-4982-90e2-a1fb1175e550","fsrarid":"030000434308","date":"2025-06-05","timezone":"+03:00","inn":"7841051711","kpp":""}] offset:[20750] topic:[confirmed])
2025-06-19 14:21:58,393 INFO [] [PollThread] = Start processing.
2025-06-19 14:21:58,449 DEBUG [] [PollThread] = Для получения файла используем БД
2025-06-19 14:21:58,450 DEBUG [] [PollThread] = Loading data by uri: 6635f0eb-d36a-4982-90e2-a1fb1175e550
2025-06-19 14:21:58,450 DEBUG [] [PollThread] = SELECT filedata FROM filedata.inboxdata
WHERE uri=?
ORDER BY id

2025-06-19 14:21:58,524 DEBUG [] [PollThread] = Doc type:DocType{type='repimportedproduct_v4', num='46', ticketDocName='RepImportedProduct_v4'} date:2025-06-15 number:00019
2025-06-19 14:21:58,524 DEBUG [] [PollThread] = 030000434308-6635f0eb-d36a-4982-90e2-a1fb1175e550
2025-06-19 14:21:58,524 DEBUG [] [PollThread] = Load:75 ms
2025-06-19 14:21:58,528 DEBUG [] [PollThread] = checkExist:repimportedproduct_v4
2025-06-19 14:21:58,537 DEBUG [] [PollThread] = find rule:DocTypeCode[docType=DocType{type='repimportedproduct_v4', num='46', ticketDocName='RepImportedProduct_v4'}, code=doubles] Rule[code=doubles, mode=ERROR, start=Проверка документа на повтор, reject=Документ с номером %s и датой %s уже зафиксирован в системе, confirm=Проверка пройдена]
2025-06-19 14:21:58,538 DEBUG [] [PollThread] = existRegistryDoc [030000434308] [repimportedproduct_v4] [00019] [2025-06-15]
2025-06-19 14:21:58,538 DEBUG [] [PollThread] = SELECT 1
FROM
  registry.documents
WHERE
  fsrarid = ?
  AND dtype = ?
  AND client_number = ?
  AND dt = ?
LIMIT 1

2025-06-19 14:21:58,547 DEBUG [] [PollThread] = 30000434308 repimportedproduct_v4 00019 2025-06-15
2025-06-19 14:21:58,560 DEBUG [] [PollThread] = docHash: c24ce68e91b171f864aac47866f8f3a8
2025-06-19 14:21:58,568 DEBUG [] [PollThread] = set docHash c24ce68e91b171f864aac47866f8f3a8 to redis
2025-06-19 14:21:58,568 DEBUG [] [PollThread] = checkDayShift:repimportedproduct_v4
2025-06-19 14:21:58,569 DEBUG [] [PollThread] = find rule:DocTypeCode[docType=DocType{type='repimportedproduct_v4', num='46', ticketDocName='RepImportedProduct_v4'}, code=daterange] Rule[code=daterange, mode=ERROR, start=Дата, указанная отправителем в документе, может отличаться от даты подачи документа в ЕГАИС на три дня в большую или меньшую сторону (с учетом часовых поясов), reject=Дата документа (%s) отличается от текущей более чем на три дня, confirm=Проверка пройдена]
2025-06-19 14:21:58,569 DEBUG [] [PollThread] = CheckDayShift. date:2025-06-15
2025-06-19 14:21:58,572 DEBUG [] [PollThread] = docDate:2025-06-15 currentDate:2025-06-19
2025-06-19 14:21:58,572 DEBUG [] [PollThread] = betweenDays:-4 
2025-06-19 14:21:58,573 DEBUG [] [PollThread] = error:{}
ru.centerinform.svs.insp.doc.HandleException: Документ от организации 030000434308 номер 00019 с датой 2025-06-15. Отклонение даты документа от текущей даты превышает трое суток.
	at ru.centerinform.svs.insp.doc.checker.Checker.ex(Checker.java:635) ~[insp-3.27.0.jar:?]
	at ru.centerinform.svs.insp.doc.checker.Checker.checkDayShiftImpl(Checker.java:207) ~[insp-3.27.0.jar:?]
	at ru.centerinform.svs.insp.doc.checker.Checker.lambda$checkDayShift$4(Checker.java:198) ~[insp-3.27.0.jar:?]
	at ru.centerinform.svs.insp.doc.checker.Checker.check(Checker.java:109) ~[insp-3.27.0.jar:?]
	at ru.centerinform.svs.insp.doc.checker.Checker.checkDayShift(Checker.java:198) ~[insp-3.27.0.jar:?]
	at ru.centerinform.svs.insp.doc.ri.RIHandler.check(RIHandler.java:63) ~[insp-3.27.0.jar:?]
	at ru.centerinform.svs.insp.doc.ri.RIHandler.handle(RIHandler.java:50) ~[insp-3.27.0.jar:?]
	at ru.centerinform.svs.insp.InspMessageHandler.handleImpl(InspMessageHandler.java:99) ~[insp-3.27.0.jar:?]
	at ru.centerinform.svs.insp.InspMessageHandler.handle(InspMessageHandler.java:76) ~[insp-3.27.0.jar:?]
	at ru.centerinform.svs.insp.kafka.Consumption.poll0(Consumption.java:223) ~[insp-3.27.0.jar:?]
	at ru.centerinform.svs.insp.kafka.Consumption.poll(Consumption.java:93) ~[insp-3.27.0.jar:?]
	at ru.centerinform.svs.insp.kafka.PollThread.run(PollThread.java:121) ~[insp-3.27.0.jar:?]
2025-06-19 14:21:58,573 ERROR [] [PollThread] = handle error
ru.centerinform.svs.insp.doc.HandleException: Документ от организации 030000434308 номер 00019 с датой 2025-06-15. Отклонение даты документа от текущей даты превышает трое суток.
	at ru.centerinform.svs.insp.doc.checker.Checker.ex(Checker.java:635) ~[insp-3.27.0.jar:?]
	at ru.centerinform.svs.insp.doc.checker.Checker.checkDayShiftImpl(Checker.java:207) ~[insp-3.27.0.jar:?]
	at ru.centerinform.svs.insp.doc.checker.Checker.lambda$checkDayShift$4(Checker.java:198) ~[insp-3.27.0.jar:?]
	at ru.centerinform.svs.insp.doc.checker.Checker.check(Checker.java:109) ~[insp-3.27.0.jar:?]
	at ru.centerinform.svs.insp.doc.checker.Checker.checkDayShift(Checker.java:198) ~[insp-3.27.0.jar:?]
	at ru.centerinform.svs.insp.doc.ri.RIHandler.check(RIHandler.java:63) ~[insp-3.27.0.jar:?]
	at ru.centerinform.svs.insp.doc.ri.RIHandler.handle(RIHandler.java:50) ~[insp-3.27.0.jar:?]
	at ru.centerinform.svs.insp.InspMessageHandler.handleImpl(InspMessageHandler.java:99) ~[insp-3.27.0.jar:?]
	at ru.centerinform.svs.insp.InspMessageHandler.handle(InspMessageHandler.java:76) ~[insp-3.27.0.jar:?]
	at ru.centerinform.svs.insp.kafka.Consumption.poll0(Consumption.java:223) ~[insp-3.27.0.jar:?]
	at ru.centerinform.svs.insp.kafka.Consumption.poll(Consumption.java:93) ~[insp-3.27.0.jar:?]
	at ru.centerinform.svs.insp.kafka.PollThread.run(PollThread.java:121) ~[insp-3.27.0.jar:?]
2025-06-19 14:21:58,574 ERROR [] [PollThread] = Fail
ru.centerinform.svs.insp.doc.HandleException: Документ от организации 030000434308 номер 00019 с датой 2025-06-15. Отклонение даты документа от текущей даты превышает трое суток.
	at ru.centerinform.svs.insp.doc.checker.Checker.ex(Checker.java:635) ~[insp-3.27.0.jar:?]
	at ru.centerinform.svs.insp.doc.checker.Checker.checkDayShiftImpl(Checker.java:207) ~[insp-3.27.0.jar:?]
	at ru.centerinform.svs.insp.doc.checker.Checker.lambda$checkDayShift$4(Checker.java:198) ~[insp-3.27.0.jar:?]
	at ru.centerinform.svs.insp.doc.checker.Checker.check(Checker.java:109) ~[insp-3.27.0.jar:?]
	at ru.centerinform.svs.insp.doc.checker.Checker.checkDayShift(Checker.java:198) ~[insp-3.27.0.jar:?]
	at ru.centerinform.svs.insp.doc.ri.RIHandler.check(RIHandler.java:63) ~[insp-3.27.0.jar:?]
	at ru.centerinform.svs.insp.doc.ri.RIHandler.handle(RIHandler.java:50) ~[insp-3.27.0.jar:?]
	at ru.centerinform.svs.insp.InspMessageHandler.handleImpl(InspMessageHandler.java:99) ~[insp-3.27.0.jar:?]
	at ru.centerinform.svs.insp.InspMessageHandler.handle(InspMessageHandler.java:76) ~[insp-3.27.0.jar:?]
	at ru.centerinform.svs.insp.kafka.Consumption.poll0(Consumption.java:223) ~[insp-3.27.0.jar:?]
	at ru.centerinform.svs.insp.kafka.Consumption.poll(Consumption.java:93) ~[insp-3.27.0.jar:?]
	at ru.centerinform.svs.insp.kafka.PollThread.run(PollThread.java:121) ~[insp-3.27.0.jar:?]
2025-06-19 14:21:58,574 DEBUG [] [PollThread] = Remove docHash:c24ce68e91b171f864aac47866f8f3a8 from redis cache
2025-06-19 14:21:58,577 DEBUG [] [PollThread] = docUri:030000434308-6635f0eb-d36a-4982-90e2-a1fb1175e550
2025-06-19 14:21:58,577 DEBUG [] [PollThread] = date:2025-06-19T14:21:58.577274861
2025-06-19 14:21:58,577 DEBUG [] [PollThread] = ticketUri:030000434308-f3972035-20d8-46e0-90a0-c2df2c74e451
2025-06-19 14:21:58,578 DEBUG [] [PollThread] = xmlTransportId:030000434308-6635f0eb-d36a-4982-90e2-a1fb1175e550
2025-06-19 14:21:58,578 DEBUG [] [PollThread] = set comments: Дата документа (2025-06-15) отличается от текущей более чем на три дня
2025-06-19 14:21:58,578 DEBUG [] [PollThread] = templatePath:xml/ticket.xml
2025-06-19 14:21:58,587 DEBUG [] [PollThread] = <?xml version="1.0" encoding="utf-8"?>
<ns:Documents xmlns:tc="http://fsrar.ru/WEGAIS/Ticket"
              xmlns:oref="http://fsrar.ru/WEGAIS/ClientRef"
              xmlns:ns="http://fsrar.ru/WEGAIS/WB_DOC_SINGLE_01"
              xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
              Version="1.0">
    <ns:Owner>
        <ns:FSRAR_ID>3463047</ns:FSRAR_ID>
    </ns:Owner>
    <ns:Document>
        <ns:Ticket>
            <tc:TicketDate>2025-06-19T14:21:58.577</tc:TicketDate>
            <tc:Identity>00019</tc:Identity>
            <tc:DocId></tc:DocId>
            <tc:TransportId>030000434308-6635f0eb-d36a-4982-90e2-a1fb1175e550</tc:TransportId>
            <tc:RegID></tc:RegID>
            <tc:DocHash/>
            <tc:DocType>RepImportedProduct_v4</tc:DocType>
            <tc:Result>
                <tc:Conclusion>Rejected</tc:Conclusion>
                <tc:ConclusionDate></tc:ConclusionDate>
                <tc:Comments>Дата документа (2025-06-15) отличается от текущей более чем на три дня</tc:Comments>
            </tc:Result>
        </ns:Ticket>
    </ns:Document>
</ns:Documents>


2025-06-19 14:21:58,587 DEBUG [] [PollThread] = Для сохранения квитанции используем БД
2025-06-19 14:21:58,590 DEBUG [] [PollThread] = save ticket to DB: Ticket{xml='<?xml version="1.0" encoding="utf-8"?>
<ns:Documents xmlns:tc="http://fsrar.ru/WEGAIS/Ticket"
              xmlns:oref="http://fsrar.ru/WEGAIS/ClientRef"
              xmlns:ns="http://fsrar.ru/WEGAIS/WB_DOC_SINGLE_01"
              xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
              Version="1.0">
    <ns:Owner>
        <ns:FSRAR_ID>3463047</ns:FSRAR_ID>
    </ns:Owner>
    <ns:Document>
        <ns:Ticket>
            <tc:TicketDate>2025-06-19T14:21:58.577</tc:TicketDate>
            <tc:Identity>00019</tc:Identity>
            <tc:DocId></tc:DocId>
            <tc:TransportId>030000434308-6635f0eb-d36a-4982-90e2-a1fb1175e550</tc:TransportId>
            <tc:RegID></tc:RegID>
            <tc:DocHash/>
            <tc:DocType>RepImportedProduct_v4</tc:DocType>
            <tc:Result>
                <tc:Conclusion>Rejected</tc:Conclusion>
                <tc:ConclusionDate></tc:ConclusionDate>
                <tc:Comments>Дата документа (2025-06-15) отличается от текущей более чем на три дня</tc:Comments>
            </tc:Result>
        </ns:Ticket>
    </ns:Document>
</ns:Documents>

', nowDateTime=2025-06-19T14:21:58.577274861, ticketDate='2025-06-19', ticketDateTime='2025-06-19T14:21:58.577', docUri='030000434308-6635f0eb-d36a-4982-90e2-a1fb1175e550', ticketUri='030000434308-f3972035-20d8-46e0-90a0-c2df2c74e451', ticketUUID='f3972035-20d8-46e0-90a0-c2df2c74e451', fsrarId='030000434308', identity='00019', templater=ru.centerinform.svs.insp.Templater@1fbe30e, type=DocType{type='repimportedproduct_v4', num='46', ticketDocName='RepImportedProduct_v4'}}
2025-06-19 14:21:58,590 DEBUG [] [PollThread] = INSERT INTO filedata.outboxdata
    (uri, inboxuri, filedata)
    VALUES(?, ?, ?)

2025-06-19 14:21:58,590 DEBUG [] [PollThread] = f3972035-20d8-46e0-90a0-c2df2c74e451 6635f0eb-d36a-4982-90e2-a1fb1175e550 <?xml version="1.0" encoding="utf-8"?>
<ns:Documents xmlns:tc="http://fsrar.ru/WEGAIS/Ticket"
              xmlns:oref="http://fsrar.ru/WEGAIS/ClientRef"
              xmlns:ns="http://fsrar.ru/WEGAIS/WB_DOC_SINGLE_01"
              xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
              Version="1.0">
    <ns:Owner>
        <ns:FSRAR_ID>3463047</ns:FSRAR_ID>
    </ns:Owner>
    <ns:Document>
        <ns:Ticket>
            <tc:TicketDate>2025-06-19T14:21:58.577</tc:TicketDate>
            <tc:Identity>00019</tc:Identity>
            <tc:DocId></tc:DocId>
            <tc:TransportId>030000434308-6635f0eb-d36a-4982-90e2-a1fb1175e550</tc:TransportId>
            <tc:RegID></tc:RegID>
            <tc:DocHash/>
            <tc:DocType>RepImportedProduct_v4</tc:DocType>
            <tc:Result>
                <tc:Conclusion>Rejected</tc:Conclusion>
                <tc:ConclusionDate></tc:ConclusionDate>
                <tc:Comments>Дата документа (2025-06-15) отличается от текущей более чем на три дня</tc:Comments>
            </tc:Result>
        </ns:Ticket>
    </ns:Document>
</ns:Documents>


2025-06-19 14:21:58,596 DEBUG [] [PollThread] = insert 1 rows
2025-06-19 14:21:58,596 DEBUG [] [PollThread] = INSERT INTO outbox.meta (dtype, fsrarid, uri, ts)
    VALUES (?, ?, ?, ?)

2025-06-19 14:21:58,597 DEBUG [] [PollThread] = ticket 30000434308 f3972035-20d8-46e0-90a0-c2df2c74e451 2025-06-19T14:21:58.577+0300
2025-06-19 14:21:58,602 DEBUG [] [PollThread] = insert 1 rows
2025-06-19 14:21:58,606 DEBUG [] [PollThread] = Fail finish
2025-06-19 14:21:58,606 INFO [] [PollThread] = End processing. 212 ms
2025-06-19 14:21:58,606 DEBUG [] [PollThread] = repeat()
2025-06-19 14:21:58,606 DEBUG [] [PollThread] = repeatEnabled:true
2025-06-19 14:21:58,606 DEBUG [] [PollThread] = repeatRecords size:0
2025-06-19 14:21:58,606 DEBUG [] [PollThread] = records is empty
2025-06-19 14:21:58,609 DEBUG [] [PollThread] = commitSync()
2025-06-19 14:21:58,701 DEBUG [] [GtdPollThread] = poll:0
2025-06-19 14:21:58,701 DEBUG [] [GtdPollThread] = repeat()
2025-06-19 14:21:58,701 DEBUG [] [GtdPollThread] = repeatEnabled:true

</pre>
}}
{{collapse(Часть лога)
<pre>
2025-06-19 14:21:57,697 DEBUG [] [GtdPollThread] = repeat()
2025-06-19 14:21:57,697 DEBUG [] [GtdPollThread] = repeatEnabled:true
2025-06-19 14:21:57,697 DEBUG [] [GtdPollThread] = repeatRecords size:0
2025-06-19 14:21:57,697 DEBUG [] [GtdPollThread] = records is empty
2025-06-19 14:21:57,700 DEBUG [] [GtdPollThread] = commitSync()
2025-06-19 14:21:58,274 DEBUG [] [PollThread] = poll:0
2025-06-19 14:21:58,274 DEBUG [] [PollThread] = repeat()
2025-06-19 14:21:58,274 DEBUG [] [PollThread] = repeatEnabled:true
2025-06-19 14:21:58,274 DEBUG [] [PollThread] = repeatRecords size:0
2025-06-19 14:21:58,274 DEBUG [] [PollThread] = records is empty
2025-06-19 14:21:58,278 DEBUG [] [PollThread] = commitSync()
2025-06-19 14:21:58,388 DEBUG [] [PollThread] = poll:1
2025-06-19 14:21:58,389 DEBUG [] [PollThread] = consume. key:[null] value:[{"type":"repimportedproduct_v4","uri":"030000434308-6635f0eb-d36a-4982-90e2-a1fb1175e550","fsrarid":"030000434308","date":"2025-06-05","timezone":"+03:00","inn":"7841051711","kpp":""}] offset:[20750] topic:[confirmed])
2025-06-19 14:21:58,393 INFO [] [PollThread] = Start processing.
2025-06-19 14:21:58,449 DEBUG [] [PollThread] = Для получения файла используем БД
2025-06-19 14:21:58,450 DEBUG [] [PollThread] = Loading data by uri: 6635f0eb-d36a-4982-90e2-a1fb1175e550
2025-06-19 14:21:58,450 DEBUG [] [PollThread] = SELECT filedata FROM filedata.inboxdata
WHERE uri=?
ORDER BY id

2025-06-19 14:21:58,524 DEBUG [] [PollThread] = Doc type:DocType{type='repimportedproduct_v4', num='46', ticketDocName='RepImportedProduct_v4'} date:2025-06-15 number:00019
2025-06-19 14:21:58,524 DEBUG [] [PollThread] = 030000434308-6635f0eb-d36a-4982-90e2-a1fb1175e550
2025-06-19 14:21:58,524 DEBUG [] [PollThread] = Load:75 ms
2025-06-19 14:21:58,528 DEBUG [] [PollThread] = checkExist:repimportedproduct_v4
2025-06-19 14:21:58,537 DEBUG [] [PollThread] = find rule:DocTypeCode[docType=DocType{type='repimportedproduct_v4', num='46', ticketDocName='RepImportedProduct_v4'}, code=doubles] Rule[code=doubles, mode=ERROR, start=Проверка документа на повтор, reject=Документ с номером %s и датой %s уже зафиксирован в системе, confirm=Проверка пройдена]
2025-06-19 14:21:58,538 DEBUG [] [PollThread] = existRegistryDoc [030000434308] [repimportedproduct_v4] [00019] [2025-06-15]
2025-06-19 14:21:58,538 DEBUG [] [PollThread] = SELECT 1
FROM
  registry.documents
WHERE
  fsrarid = ?
  AND dtype = ?
  AND client_number = ?
  AND dt = ?
LIMIT 1

2025-06-19 14:21:58,547 DEBUG [] [PollThread] = 30000434308 repimportedproduct_v4 00019 2025-06-15
2025-06-19 14:21:58,560 DEBUG [] [PollThread] = docHash: c24ce68e91b171f864aac47866f8f3a8
2025-06-19 14:21:58,568 DEBUG [] [PollThread] = set docHash c24ce68e91b171f864aac47866f8f3a8 to redis
2025-06-19 14:21:58,568 DEBUG [] [PollThread] = checkDayShift:repimportedproduct_v4
2025-06-19 14:21:58,569 DEBUG [] [PollThread] = find rule:DocTypeCode[docType=DocType{type='repimportedproduct_v4', num='46', ticketDocName='RepImportedProduct_v4'}, code=daterange] Rule[code=daterange, mode=ERROR, start=Дата, указанная отправителем в документе, может отличаться от даты подачи документа в ЕГАИС на три дня в большую или меньшую сторону (с учетом часовых поясов), reject=Дата документа (%s) отличается от текущей более чем на три дня, confirm=Проверка пройдена]
2025-06-19 14:21:58,569 DEBUG [] [PollThread] = CheckDayShift. date:2025-06-15
2025-06-19 14:21:58,572 DEBUG [] [PollThread] = docDate:2025-06-15 currentDate:2025-06-19
2025-06-19 14:21:58,572 DEBUG [] [PollThread] = betweenDays:-4 
2025-06-19 14:21:58,573 DEBUG [] [PollThread] = error:{}
ru.centerinform.svs.insp.doc.HandleException: Документ от организации 030000434308 номер 00019 с датой 2025-06-15. Отклонение даты документа от текущей даты превышает трое суток.
	at ru.centerinform.svs.insp.doc.checker.Checker.ex(Checker.java:635) ~[insp-3.27.0.jar:?]
	at ru.centerinform.svs.insp.doc.checker.Checker.checkDayShiftImpl(Checker.java:207) ~[insp-3.27.0.jar:?]
	at ru.centerinform.svs.insp.doc.checker.Checker.lambda$checkDayShift$4(Checker.java:198) ~[insp-3.27.0.jar:?]
	at ru.centerinform.svs.insp.doc.checker.Checker.check(Checker.java:109) ~[insp-3.27.0.jar:?]
	at ru.centerinform.svs.insp.doc.checker.Checker.checkDayShift(Checker.java:198) ~[insp-3.27.0.jar:?]
	at ru.centerinform.svs.insp.doc.ri.RIHandler.check(RIHandler.java:63) ~[insp-3.27.0.jar:?]
	at ru.centerinform.svs.insp.doc.ri.RIHandler.handle(RIHandler.java:50) ~[insp-3.27.0.jar:?]
	at ru.centerinform.svs.insp.InspMessageHandler.handleImpl(InspMessageHandler.java:99) ~[insp-3.27.0.jar:?]
	at ru.centerinform.svs.insp.InspMessageHandler.handle(InspMessageHandler.java:76) ~[insp-3.27.0.jar:?]
	at ru.centerinform.svs.insp.kafka.Consumption.poll0(Consumption.java:223) ~[insp-3.27.0.jar:?]
	at ru.centerinform.svs.insp.kafka.Consumption.poll(Consumption.java:93) ~[insp-3.27.0.jar:?]
	at ru.centerinform.svs.insp.kafka.PollThread.run(PollThread.java:121) ~[insp-3.27.0.jar:?]
2025-06-19 14:21:58,573 ERROR [] [PollThread] = handle error
ru.centerinform.svs.insp.doc.HandleException: Документ от организации 030000434308 номер 00019 с датой 2025-06-15. Отклонение даты документа от текущей даты превышает трое суток.
	at ru.centerinform.svs.insp.doc.checker.Checker.ex(Checker.java:635) ~[insp-3.27.0.jar:?]
	at ru.centerinform.svs.insp.doc.checker.Checker.checkDayShiftImpl(Checker.java:207) ~[insp-3.27.0.jar:?]
	at ru.centerinform.svs.insp.doc.checker.Checker.lambda$checkDayShift$4(Checker.java:198) ~[insp-3.27.0.jar:?]
	at ru.centerinform.svs.insp.doc.checker.Checker.check(Checker.java:109) ~[insp-3.27.0.jar:?]
	at ru.centerinform.svs.insp.doc.checker.Checker.checkDayShift(Checker.java:198) ~[insp-3.27.0.jar:?]
	at ru.centerinform.svs.insp.doc.ri.RIHandler.check(RIHandler.java:63) ~[insp-3.27.0.jar:?]
	at ru.centerinform.svs.insp.doc.ri.RIHandler.handle(RIHandler.java:50) ~[insp-3.27.0.jar:?]
	at ru.centerinform.svs.insp.InspMessageHandler.handleImpl(InspMessageHandler.java:99) ~[insp-3.27.0.jar:?]
	at ru.centerinform.svs.insp.InspMessageHandler.handle(InspMessageHandler.java:76) ~[insp-3.27.0.jar:?]
	at ru.centerinform.svs.insp.kafka.Consumption.poll0(Consumption.java:223) ~[insp-3.27.0.jar:?]
	at ru.centerinform.svs.insp.kafka.Consumption.poll(Consumption.java:93) ~[insp-3.27.0.jar:?]
	at ru.centerinform.svs.insp.kafka.PollThread.run(PollThread.java:121) ~[insp-3.27.0.jar:?]
2025-06-19 14:21:58,574 ERROR [] [PollThread] = Fail
ru.centerinform.svs.insp.doc.HandleException: Документ от организации 030000434308 номер 00019 с датой 2025-06-15. Отклонение даты документа от текущей даты превышает трое суток.
	at ru.centerinform.svs.insp.doc.checker.Checker.ex(Checker.java:635) ~[insp-3.27.0.jar:?]
	at ru.centerinform.svs.insp.doc.checker.Checker.checkDayShiftImpl(Checker.java:207) ~[insp-3.27.0.jar:?]
	at ru.centerinform.svs.insp.doc.checker.Checker.lambda$checkDayShift$4(Checker.java:198) ~[insp-3.27.0.jar:?]
	at ru.centerinform.svs.insp.doc.checker.Checker.check(Checker.java:109) ~[insp-3.27.0.jar:?]
	at ru.centerinform.svs.insp.doc.checker.Checker.checkDayShift(Checker.java:198) ~[insp-3.27.0.jar:?]
	at ru.centerinform.svs.insp.doc.ri.RIHandler.check(RIHandler.java:63) ~[insp-3.27.0.jar:?]
	at ru.centerinform.svs.insp.doc.ri.RIHandler.handle(RIHandler.java:50) ~[insp-3.27.0.jar:?]
	at ru.centerinform.svs.insp.InspMessageHandler.handleImpl(InspMessageHandler.java:99) ~[insp-3.27.0.jar:?]
	at ru.centerinform.svs.insp.InspMessageHandler.handle(InspMessageHandler.java:76) ~[insp-3.27.0.jar:?]
	at ru.centerinform.svs.insp.kafka.Consumption.poll0(Consumption.java:223) ~[insp-3.27.0.jar:?]
	at ru.centerinform.svs.insp.kafka.Consumption.poll(Consumption.java:93) ~[insp-3.27.0.jar:?]
	at ru.centerinform.svs.insp.kafka.PollThread.run(PollThread.java:121) ~[insp-3.27.0.jar:?]
2025-06-19 14:21:58,574 DEBUG [] [PollThread] = Remove docHash:c24ce68e91b171f864aac47866f8f3a8 from redis cache
2025-06-19 14:21:58,577 DEBUG [] [PollThread] = docUri:030000434308-6635f0eb-d36a-4982-90e2-a1fb1175e550
2025-06-19 14:21:58,577 DEBUG [] [PollThread] = date:2025-06-19T14:21:58.577274861
2025-06-19 14:21:58,577 DEBUG [] [PollThread] = ticketUri:030000434308-f3972035-20d8-46e0-90a0-c2df2c74e451
2025-06-19 14:21:58,578 DEBUG [] [PollThread] = xmlTransportId:030000434308-6635f0eb-d36a-4982-90e2-a1fb1175e550
2025-06-19 14:21:58,578 DEBUG [] [PollThread] = set comments: Дата документа (2025-06-15) отличается от текущей более чем на три дня
2025-06-19 14:21:58,578 DEBUG [] [PollThread] = templatePath:xml/ticket.xml
2025-06-19 14:21:58,587 DEBUG [] [PollThread] = <?xml version="1.0" encoding="utf-8"?>
<ns:Documents xmlns:tc="http://fsrar.ru/WEGAIS/Ticket"
              xmlns:oref="http://fsrar.ru/WEGAIS/ClientRef"
              xmlns:ns="http://fsrar.ru/WEGAIS/WB_DOC_SINGLE_01"
              xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
              Version="1.0">
    <ns:Owner>
        <ns:FSRAR_ID>3463047</ns:FSRAR_ID>
    </ns:Owner>
    <ns:Document>
        <ns:Ticket>
            <tc:TicketDate>2025-06-19T14:21:58.577</tc:TicketDate>
            <tc:Identity>00019</tc:Identity>
            <tc:DocId></tc:DocId>
            <tc:TransportId>030000434308-6635f0eb-d36a-4982-90e2-a1fb1175e550</tc:TransportId>
            <tc:RegID></tc:RegID>
            <tc:DocHash/>
            <tc:DocType>RepImportedProduct_v4</tc:DocType>
            <tc:Result>
                <tc:Conclusion>Rejected</tc:Conclusion>
                <tc:ConclusionDate></tc:ConclusionDate>
                <tc:Comments>Дата документа (2025-06-15) отличается от текущей более чем на три дня</tc:Comments>
            </tc:Result>
        </ns:Ticket>
    </ns:Document>
</ns:Documents>


2025-06-19 14:21:58,587 DEBUG [] [PollThread] = Для сохранения квитанции используем БД
2025-06-19 14:21:58,590 DEBUG [] [PollThread] = save ticket to DB: Ticket{xml='<?xml version="1.0" encoding="utf-8"?>
<ns:Documents xmlns:tc="http://fsrar.ru/WEGAIS/Ticket"
              xmlns:oref="http://fsrar.ru/WEGAIS/ClientRef"
              xmlns:ns="http://fsrar.ru/WEGAIS/WB_DOC_SINGLE_01"
              xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
              Version="1.0">
    <ns:Owner>
        <ns:FSRAR_ID>3463047</ns:FSRAR_ID>
    </ns:Owner>
    <ns:Document>
        <ns:Ticket>
            <tc:TicketDate>2025-06-19T14:21:58.577</tc:TicketDate>
            <tc:Identity>00019</tc:Identity>
            <tc:DocId></tc:DocId>
            <tc:TransportId>030000434308-6635f0eb-d36a-4982-90e2-a1fb1175e550</tc:TransportId>
            <tc:RegID></tc:RegID>
            <tc:DocHash/>
            <tc:DocType>RepImportedProduct_v4</tc:DocType>
            <tc:Result>
                <tc:Conclusion>Rejected</tc:Conclusion>
                <tc:ConclusionDate></tc:ConclusionDate>
                <tc:Comments>Дата документа (2025-06-15) отличается от текущей более чем на три дня</tc:Comments>
            </tc:Result>
        </ns:Ticket>
    </ns:Document>
</ns:Documents>

', nowDateTime=2025-06-19T14:21:58.577274861, ticketDate='2025-06-19', ticketDateTime='2025-06-19T14:21:58.577', docUri='030000434308-6635f0eb-d36a-4982-90e2-a1fb1175e550', ticketUri='030000434308-f3972035-20d8-46e0-90a0-c2df2c74e451', ticketUUID='f3972035-20d8-46e0-90a0-c2df2c74e451', fsrarId='030000434308', identity='00019', templater=ru.centerinform.svs.insp.Templater@1fbe30e, type=DocType{type='repimportedproduct_v4', num='46', ticketDocName='RepImportedProduct_v4'}}
2025-06-19 14:21:58,590 DEBUG [] [PollThread] = INSERT INTO filedata.outboxdata
    (uri, inboxuri, filedata)
    VALUES(?, ?, ?)

2025-06-19 14:21:58,590 DEBUG [] [PollThread] = f3972035-20d8-46e0-90a0-c2df2c74e451 6635f0eb-d36a-4982-90e2-a1fb1175e550 <?xml version="1.0" encoding="utf-8"?>
<ns:Documents xmlns:tc="http://fsrar.ru/WEGAIS/Ticket"
              xmlns:oref="http://fsrar.ru/WEGAIS/ClientRef"
              xmlns:ns="http://fsrar.ru/WEGAIS/WB_DOC_SINGLE_01"
              xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
              Version="1.0">
    <ns:Owner>
        <ns:FSRAR_ID>3463047</ns:FSRAR_ID>
    </ns:Owner>
    <ns:Document>
        <ns:Ticket>
            <tc:TicketDate>2025-06-19T14:21:58.577</tc:TicketDate>
            <tc:Identity>00019</tc:Identity>
            <tc:DocId></tc:DocId>
            <tc:TransportId>030000434308-6635f0eb-d36a-4982-90e2-a1fb1175e550</tc:TransportId>
            <tc:RegID></tc:RegID>
            <tc:DocHash/>
            <tc:DocType>RepImportedProduct_v4</tc:DocType>
            <tc:Result>
                <tc:Conclusion>Rejected</tc:Conclusion>
                <tc:ConclusionDate></tc:ConclusionDate>
                <tc:Comments>Дата документа (2025-06-15) отличается от текущей более чем на три дня</tc:Comments>
            </tc:Result>
        </ns:Ticket>
    </ns:Document>
</ns:Documents>


2025-06-19 14:21:58,596 DEBUG [] [PollThread] = insert 1 rows
2025-06-19 14:21:58,596 DEBUG [] [PollThread] = INSERT INTO outbox.meta (dtype, fsrarid, uri, ts)
    VALUES (?, ?, ?, ?)

2025-06-19 14:21:58,597 DEBUG [] [PollThread] = ticket 30000434308 f3972035-20d8-46e0-90a0-c2df2c74e451 2025-06-19T14:21:58.577+0300
2025-06-19 14:21:58,602 DEBUG [] [PollThread] = insert 1 rows
2025-06-19 14:21:58,606 DEBUG [] [PollThread] = Fail finish
2025-06-19 14:21:58,606 INFO [] [PollThread] = End processing. 212 ms
2025-06-19 14:21:58,606 DEBUG [] [PollThread] = repeat()
2025-06-19 14:21:58,606 DEBUG [] [PollThread] = repeatEnabled:true
2025-06-19 14:21:58,606 DEBUG [] [PollThread] = repeatRecords size:0
2025-06-19 14:21:58,606 DEBUG [] [PollThread] = records is empty
2025-06-19 14:21:58,609 DEBUG [] [PollThread] = commitSync()
2025-06-19 14:21:58,701 DEBUG [] [GtdPollThread] = poll:0
2025-06-19 14:21:58,701 DEBUG [] [GtdPollThread] = repeat()
2025-06-19 14:21:58,701 DEBUG [] [GtdPollThread] = repeatEnabled:true

</pre>
}}
*Полученный результат: проверка определилась, статус прохождения проверки проставился корректно, тикет сформировался корректный - УСПЕХ*
# doubles
## skip {{collapse(БД)
<pre>
|id |document_name_format |document_format_version|check_code|date_begin|date_end  |ordernum|service_code|check_action|
|---|---------------------|-----------------------|----------|----------|----------|--------|------------|------------|
|72 |repimportedproduct_v4|4                      |doubles   |2025-02-20|2050-02-20|1       |inspector   |skip        |

</pre>
}}
{{collapse(Полный лог)
<pre>
2025-06-19 14:25:48,895 DEBUG [] [PollThread] = poll:0
2025-06-19 14:25:48,895 DEBUG [] [PollThread] = repeat()
2025-06-19 14:25:48,895 DEBUG [] [PollThread] = repeatEnabled:true
2025-06-19 14:25:48,895 DEBUG [] [PollThread] = repeatRecords size:0
2025-06-19 14:25:48,895 DEBUG [] [PollThread] = records is empty
2025-06-19 14:25:48,898 DEBUG [] [PollThread] = commitSync()
2025-06-19 14:25:49,314 DEBUG [] [PollThread] = poll:1
2025-06-19 14:25:49,314 DEBUG [] [PollThread] = consume. key:[null] value:[{"type":"repimportedproduct_v4","uri":"030000434308-6635f0eb-d36a-4982-90e2-a1fb1175e551","fsrarid":"030000434308","date":"2025-06-05","timezone":"+03:00","inn":"7841051711","kpp":""}] offset:[20751] topic:[confirmed])
2025-06-19 14:25:49,317 INFO [] [PollThread] = Start processing.
2025-06-19 14:25:49,364 DEBUG [] [PollThread] = Для получения файла используем БД
2025-06-19 14:25:49,365 DEBUG [] [PollThread] = Loading data by uri: 6635f0eb-d36a-4982-90e2-a1fb1175e551
2025-06-19 14:25:49,365 DEBUG [] [PollThread] = SELECT filedata FROM filedata.inboxdata
WHERE uri=?
ORDER BY id

2025-06-19 14:25:49,416 DEBUG [] [PollThread] = Doc type:DocType{type='repimportedproduct_v4', num='46', ticketDocName='RepImportedProduct_v4'} date:2025-06-19 number:00019
2025-06-19 14:25:49,416 DEBUG [] [PollThread] = 030000434308-6635f0eb-d36a-4982-90e2-a1fb1175e551
2025-06-19 14:25:49,416 DEBUG [] [PollThread] = Load:52 ms
2025-06-19 14:25:49,419 DEBUG [] [PollThread] = checkExist:repimportedproduct_v4
2025-06-19 14:25:49,428 DEBUG [] [PollThread] = find rule:DocTypeCode[docType=DocType{type='repimportedproduct_v4', num='46', ticketDocName='RepImportedProduct_v4'}, code=doubles] Rule[code=doubles, mode=SKIP, start=Проверка документа на повтор, reject=Документ с номером %s и датой %s уже зафиксирован в системе, confirm=Проверка пройдена]
2025-06-19 14:25:49,428 DEBUG [] [PollThread] = skip:doubles
2025-06-19 14:25:49,429 DEBUG [] [PollThread] = docHash: 48c626e884d86b0537652b674d2d1036
2025-06-19 14:25:49,434 DEBUG [] [PollThread] = set docHash 48c626e884d86b0537652b674d2d1036 to redis
2025-06-19 14:25:49,434 DEBUG [] [PollThread] = checkDayShift:repimportedproduct_v4
2025-06-19 14:25:49,435 DEBUG [] [PollThread] = find rule:DocTypeCode[docType=DocType{type='repimportedproduct_v4', num='46', ticketDocName='RepImportedProduct_v4'}, code=daterange] Rule[code=daterange, mode=ERROR, start=Дата, указанная отправителем в документе, может отличаться от даты подачи документа в ЕГАИС на три дня в большую или меньшую сторону (с учетом часовых поясов), reject=Дата документа (%s) отличается от текущей более чем на три дня, confirm=Проверка пройдена]
2025-06-19 14:25:49,435 DEBUG [] [PollThread] = CheckDayShift. date:2025-06-19
2025-06-19 14:25:49,437 DEBUG [] [PollThread] = docDate:2025-06-19 currentDate:2025-06-19
2025-06-19 14:25:49,437 DEBUG [] [PollThread] = betweenDays:0 
2025-06-19 14:25:49,437 DEBUG [] [PollThread] = docDate:2025-06-19 
2025-06-19 14:25:49,437 DEBUG [] [PollThread] = importedDate:2025-06-19 
2025-06-19 14:25:49,437 DEBUG [] [PollThread] = betweenDays:0
2025-06-19 14:25:49,437 DEBUG [] [PollThread] = checkShipper:repimportedproduct_v4
2025-06-19 14:25:49,438 DEBUG [] [PollThread] = find rule:DocTypeCode[docType=DocType{type='repimportedproduct_v4', num='46', ticketDocName='RepImportedProduct_v4'}, code=senderproducer] Rule[code=senderproducer, mode=ERROR, start=Отправитель отчета о производстве должен совпадать с производителем продукции, указанным в документе., reject=СИО отправителя документа не соответствует СИО производителя продукции, confirm=Проверка пройдена]
2025-06-19 14:25:49,438 DEBUG [] [PollThread] = checkQuantityFormat:DocType{type='repimportedproduct_v4', num='46', ticketDocName='RepImportedProduct_v4'}
2025-06-19 14:25:49,438 DEBUG [] [PollThread] = find rule:DocTypeCode[docType=DocType{type='repimportedproduct_v4', num='46', ticketDocName='RepImportedProduct_v4'}, code=quantity] Rule[code=quantity, mode=ERROR, start=Количество должно быть больше нуля, если значение «isUnpacked» - «0», проверяем что Quantity - целое число, reject=Значение количества продукции с кодом %s не соответствует формату, confirm=Проверка пройдена]
2025-06-19 14:25:49,439 DEBUG [] [PollThread] = find rule:DocTypeCode[docType=DocType{type='repimportedproduct_v4', num='46', ticketDocName='RepImportedProduct_v4'}, code=product] Rule[code=product, mode=WARNING, start=В документах ввода в оборот может быть указана только продукция, предварительно зарегистрированная во ФРАП и имеющая код ЕГАИС, reject=Продукция с кодами %s не зарегистрирована в ЕГАИС, confirm=Проверка пройдена]
2025-06-19 14:25:49,439 DEBUG [] [PollThread] = enter to checkLicense.
2025-06-19 14:25:49,439 DEBUG [] [PollThread] = selectFromNsiProducts [[0300004343080000007]]
2025-06-19 14:25:49,440 DEBUG [] [PollThread] = SELECT
  pt.code_egais AS ProductType_Code,
  p.alc_code,
  p.country_id AS Country_Code,
  p.importer_fsrar_id AS Importer_OwnerID,
  pt.product_group_code AS ProductVid_Code,
  p.is_unpacked AS isUnpacked,
  p.producer_fsrar_id AS Owner_ID
FROM
  "references".product_snapshot p
  INNER JOIN "references".product_type pt ON pt.id = p.product_type_id
WHERE
  alc_code IN (
?)
2025-06-19 14:25:49,452 DEBUG [] [PollThread] = finish selectFromNsiProducts. size:[1]
2025-06-19 14:25:49,452 DEBUG [] [PollThread] = isKfk() fsrarId = [030000434308]
2025-06-19 14:25:49,452 DEBUG [] [PollThread] = SELECT 1
FROM
  "references".org_snapshot t
WHERE
  t.fsrar_id = ?
  AND length(t.inn) <> 10

2025-06-19 14:25:49,457 DEBUG [] [PollThread] = result:false
2025-06-19 14:25:49,457 DEBUG [] [PollThread] = extp [[28015]]
2025-06-19 14:25:49,457 DEBUG [] [PollThread] =   SELECT
    ptp.code AS ExclusionType,
    pt.code_egais AS ProductType_Code
  FROM
    "references".product_type pt
    JOIN subref.product_type_props_lnk ptpl ON ptpl.product_type_id = pt.id
    JOIN subref.product_type_props ptp ON ptp.id = ptpl.product_type_props_id
  WHERE
    ptpl.is_active = true
    AND pt.code_egais IN  (
?)
2025-06-19 14:25:49,462 DEBUG [] [PollThread] = checkLic [[28015]]
2025-06-19 14:25:49,462 DEBUG [] [PollThread] = SELECT
  COUNT(ptpl.id) AS count_id
FROM
  "references".product_type pt
  JOIN subref.product_type_props_lnk ptpl ON ptpl.product_type_id = pt.id
  JOIN subref.product_type_props ptp ON ptp.id = ptpl.product_type_props_id
WHERE
  ptp.code = 'UnLicense'
  AND pt.code_egais IN (
?)
2025-06-19 14:25:49,467 DEBUG [] [PollThread] = productTypeCodes:1
2025-06-19 14:25:49,467 DEBUG [] [PollThread] = selectFromClientsPeriodLicense [030000434308], [2025-06-19]
2025-06-19 14:25:49,467 DEBUG [] [PollThread] = SELECT 1
FROM
  registries.registry r
WHERE
  r.fsrar_id = ?
  AND ? BETWEEN r.inclusion_date
  AND COALESCE(
    r.expiration_date, CURRENT_DATE + INTERVAL '30 days'
  )
  AND (
    r.row_validity_end IS NULL
    OR r.row_validity_end < CURRENT_TIMESTAMP
  )

2025-06-19 14:25:49,472 DEBUG [] [PollThread] = exist:true 
2025-06-19 14:25:49,472 DEBUG [] [PollThread] = enter to checkUnMarked
2025-06-19 14:25:49,474 DEBUG [] [PollThread] = checkcUnionMembership [112] 
2025-06-19 14:25:49,474 DEBUG [] [PollThread] = SELECT 1
FROM
  subref.country_unions_lnk cul
  JOIN subref.country_unions cu ON cu.id = cul.country_unions_id
  AND cu.code = 'ЕАЭС'
WHERE
  cul.country_code = ?

2025-06-19 14:25:49,498 DEBUG [] [PollThread] = gen:IMP-0000000046
2025-06-19 14:25:49,500 DEBUG [] [PollThread] = Success
2025-06-19 14:25:49,500 DEBUG [] [PollThread] = Create ticket
2025-06-19 14:25:49,501 DEBUG [] [PollThread] = docUri:030000434308-6635f0eb-d36a-4982-90e2-a1fb1175e551
2025-06-19 14:25:49,501 DEBUG [] [PollThread] = date:2025-06-19T14:25:49.501779822
2025-06-19 14:25:49,502 DEBUG [] [PollThread] = ticketUri:030000434308-2291070f-dc91-48c0-bf29-a8559041b240
2025-06-19 14:25:49,503 DEBUG [] [PollThread] = xmlTransportId:030000434308-6635f0eb-d36a-4982-90e2-a1fb1175e551
2025-06-19 14:25:49,503 DEBUG [] [PollThread] = templatePath:xml/ticket.xml
2025-06-19 14:25:49,514 DEBUG [] [PollThread] = <?xml version="1.0" encoding="utf-8"?>
<ns:Documents xmlns:tc="http://fsrar.ru/WEGAIS/Ticket"
              xmlns:oref="http://fsrar.ru/WEGAIS/ClientRef"
              xmlns:ns="http://fsrar.ru/WEGAIS/WB_DOC_SINGLE_01"
              xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
              Version="1.0">
    <ns:Owner>
        <ns:FSRAR_ID>3463047</ns:FSRAR_ID>
    </ns:Owner>
    <ns:Document>
        <ns:Ticket>
            <tc:TicketDate>2025-06-19T14:25:49.501</tc:TicketDate>
            <tc:Identity>00019</tc:Identity>
            <tc:DocId></tc:DocId>
            <tc:TransportId>030000434308-6635f0eb-d36a-4982-90e2-a1fb1175e551</tc:TransportId>
            <tc:RegID>IMP-0000000046</tc:RegID>
            <tc:DocHash/>
            <tc:DocType>RepImportedProduct_v4</tc:DocType>
            <tc:Result>
                <tc:Conclusion>Accepted</tc:Conclusion>
                <tc:ConclusionDate>2025-06-19T14:25:49.501</tc:ConclusionDate>
                <tc:Comments>Документ успешно принят системой на обработку.</tc:Comments>
            </tc:Result>
        </ns:Ticket>
    </ns:Document>
</ns:Documents>


2025-06-19 14:25:49,514 DEBUG [] [PollThread] = Для сохранения квитанции используем БД
2025-06-19 14:25:49,517 DEBUG [] [PollThread] = save ticket to DB: Ticket{xml='<?xml version="1.0" encoding="utf-8"?>
<ns:Documents xmlns:tc="http://fsrar.ru/WEGAIS/Ticket"
              xmlns:oref="http://fsrar.ru/WEGAIS/ClientRef"
              xmlns:ns="http://fsrar.ru/WEGAIS/WB_DOC_SINGLE_01"
              xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
              Version="1.0">
    <ns:Owner>
        <ns:FSRAR_ID>3463047</ns:FSRAR_ID>
    </ns:Owner>
    <ns:Document>
        <ns:Ticket>
            <tc:TicketDate>2025-06-19T14:25:49.501</tc:TicketDate>
            <tc:Identity>00019</tc:Identity>
            <tc:DocId></tc:DocId>
            <tc:TransportId>030000434308-6635f0eb-d36a-4982-90e2-a1fb1175e551</tc:TransportId>
            <tc:RegID>IMP-0000000046</tc:RegID>
            <tc:DocHash/>
            <tc:DocType>RepImportedProduct_v4</tc:DocType>
            <tc:Result>
                <tc:Conclusion>Accepted</tc:Conclusion>
                <tc:ConclusionDate>2025-06-19T14:25:49.501</tc:ConclusionDate>
                <tc:Comments>Документ успешно принят системой на обработку.</tc:Comments>
            </tc:Result>
        </ns:Ticket>
    </ns:Document>
</ns:Documents>

', nowDateTime=2025-06-19T14:25:49.501779822, ticketDate='2025-06-19', ticketDateTime='2025-06-19T14:25:49.501', docUri='030000434308-6635f0eb-d36a-4982-90e2-a1fb1175e551', ticketUri='030000434308-2291070f-dc91-48c0-bf29-a8559041b240', ticketUUID='2291070f-dc91-48c0-bf29-a8559041b240', fsrarId='030000434308', identity='00019', templater=ru.centerinform.svs.insp.Templater@59380627, type=DocType{type='repimportedproduct_v4', num='46', ticketDocName='RepImportedProduct_v4'}}
2025-06-19 14:25:49,517 DEBUG [] [PollThread] = INSERT INTO filedata.outboxdata
    (uri, inboxuri, filedata)
    VALUES(?, ?, ?)

2025-06-19 14:25:49,517 DEBUG [] [PollThread] = 2291070f-dc91-48c0-bf29-a8559041b240 6635f0eb-d36a-4982-90e2-a1fb1175e551 <?xml version="1.0" encoding="utf-8"?>
<ns:Documents xmlns:tc="http://fsrar.ru/WEGAIS/Ticket"
              xmlns:oref="http://fsrar.ru/WEGAIS/ClientRef"
              xmlns:ns="http://fsrar.ru/WEGAIS/WB_DOC_SINGLE_01"
              xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
              Version="1.0">
    <ns:Owner>
        <ns:FSRAR_ID>3463047</ns:FSRAR_ID>
    </ns:Owner>
    <ns:Document>
        <ns:Ticket>
            <tc:TicketDate>2025-06-19T14:25:49.501</tc:TicketDate>
            <tc:Identity>00019</tc:Identity>
            <tc:DocId></tc:DocId>
            <tc:TransportId>030000434308-6635f0eb-d36a-4982-90e2-a1fb1175e551</tc:TransportId>
            <tc:RegID>IMP-0000000046</tc:RegID>
            <tc:DocHash/>
            <tc:DocType>RepImportedProduct_v4</tc:DocType>
            <tc:Result>
                <tc:Conclusion>Accepted</tc:Conclusion>
                <tc:ConclusionDate>2025-06-19T14:25:49.501</tc:ConclusionDate>
                <tc:Comments>Документ успешно принят системой на обработку.</tc:Comments>
            </tc:Result>
        </ns:Ticket>
    </ns:Document>
</ns:Documents>


2025-06-19 14:25:49,524 DEBUG [] [PollThread] = insert 1 rows
2025-06-19 14:25:49,524 DEBUG [] [PollThread] = INSERT INTO outbox.meta (dtype, fsrarid, uri, ts)
    VALUES (?, ?, ?, ?)

2025-06-19 14:25:49,525 DEBUG [] [PollThread] = ticket 30000434308 2291070f-dc91-48c0-bf29-a8559041b240 2025-06-19T14:25:49.501+0300
2025-06-19 14:25:49,531 DEBUG [] [PollThread] = insert 1 rows
2025-06-19 14:25:49,535 DEBUG [] [PollThread] = {"date":"2025-06-05","uri":"030000434308-6635f0eb-d36a-4982-90e2-a1fb1175e551","type":"repimportedproduct_v4","DocId":"IMP-0000000046"}
2025-06-19 14:25:49,543 DEBUG [] [PollThread] = Success finish
2025-06-19 14:25:49,543 INFO [] [PollThread] = End processing. 225 ms
2025-06-19 14:25:49,543 DEBUG [] [PollThread] = repeat()
2025-06-19 14:25:49,543 DEBUG [] [PollThread] = repeatEnabled:true
2025-06-19 14:25:49,543 DEBUG [] [PollThread] = repeatRecords size:0
2025-06-19 14:25:49,543 DEBUG [] [PollThread] = records is empty
2025-06-19 14:25:49,546 DEBUG [] [PollThread] = commitSync()
2025-06-19 14:25:49,707 DEBUG [] [GtdPollThread] = poll:0
2025-06-19 14:25:49,707 DEBUG [] [GtdPollThread] = repeat()
2025-06-19 14:25:49,707 DEBUG [] [GtdPollThread] = repeatEnabled:true
2025-06-19 14:25:49,707 DEBUG [] [GtdPollThread] = repeatRecords size:0
2025-06-19 14:25:49,707 DEBUG [] [GtdPollThread] = records is empty

</pre>
}}
{{collapse(Часть лога)
<pre>
2025-06-19 14:25:49,419 DEBUG [] [PollThread] = checkExist:repimportedproduct_v4
2025-06-19 14:25:49,428 DEBUG [] [PollThread] = find rule:DocTypeCode[docType=DocType{type='repimportedproduct_v4', num='46', ticketDocName='RepImportedProduct_v4'}, code=doubles] Rule[code=doubles, mode=SKIP, start=Проверка документа на повтор, reject=Документ с номером %s и датой %s уже зафиксирован в системе, confirm=Проверка пройдена]
2025-06-19 14:25:49,428 DEBUG [] [PollThread] = skip:doubles

</pre>
}}
{{collapse(select + result)
<pre>
 SELECT 1
FROM
  registry.documents
WHERE
  fsrarid = '030000434308'
  AND dtype::text = 'repimportedproduct_v4'
  AND client_number = '00019'
  AND dt = '2025-06-19'
LIMIT 1;

|?column?|
|--------|
|1       |

</pre>
}}
*Полученный результат: проверка определилась, статус прохождения проверки проставился корректно, тикет сформировался корректный - УСПЕХ*
## warn {{collapse(БД)
<pre>
|id |document_name_format |document_format_version|check_code|date_begin|date_end  |ordernum|service_code|check_action|
|---|---------------------|-----------------------|----------|----------|----------|--------|------------|------------|
|72 |repimportedproduct_v4|4                      |doubles   |2025-02-20|2050-02-20|1       |inspector   |warning     |

</pre>
}}
{{collapse(Полный лог)
<pre>
2025-06-19 14:28:47,812 DEBUG [] [PollThread] = repeatRecords size:0
2025-06-19 14:28:47,812 DEBUG [] [PollThread] = records is empty
2025-06-19 14:28:47,815 DEBUG [] [PollThread] = commitSync()
2025-06-19 14:28:47,898 DEBUG [] [PollThread] = poll:1
2025-06-19 14:28:47,898 DEBUG [] [PollThread] = consume. key:[null] value:[{"type":"repimportedproduct_v4","uri":"030000434308-6635f0eb-d36a-4982-90e2-a1fb1175e552","fsrarid":"030000434308","date":"2025-06-05","timezone":"+03:00","inn":"7841051711","kpp":""}] offset:[20752] topic:[confirmed])
2025-06-19 14:28:47,901 INFO [] [PollThread] = Start processing.
2025-06-19 14:28:48,003 DEBUG [] [GtdPollThread] = poll:0
2025-06-19 14:28:48,003 DEBUG [] [GtdPollThread] = repeat()
2025-06-19 14:28:48,003 DEBUG [] [GtdPollThread] = repeatEnabled:true
2025-06-19 14:28:48,003 DEBUG [] [GtdPollThread] = repeatRecords size:0
2025-06-19 14:28:48,003 DEBUG [] [GtdPollThread] = records is empty
2025-06-19 14:28:48,007 DEBUG [] [GtdPollThread] = commitSync()
2025-06-19 14:28:49,008 DEBUG [] [GtdPollThread] = poll:0
2025-06-19 14:28:49,008 DEBUG [] [GtdPollThread] = repeat()
2025-06-19 14:28:49,008 DEBUG [] [GtdPollThread] = repeatEnabled:true
2025-06-19 14:28:49,008 DEBUG [] [GtdPollThread] = repeatRecords size:0
2025-06-19 14:28:49,008 DEBUG [] [GtdPollThread] = records is empty
2025-06-19 14:28:49,011 DEBUG [] [GtdPollThread] = commitSync()
2025-06-19 14:28:50,011 DEBUG [] [GtdPollThread] = poll:0
2025-06-19 14:28:50,011 DEBUG [] [GtdPollThread] = repeat()
2025-06-19 14:28:50,011 DEBUG [] [GtdPollThread] = repeatEnabled:true
2025-06-19 14:28:50,011 DEBUG [] [GtdPollThread] = repeatRecords size:0
2025-06-19 14:28:50,011 DEBUG [] [GtdPollThread] = records is empty
2025-06-19 14:28:50,014 DEBUG [] [GtdPollThread] = commitSync()
2025-06-19 14:28:51,014 DEBUG [] [GtdPollThread] = poll:0
2025-06-19 14:28:51,015 DEBUG [] [GtdPollThread] = repeat()
2025-06-19 14:28:51,015 DEBUG [] [GtdPollThread] = repeatEnabled:true
2025-06-19 14:28:51,015 DEBUG [] [GtdPollThread] = repeatRecords size:0
2025-06-19 14:28:51,015 DEBUG [] [GtdPollThread] = records is empty
2025-06-19 14:28:51,017 DEBUG [] [GtdPollThread] = commitSync()
2025-06-19 14:28:52,019 DEBUG [] [GtdPollThread] = poll:0
2025-06-19 14:28:52,019 DEBUG [] [GtdPollThread] = repeat()
2025-06-19 14:28:52,019 DEBUG [] [GtdPollThread] = repeatEnabled:true
2025-06-19 14:28:52,019 DEBUG [] [GtdPollThread] = repeatRecords size:0
2025-06-19 14:28:52,019 DEBUG [] [GtdPollThread] = records is empty
2025-06-19 14:28:52,022 DEBUG [] [GtdPollThread] = commitSync()
2025-06-19 14:28:52,969 DEBUG [] [PollThread] = Для получения файла используем БД
2025-06-19 14:28:52,970 DEBUG [] [PollThread] = Loading data by uri: 6635f0eb-d36a-4982-90e2-a1fb1175e552
2025-06-19 14:28:52,970 DEBUG [] [PollThread] = SELECT filedata FROM filedata.inboxdata
WHERE uri=?
ORDER BY id

2025-06-19 14:28:53,023 DEBUG [] [GtdPollThread] = poll:0
2025-06-19 14:28:53,023 DEBUG [] [GtdPollThread] = repeat()
2025-06-19 14:28:53,023 DEBUG [] [GtdPollThread] = repeatEnabled:true
2025-06-19 14:28:53,023 DEBUG [] [GtdPollThread] = repeatRecords size:0
2025-06-19 14:28:53,023 DEBUG [] [GtdPollThread] = records is empty
2025-06-19 14:28:53,027 DEBUG [] [GtdPollThread] = commitSync()
2025-06-19 14:28:53,036 DEBUG [] [PollThread] = Doc type:DocType{type='repimportedproduct_v4', num='46', ticketDocName='RepImportedProduct_v4'} date:2025-06-19 number:00019
2025-06-19 14:28:53,036 DEBUG [] [PollThread] = 030000434308-6635f0eb-d36a-4982-90e2-a1fb1175e552
2025-06-19 14:28:53,036 DEBUG [] [PollThread] = Load:66 ms
2025-06-19 14:28:53,039 DEBUG [] [PollThread] = checkExist:repimportedproduct_v4
2025-06-19 14:28:53,047 DEBUG [] [PollThread] = find rule:DocTypeCode[docType=DocType{type='repimportedproduct_v4', num='46', ticketDocName='RepImportedProduct_v4'}, code=doubles] Rule[code=doubles, mode=WARNING, start=Проверка документа на повтор, reject=Документ с номером %s и датой %s уже зафиксирован в системе, confirm=Проверка пройдена]
2025-06-19 14:28:53,048 DEBUG [] [PollThread] = existRegistryDoc [030000434308] [repimportedproduct_v4] [00019] [2025-06-19]
2025-06-19 14:28:53,048 DEBUG [] [PollThread] = SELECT 1
FROM
  registry.documents
WHERE
  fsrarid = ?
  AND dtype = ?
  AND client_number = ?
  AND dt = ?
LIMIT 1

2025-06-19 14:28:53,055 DEBUG [] [PollThread] = 30000434308 repimportedproduct_v4 00019 2025-06-19
2025-06-19 14:28:53,063 DEBUG [] [PollThread] = warning:{}
ru.centerinform.svs.insp.doc.HandleException: Документ от организации 030000434308 номер 00019 с датой 2025-06-19. Документ уже зарегистрирован.
	at ru.centerinform.svs.insp.doc.checker.Checker.ex(Checker.java:635) ~[insp-3.27.0.jar:?]
	at ru.centerinform.svs.insp.doc.checker.Checker.lambda$checkExistImpl$2(Checker.java:138) ~[insp-3.27.0.jar:?]
	at ru.centerinform.svs.insp.doc.checker.StorageChecker.ex(StorageChecker.java:191) ~[insp-3.27.0.jar:?]
	at ru.centerinform.svs.insp.doc.checker.StorageChecker.existRegistryDoc(StorageChecker.java:218) ~[insp-3.27.0.jar:?]
	at ru.centerinform.svs.insp.doc.checker.StorageChecker.checkRI(StorageChecker.java:165) ~[insp-3.27.0.jar:?]
	at ru.centerinform.svs.insp.doc.checker.StorageChecker.check(StorageChecker.java:77) ~[insp-3.27.0.jar:?]
	at ru.centerinform.svs.insp.doc.checker.Checker.checkExistImpl(Checker.java:139) ~[insp-3.27.0.jar:?]
	at ru.centerinform.svs.insp.doc.checker.Checker.lambda$checkExist$1(Checker.java:133) ~[insp-3.27.0.jar:?]
	at ru.centerinform.svs.insp.doc.checker.Checker.check(Checker.java:97) ~[insp-3.27.0.jar:?]
	at ru.centerinform.svs.insp.doc.checker.Checker.checkExist(Checker.java:133) ~[insp-3.27.0.jar:?]
	at ru.centerinform.svs.insp.doc.ri.RIHandler.check(RIHandler.java:59) ~[insp-3.27.0.jar:?]
	at ru.centerinform.svs.insp.doc.ri.RIHandler.handle(RIHandler.java:50) ~[insp-3.27.0.jar:?]
	at ru.centerinform.svs.insp.InspMessageHandler.handleImpl(InspMessageHandler.java:99) ~[insp-3.27.0.jar:?]
	at ru.centerinform.svs.insp.InspMessageHandler.handle(InspMessageHandler.java:76) ~[insp-3.27.0.jar:?]
	at ru.centerinform.svs.insp.kafka.Consumption.poll0(Consumption.java:223) ~[insp-3.27.0.jar:?]
	at ru.centerinform.svs.insp.kafka.Consumption.poll(Consumption.java:93) ~[insp-3.27.0.jar:?]
	at ru.centerinform.svs.insp.kafka.PollThread.run(PollThread.java:121) ~[insp-3.27.0.jar:?]
2025-06-19 14:28:53,065 DEBUG [] [PollThread] = docHash: 8f6ae7fce057b51bd785a936acc4dbf0
2025-06-19 14:28:53,070 DEBUG [] [PollThread] = set docHash 8f6ae7fce057b51bd785a936acc4dbf0 to redis
2025-06-19 14:28:53,070 DEBUG [] [PollThread] = checkDayShift:repimportedproduct_v4
2025-06-19 14:28:53,070 DEBUG [] [PollThread] = find rule:DocTypeCode[docType=DocType{type='repimportedproduct_v4', num='46', ticketDocName='RepImportedProduct_v4'}, code=daterange] Rule[code=daterange, mode=ERROR, start=Дата, указанная отправителем в документе, может отличаться от даты подачи документа в ЕГАИС на три дня в большую или меньшую сторону (с учетом часовых поясов), reject=Дата документа (%s) отличается от текущей более чем на три дня, confirm=Проверка пройдена]
2025-06-19 14:28:53,070 DEBUG [] [PollThread] = CheckDayShift. date:2025-06-19
2025-06-19 14:28:53,073 DEBUG [] [PollThread] = docDate:2025-06-19 currentDate:2025-06-19
2025-06-19 14:28:53,073 DEBUG [] [PollThread] = betweenDays:0 
2025-06-19 14:28:53,073 DEBUG [] [PollThread] = docDate:2025-06-19 
2025-06-19 14:28:53,073 DEBUG [] [PollThread] = importedDate:2025-06-19 
2025-06-19 14:28:53,073 DEBUG [] [PollThread] = betweenDays:0
2025-06-19 14:28:53,073 DEBUG [] [PollThread] = checkShipper:repimportedproduct_v4
2025-06-19 14:28:53,074 DEBUG [] [PollThread] = find rule:DocTypeCode[docType=DocType{type='repimportedproduct_v4', num='46', ticketDocName='RepImportedProduct_v4'}, code=senderproducer] Rule[code=senderproducer, mode=ERROR, start=Отправитель отчета о производстве должен совпадать с производителем продукции, указанным в документе., reject=СИО отправителя документа не соответствует СИО производителя продукции, confirm=Проверка пройдена]
2025-06-19 14:28:53,074 DEBUG [] [PollThread] = checkQuantityFormat:DocType{type='repimportedproduct_v4', num='46', ticketDocName='RepImportedProduct_v4'}
2025-06-19 14:28:53,074 DEBUG [] [PollThread] = find rule:DocTypeCode[docType=DocType{type='repimportedproduct_v4', num='46', ticketDocName='RepImportedProduct_v4'}, code=quantity] Rule[code=quantity, mode=ERROR, start=Количество должно быть больше нуля, если значение «isUnpacked» - «0», проверяем что Quantity - целое число, reject=Значение количества продукции с кодом %s не соответствует формату, confirm=Проверка пройдена]
2025-06-19 14:28:53,075 DEBUG [] [PollThread] = find rule:DocTypeCode[docType=DocType{type='repimportedproduct_v4', num='46', ticketDocName='RepImportedProduct_v4'}, code=product] Rule[code=product, mode=WARNING, start=В документах ввода в оборот может быть указана только продукция, предварительно зарегистрированная во ФРАП и имеющая код ЕГАИС, reject=Продукция с кодами %s не зарегистрирована в ЕГАИС, confirm=Проверка пройдена]
2025-06-19 14:28:53,075 DEBUG [] [PollThread] = enter to checkLicense.
2025-06-19 14:28:53,075 DEBUG [] [PollThread] = selectFromNsiProducts [[0300004343080000007]]
2025-06-19 14:28:53,075 DEBUG [] [PollThread] = SELECT
  pt.code_egais AS ProductType_Code,
  p.alc_code,
  p.country_id AS Country_Code,
  p.importer_fsrar_id AS Importer_OwnerID,
  pt.product_group_code AS ProductVid_Code,
  p.is_unpacked AS isUnpacked,
  p.producer_fsrar_id AS Owner_ID
FROM
  "references".product_snapshot p
  INNER JOIN "references".product_type pt ON pt.id = p.product_type_id
WHERE
  alc_code IN (
?)
2025-06-19 14:28:53,086 DEBUG [] [PollThread] = finish selectFromNsiProducts. size:[1]
2025-06-19 14:28:53,086 DEBUG [] [PollThread] = isKfk() fsrarId = [030000434308]
2025-06-19 14:28:53,086 DEBUG [] [PollThread] = SELECT 1
FROM
  "references".org_snapshot t
WHERE
  t.fsrar_id = ?
  AND length(t.inn) <> 10

2025-06-19 14:28:53,091 DEBUG [] [PollThread] = result:false
2025-06-19 14:28:53,091 DEBUG [] [PollThread] = extp [[28015]]
2025-06-19 14:28:53,091 DEBUG [] [PollThread] =   SELECT
    ptp.code AS ExclusionType,
    pt.code_egais AS ProductType_Code
  FROM
    "references".product_type pt
    JOIN subref.product_type_props_lnk ptpl ON ptpl.product_type_id = pt.id
    JOIN subref.product_type_props ptp ON ptp.id = ptpl.product_type_props_id
  WHERE
    ptpl.is_active = true
    AND pt.code_egais IN  (
?)
2025-06-19 14:28:53,096 DEBUG [] [PollThread] = checkLic [[28015]]
2025-06-19 14:28:53,096 DEBUG [] [PollThread] = SELECT
  COUNT(ptpl.id) AS count_id
FROM
  "references".product_type pt
  JOIN subref.product_type_props_lnk ptpl ON ptpl.product_type_id = pt.id
  JOIN subref.product_type_props ptp ON ptp.id = ptpl.product_type_props_id
WHERE
  ptp.code = 'UnLicense'
  AND pt.code_egais IN (
?)
2025-06-19 14:28:53,101 DEBUG [] [PollThread] = productTypeCodes:1
2025-06-19 14:28:53,101 DEBUG [] [PollThread] = selectFromClientsPeriodLicense [030000434308], [2025-06-19]
2025-06-19 14:28:53,101 DEBUG [] [PollThread] = SELECT 1
FROM
  registries.registry r
WHERE
  r.fsrar_id = ?
  AND ? BETWEEN r.inclusion_date
  AND COALESCE(
    r.expiration_date, CURRENT_DATE + INTERVAL '30 days'
  )
  AND (
    r.row_validity_end IS NULL
    OR r.row_validity_end < CURRENT_TIMESTAMP
  )

2025-06-19 14:28:53,107 DEBUG [] [PollThread] = exist:true 
2025-06-19 14:28:53,107 DEBUG [] [PollThread] = enter to checkUnMarked
2025-06-19 14:28:53,108 DEBUG [] [PollThread] = checkcUnionMembership [112] 
2025-06-19 14:28:53,108 DEBUG [] [PollThread] = SELECT 1
FROM
  subref.country_unions_lnk cul
  JOIN subref.country_unions cu ON cu.id = cul.country_unions_id
  AND cu.code = 'ЕАЭС'
WHERE
  cul.country_code = ?

2025-06-19 14:28:53,132 DEBUG [] [PollThread] = gen:IMP-0000000047
2025-06-19 14:28:53,133 DEBUG [] [PollThread] = Success
2025-06-19 14:28:53,133 DEBUG [] [PollThread] = Create ticket
2025-06-19 14:28:53,135 DEBUG [] [PollThread] = docUri:030000434308-6635f0eb-d36a-4982-90e2-a1fb1175e552
2025-06-19 14:28:53,135 DEBUG [] [PollThread] = date:2025-06-19T14:28:53.135381693
2025-06-19 14:28:53,136 DEBUG [] [PollThread] = ticketUri:030000434308-cc9800d3-d1a9-4a6e-bf1c-27df8c195d07
2025-06-19 14:28:53,136 DEBUG [] [PollThread] = xmlTransportId:030000434308-6635f0eb-d36a-4982-90e2-a1fb1175e552
2025-06-19 14:28:53,136 DEBUG [] [PollThread] = set warning comments: Документ с номером 00019 и датой 2025-06-19 уже зафиксирован в системе
2025-06-19 14:28:53,136 DEBUG [] [PollThread] = templatePath:xml/ticket.xml
2025-06-19 14:28:53,147 DEBUG [] [PollThread] = <?xml version="1.0" encoding="utf-8"?>
<ns:Documents xmlns:tc="http://fsrar.ru/WEGAIS/Ticket"
              xmlns:oref="http://fsrar.ru/WEGAIS/ClientRef"
              xmlns:ns="http://fsrar.ru/WEGAIS/WB_DOC_SINGLE_01"
              xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
              Version="1.0">
    <ns:Owner>
        <ns:FSRAR_ID>3463047</ns:FSRAR_ID>
    </ns:Owner>
    <ns:Document>
        <ns:Ticket>
            <tc:TicketDate>2025-06-19T14:28:53.135</tc:TicketDate>
            <tc:Identity>00019</tc:Identity>
            <tc:DocId></tc:DocId>
            <tc:TransportId>030000434308-6635f0eb-d36a-4982-90e2-a1fb1175e552</tc:TransportId>
            <tc:RegID>IMP-0000000047</tc:RegID>
            <tc:DocHash/>
            <tc:DocType>RepImportedProduct_v4</tc:DocType>
            <tc:Result>
                <tc:Conclusion>Accepted</tc:Conclusion>
                <tc:ConclusionDate>2025-06-19T14:28:53.135</tc:ConclusionDate>
                <tc:Comments>Документ успешно принят системой на обработку. Документ с номером 00019 и датой 2025-06-19 уже зафиксирован в системе</tc:Comments>
            </tc:Result>
        </ns:Ticket>
    </ns:Document>
</ns:Documents>


2025-06-19 14:28:53,147 DEBUG [] [PollThread] = Для сохранения квитанции используем БД
2025-06-19 14:28:53,150 DEBUG [] [PollThread] = save ticket to DB: Ticket{xml='<?xml version="1.0" encoding="utf-8"?>
<ns:Documents xmlns:tc="http://fsrar.ru/WEGAIS/Ticket"
              xmlns:oref="http://fsrar.ru/WEGAIS/ClientRef"
              xmlns:ns="http://fsrar.ru/WEGAIS/WB_DOC_SINGLE_01"
              xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
              Version="1.0">
    <ns:Owner>
        <ns:FSRAR_ID>3463047</ns:FSRAR_ID>
    </ns:Owner>
    <ns:Document>
        <ns:Ticket>
            <tc:TicketDate>2025-06-19T14:28:53.135</tc:TicketDate>
            <tc:Identity>00019</tc:Identity>
            <tc:DocId></tc:DocId>
            <tc:TransportId>030000434308-6635f0eb-d36a-4982-90e2-a1fb1175e552</tc:TransportId>
            <tc:RegID>IMP-0000000047</tc:RegID>
            <tc:DocHash/>
            <tc:DocType>RepImportedProduct_v4</tc:DocType>
            <tc:Result>
                <tc:Conclusion>Accepted</tc:Conclusion>
                <tc:ConclusionDate>2025-06-19T14:28:53.135</tc:ConclusionDate>
                <tc:Comments>Документ успешно принят системой на обработку. Документ с номером 00019 и датой 2025-06-19 уже зафиксирован в системе</tc:Comments>
            </tc:Result>
        </ns:Ticket>
    </ns:Document>
</ns:Documents>

', nowDateTime=2025-06-19T14:28:53.135381693, ticketDate='2025-06-19', ticketDateTime='2025-06-19T14:28:53.135', docUri='030000434308-6635f0eb-d36a-4982-90e2-a1fb1175e552', ticketUri='030000434308-cc9800d3-d1a9-4a6e-bf1c-27df8c195d07', ticketUUID='cc9800d3-d1a9-4a6e-bf1c-27df8c195d07', fsrarId='030000434308', identity='00019', templater=ru.centerinform.svs.insp.Templater@12be7e8a, type=DocType{type='repimportedproduct_v4', num='46', ticketDocName='RepImportedProduct_v4'}}
2025-06-19 14:28:53,150 DEBUG [] [PollThread] = INSERT INTO filedata.outboxdata
    (uri, inboxuri, filedata)
    VALUES(?, ?, ?)

2025-06-19 14:28:53,150 DEBUG [] [PollThread] = cc9800d3-d1a9-4a6e-bf1c-27df8c195d07 6635f0eb-d36a-4982-90e2-a1fb1175e552 <?xml version="1.0" encoding="utf-8"?>
<ns:Documents xmlns:tc="http://fsrar.ru/WEGAIS/Ticket"
              xmlns:oref="http://fsrar.ru/WEGAIS/ClientRef"
              xmlns:ns="http://fsrar.ru/WEGAIS/WB_DOC_SINGLE_01"
              xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
              Version="1.0">
    <ns:Owner>
        <ns:FSRAR_ID>3463047</ns:FSRAR_ID>
    </ns:Owner>
    <ns:Document>
        <ns:Ticket>
            <tc:TicketDate>2025-06-19T14:28:53.135</tc:TicketDate>
            <tc:Identity>00019</tc:Identity>
            <tc:DocId></tc:DocId>
            <tc:TransportId>030000434308-6635f0eb-d36a-4982-90e2-a1fb1175e552</tc:TransportId>
            <tc:RegID>IMP-0000000047</tc:RegID>
            <tc:DocHash/>
            <tc:DocType>RepImportedProduct_v4</tc:DocType>
            <tc:Result>
                <tc:Conclusion>Accepted</tc:Conclusion>
                <tc:ConclusionDate>2025-06-19T14:28:53.135</tc:ConclusionDate>
                <tc:Comments>Документ успешно принят системой на обработку. Документ с номером 00019 и датой 2025-06-19 уже зафиксирован в системе</tc:Comments>
            </tc:Result>
        </ns:Ticket>
    </ns:Document>
</ns:Documents>


2025-06-19 14:28:53,157 DEBUG [] [PollThread] = insert 1 rows
2025-06-19 14:28:53,157 DEBUG [] [PollThread] = INSERT INTO outbox.meta (dtype, fsrarid, uri, ts)
    VALUES (?, ?, ?, ?)

2025-06-19 14:28:53,158 DEBUG [] [PollThread] = ticket 30000434308 cc9800d3-d1a9-4a6e-bf1c-27df8c195d07 2025-06-19T14:28:53.135+0300
2025-06-19 14:28:53,164 DEBUG [] [PollThread] = insert 1 rows
2025-06-19 14:28:53,168 DEBUG [] [PollThread] = {"date":"2025-06-05","uri":"030000434308-6635f0eb-d36a-4982-90e2-a1fb1175e552","type":"repimportedproduct_v4","DocId":"IMP-0000000047"}
2025-06-19 14:28:53,175 DEBUG [] [PollThread] = Success finish
2025-06-19 14:28:53,175 INFO [] [PollThread] = End processing. 5273 ms
2025-06-19 14:28:53,175 DEBUG [] [PollThread] = repeat()
2025-06-19 14:28:53,175 DEBUG [] [PollThread] = repeatEnabled:true

</pre>
}}
{{collapse(Часть лога)
<pre>
2025-06-19 14:28:53,150 DEBUG [] [PollThread] = cc9800d3-d1a9-4a6e-bf1c-27df8c195d07 6635f0eb-d36a-4982-90e2-a1fb1175e552 <?xml version="1.0" encoding="utf-8"?>
<ns:Documents xmlns:tc="http://fsrar.ru/WEGAIS/Ticket"
              xmlns:oref="http://fsrar.ru/WEGAIS/ClientRef"
              xmlns:ns="http://fsrar.ru/WEGAIS/WB_DOC_SINGLE_01"
              xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
              Version="1.0">
    <ns:Owner>
        <ns:FSRAR_ID>3463047</ns:FSRAR_ID>
    </ns:Owner>
    <ns:Document>
        <ns:Ticket>
            <tc:TicketDate>2025-06-19T14:28:53.135</tc:TicketDate>
            <tc:Identity>00019</tc:Identity>
            <tc:DocId></tc:DocId>
            <tc:TransportId>030000434308-6635f0eb-d36a-4982-90e2-a1fb1175e552</tc:TransportId>
            <tc:RegID>IMP-0000000047</tc:RegID>
            <tc:DocHash/>
            <tc:DocType>RepImportedProduct_v4</tc:DocType>
            <tc:Result>
                <tc:Conclusion>Accepted</tc:Conclusion>
                <tc:ConclusionDate>2025-06-19T14:28:53.135</tc:ConclusionDate>
                <tc:Comments>Документ успешно принят системой на обработку. Документ с номером 00019 и датой 2025-06-19 уже зафиксирован в системе</tc:Comments>
            </tc:Result>
        </ns:Ticket>
    </ns:Document>
</ns:Documents>
</pre>
}}
{{collapse(select + result)
<pre>

 SELECT 1
FROM
  registry.documents
WHERE
  fsrarid = '030000434308'
  AND dtype::text = 'repimportedproduct_v4'
  AND client_number = '00019'
  AND dt = '2025-06-19'
LIMIT 1;

|?column?|
|--------|
|1       |


</pre>
}}
*Полученный результат:  проверка определилась, статус прохождения проверки проставился корректно, тикет успешный с предупреждением - УСПЕХ*
## error {{collapse(БД)
<pre>
|id |document_name_format |document_format_version|check_code|date_begin|date_end  |ordernum|service_code|check_action|
|---|---------------------|-----------------------|----------|----------|----------|--------|------------|------------|
|72 |repimportedproduct_v4|4                      |doubles   |2025-02-20|2050-02-20|1       |inspector   |error       |

</pre>
}}
{{collapse(Полный лог)
<pre>
2025-06-19 14:34:36,501 DEBUG [] [PollThread] = poll:0
2025-06-19 14:34:36,501 DEBUG [] [PollThread] = repeat()
2025-06-19 14:34:36,501 DEBUG [] [PollThread] = repeatEnabled:true
2025-06-19 14:34:36,501 DEBUG [] [PollThread] = repeatRecords size:0
2025-06-19 14:34:36,501 DEBUG [] [PollThread] = records is empty
2025-06-19 14:34:36,504 DEBUG [] [PollThread] = commitSync()
2025-06-19 14:34:36,867 DEBUG [] [PollThread] = poll:1
2025-06-19 14:34:36,868 DEBUG [] [PollThread] = consume. key:[null] value:[{"type":"repimportedproduct_v4","uri":"030000434308-6635f0eb-d36a-4982-90e2-a1fb1175e553","fsrarid":"030000434308","date":"2025-06-05","timezone":"+03:00","inn":"7841051711","kpp":""}] offset:[20753] topic:[confirmed])
2025-06-19 14:34:36,870 INFO [] [PollThread] = Start processing.
2025-06-19 14:34:36,922 DEBUG [] [PollThread] = Для получения файла используем БД
2025-06-19 14:34:36,923 DEBUG [] [PollThread] = Loading data by uri: 6635f0eb-d36a-4982-90e2-a1fb1175e553
2025-06-19 14:34:36,923 DEBUG [] [PollThread] = SELECT filedata FROM filedata.inboxdata
WHERE uri=?
ORDER BY id

2025-06-19 14:34:36,983 DEBUG [] [PollThread] = Doc type:DocType{type='repimportedproduct_v4', num='46', ticketDocName='RepImportedProduct_v4'} date:2025-06-19 number:00019
2025-06-19 14:34:36,983 DEBUG [] [PollThread] = 030000434308-6635f0eb-d36a-4982-90e2-a1fb1175e553
2025-06-19 14:34:36,983 DEBUG [] [PollThread] = Load:60 ms
2025-06-19 14:34:36,986 DEBUG [] [PollThread] = checkExist:repimportedproduct_v4
2025-06-19 14:34:36,995 DEBUG [] [PollThread] = find rule:DocTypeCode[docType=DocType{type='repimportedproduct_v4', num='46', ticketDocName='RepImportedProduct_v4'}, code=doubles] Rule[code=doubles, mode=ERROR, start=Проверка документа на повтор, reject=Документ с номером %s и датой %s уже зафиксирован в системе, confirm=Проверка пройдена]
2025-06-19 14:34:36,996 DEBUG [] [PollThread] = existRegistryDoc [030000434308] [repimportedproduct_v4] [00019] [2025-06-19]
2025-06-19 14:34:36,996 DEBUG [] [PollThread] = SELECT 1
FROM
  registry.documents
WHERE
  fsrarid = ?
  AND dtype = ?
  AND client_number = ?
  AND dt = ?
LIMIT 1

2025-06-19 14:34:37,002 DEBUG [] [PollThread] = 30000434308 repimportedproduct_v4 00019 2025-06-19
2025-06-19 14:34:37,008 DEBUG [] [PollThread] = error:{}
ru.centerinform.svs.insp.doc.HandleException: Документ от организации 030000434308 номер 00019 с датой 2025-06-19. Документ уже зарегистрирован.
	at ru.centerinform.svs.insp.doc.checker.Checker.ex(Checker.java:635) ~[insp-3.27.0.jar:?]
	at ru.centerinform.svs.insp.doc.checker.Checker.lambda$checkExistImpl$2(Checker.java:138) ~[insp-3.27.0.jar:?]
	at ru.centerinform.svs.insp.doc.checker.StorageChecker.ex(StorageChecker.java:191) ~[insp-3.27.0.jar:?]
	at ru.centerinform.svs.insp.doc.checker.StorageChecker.existRegistryDoc(StorageChecker.java:218) ~[insp-3.27.0.jar:?]
	at ru.centerinform.svs.insp.doc.checker.StorageChecker.checkRI(StorageChecker.java:165) ~[insp-3.27.0.jar:?]
	at ru.centerinform.svs.insp.doc.checker.StorageChecker.check(StorageChecker.java:77) ~[insp-3.27.0.jar:?]
	at ru.centerinform.svs.insp.doc.checker.Checker.checkExistImpl(Checker.java:139) ~[insp-3.27.0.jar:?]
	at ru.centerinform.svs.insp.doc.checker.Checker.lambda$checkExist$1(Checker.java:133) ~[insp-3.27.0.jar:?]
	at ru.centerinform.svs.insp.doc.checker.Checker.check(Checker.java:109) ~[insp-3.27.0.jar:?]
	at ru.centerinform.svs.insp.doc.checker.Checker.checkExist(Checker.java:133) ~[insp-3.27.0.jar:?]
	at ru.centerinform.svs.insp.doc.ri.RIHandler.check(RIHandler.java:59) ~[insp-3.27.0.jar:?]
	at ru.centerinform.svs.insp.doc.ri.RIHandler.handle(RIHandler.java:50) ~[insp-3.27.0.jar:?]
	at ru.centerinform.svs.insp.InspMessageHandler.handleImpl(InspMessageHandler.java:99) ~[insp-3.27.0.jar:?]
	at ru.centerinform.svs.insp.InspMessageHandler.handle(InspMessageHandler.java:76) ~[insp-3.27.0.jar:?]
	at ru.centerinform.svs.insp.kafka.Consumption.poll0(Consumption.java:223) ~[insp-3.27.0.jar:?]
	at ru.centerinform.svs.insp.kafka.Consumption.poll(Consumption.java:93) ~[insp-3.27.0.jar:?]
	at ru.centerinform.svs.insp.kafka.PollThread.run(PollThread.java:121) ~[insp-3.27.0.jar:?]
2025-06-19 14:34:37,008 ERROR [] [PollThread] = handle error
ru.centerinform.svs.insp.doc.HandleException: Документ от организации 030000434308 номер 00019 с датой 2025-06-19. Документ уже зарегистрирован.
	at ru.centerinform.svs.insp.doc.checker.Checker.ex(Checker.java:635) ~[insp-3.27.0.jar:?]
	at ru.centerinform.svs.insp.doc.checker.Checker.lambda$checkExistImpl$2(Checker.java:138) ~[insp-3.27.0.jar:?]
	at ru.centerinform.svs.insp.doc.checker.StorageChecker.ex(StorageChecker.java:191) ~[insp-3.27.0.jar:?]
	at ru.centerinform.svs.insp.doc.checker.StorageChecker.existRegistryDoc(StorageChecker.java:218) ~[insp-3.27.0.jar:?]
	at ru.centerinform.svs.insp.doc.checker.StorageChecker.checkRI(StorageChecker.java:165) ~[insp-3.27.0.jar:?]
	at ru.centerinform.svs.insp.doc.checker.StorageChecker.check(StorageChecker.java:77) ~[insp-3.27.0.jar:?]
	at ru.centerinform.svs.insp.doc.checker.Checker.checkExistImpl(Checker.java:139) ~[insp-3.27.0.jar:?]
	at ru.centerinform.svs.insp.doc.checker.Checker.lambda$checkExist$1(Checker.java:133) ~[insp-3.27.0.jar:?]
	at ru.centerinform.svs.insp.doc.checker.Checker.check(Checker.java:109) ~[insp-3.27.0.jar:?]
	at ru.centerinform.svs.insp.doc.checker.Checker.checkExist(Checker.java:133) ~[insp-3.27.0.jar:?]
	at ru.centerinform.svs.insp.doc.ri.RIHandler.check(RIHandler.java:59) ~[insp-3.27.0.jar:?]
	at ru.centerinform.svs.insp.doc.ri.RIHandler.handle(RIHandler.java:50) ~[insp-3.27.0.jar:?]
	at ru.centerinform.svs.insp.InspMessageHandler.handleImpl(InspMessageHandler.java:99) ~[insp-3.27.0.jar:?]
	at ru.centerinform.svs.insp.InspMessageHandler.handle(InspMessageHandler.java:76) ~[insp-3.27.0.jar:?]
	at ru.centerinform.svs.insp.kafka.Consumption.poll0(Consumption.java:223) ~[insp-3.27.0.jar:?]
	at ru.centerinform.svs.insp.kafka.Consumption.poll(Consumption.java:93) ~[insp-3.27.0.jar:?]
	at ru.centerinform.svs.insp.kafka.PollThread.run(PollThread.java:121) ~[insp-3.27.0.jar:?]
2025-06-19 14:34:37,009 ERROR [] [PollThread] = Fail
ru.centerinform.svs.insp.doc.HandleException: Документ от организации 030000434308 номер 00019 с датой 2025-06-19. Документ уже зарегистрирован.
	at ru.centerinform.svs.insp.doc.checker.Checker.ex(Checker.java:635) ~[insp-3.27.0.jar:?]
	at ru.centerinform.svs.insp.doc.checker.Checker.lambda$checkExistImpl$2(Checker.java:138) ~[insp-3.27.0.jar:?]
	at ru.centerinform.svs.insp.doc.checker.StorageChecker.ex(StorageChecker.java:191) ~[insp-3.27.0.jar:?]
	at ru.centerinform.svs.insp.doc.checker.StorageChecker.existRegistryDoc(StorageChecker.java:218) ~[insp-3.27.0.jar:?]
	at ru.centerinform.svs.insp.doc.checker.StorageChecker.checkRI(StorageChecker.java:165) ~[insp-3.27.0.jar:?]
	at ru.centerinform.svs.insp.doc.checker.StorageChecker.check(StorageChecker.java:77) ~[insp-3.27.0.jar:?]
	at ru.centerinform.svs.insp.doc.checker.Checker.checkExistImpl(Checker.java:139) ~[insp-3.27.0.jar:?]
	at ru.centerinform.svs.insp.doc.checker.Checker.lambda$checkExist$1(Checker.java:133) ~[insp-3.27.0.jar:?]
	at ru.centerinform.svs.insp.doc.checker.Checker.check(Checker.java:109) ~[insp-3.27.0.jar:?]
	at ru.centerinform.svs.insp.doc.checker.Checker.checkExist(Checker.java:133) ~[insp-3.27.0.jar:?]
	at ru.centerinform.svs.insp.doc.ri.RIHandler.check(RIHandler.java:59) ~[insp-3.27.0.jar:?]
	at ru.centerinform.svs.insp.doc.ri.RIHandler.handle(RIHandler.java:50) ~[insp-3.27.0.jar:?]
	at ru.centerinform.svs.insp.InspMessageHandler.handleImpl(InspMessageHandler.java:99) ~[insp-3.27.0.jar:?]
	at ru.centerinform.svs.insp.InspMessageHandler.handle(InspMessageHandler.java:76) ~[insp-3.27.0.jar:?]
	at ru.centerinform.svs.insp.kafka.Consumption.poll0(Consumption.java:223) ~[insp-3.27.0.jar:?]
	at ru.centerinform.svs.insp.kafka.Consumption.poll(Consumption.java:93) ~[insp-3.27.0.jar:?]
	at ru.centerinform.svs.insp.kafka.PollThread.run(PollThread.java:121) ~[insp-3.27.0.jar:?]
2025-06-19 14:34:37,009 DEBUG [] [PollThread] = Remove docHash: from redis cache
2025-06-19 14:34:37,018 DEBUG [] [PollThread] = docUri:030000434308-6635f0eb-d36a-4982-90e2-a1fb1175e553
2025-06-19 14:34:37,018 DEBUG [] [PollThread] = date:2025-06-19T14:34:37.018205394
2025-06-19 14:34:37,019 DEBUG [] [PollThread] = ticketUri:030000434308-39992431-767e-420e-8cea-8811fc2fa7ee
2025-06-19 14:34:37,019 DEBUG [] [PollThread] = xmlTransportId:030000434308-6635f0eb-d36a-4982-90e2-a1fb1175e553
2025-06-19 14:34:37,019 DEBUG [] [PollThread] = set comments: Документ с номером 00019 и датой 2025-06-19 уже зафиксирован в системе
2025-06-19 14:34:37,019 DEBUG [] [PollThread] = templatePath:xml/ticket.xml
2025-06-19 14:34:37,029 DEBUG [] [PollThread] = <?xml version="1.0" encoding="utf-8"?>
<ns:Documents xmlns:tc="http://fsrar.ru/WEGAIS/Ticket"
              xmlns:oref="http://fsrar.ru/WEGAIS/ClientRef"
              xmlns:ns="http://fsrar.ru/WEGAIS/WB_DOC_SINGLE_01"
              xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
              Version="1.0">
    <ns:Owner>
        <ns:FSRAR_ID>3463047</ns:FSRAR_ID>
    </ns:Owner>
    <ns:Document>
        <ns:Ticket>
            <tc:TicketDate>2025-06-19T14:34:37.018</tc:TicketDate>
            <tc:Identity>00019</tc:Identity>
            <tc:DocId></tc:DocId>
            <tc:TransportId>030000434308-6635f0eb-d36a-4982-90e2-a1fb1175e553</tc:TransportId>
            <tc:RegID></tc:RegID>
            <tc:DocHash/>
            <tc:DocType>RepImportedProduct_v4</tc:DocType>
            <tc:Result>
                <tc:Conclusion>Rejected</tc:Conclusion>
                <tc:ConclusionDate></tc:ConclusionDate>
                <tc:Comments>Документ с номером 00019 и датой 2025-06-19 уже зафиксирован в системе</tc:Comments>
            </tc:Result>
        </ns:Ticket>
    </ns:Document>
</ns:Documents>


2025-06-19 14:34:37,029 DEBUG [] [PollThread] = Для сохранения квитанции используем БД
2025-06-19 14:34:37,032 DEBUG [] [PollThread] = save ticket to DB: Ticket{xml='<?xml version="1.0" encoding="utf-8"?>
<ns:Documents xmlns:tc="http://fsrar.ru/WEGAIS/Ticket"
              xmlns:oref="http://fsrar.ru/WEGAIS/ClientRef"
              xmlns:ns="http://fsrar.ru/WEGAIS/WB_DOC_SINGLE_01"
              xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
              Version="1.0">
    <ns:Owner>
        <ns:FSRAR_ID>3463047</ns:FSRAR_ID>
    </ns:Owner>
    <ns:Document>
        <ns:Ticket>
            <tc:TicketDate>2025-06-19T14:34:37.018</tc:TicketDate>
            <tc:Identity>00019</tc:Identity>
            <tc:DocId></tc:DocId>
            <tc:TransportId>030000434308-6635f0eb-d36a-4982-90e2-a1fb1175e553</tc:TransportId>
            <tc:RegID></tc:RegID>
            <tc:DocHash/>
            <tc:DocType>RepImportedProduct_v4</tc:DocType>
            <tc:Result>
                <tc:Conclusion>Rejected</tc:Conclusion>
                <tc:ConclusionDate></tc:ConclusionDate>
                <tc:Comments>Документ с номером 00019 и датой 2025-06-19 уже зафиксирован в системе</tc:Comments>
            </tc:Result>
        </ns:Ticket>
    </ns:Document>
</ns:Documents>

', nowDateTime=2025-06-19T14:34:37.018205394, ticketDate='2025-06-19', ticketDateTime='2025-06-19T14:34:37.018', docUri='030000434308-6635f0eb-d36a-4982-90e2-a1fb1175e553', ticketUri='030000434308-39992431-767e-420e-8cea-8811fc2fa7ee', ticketUUID='39992431-767e-420e-8cea-8811fc2fa7ee', fsrarId='030000434308', identity='00019', templater=ru.centerinform.svs.insp.Templater@2dda189b, type=DocType{type='repimportedproduct_v4', num='46', ticketDocName='RepImportedProduct_v4'}}
2025-06-19 14:34:37,032 DEBUG [] [PollThread] = INSERT INTO filedata.outboxdata
    (uri, inboxuri, filedata)
    VALUES(?, ?, ?)

2025-06-19 14:34:37,032 DEBUG [] [PollThread] = 39992431-767e-420e-8cea-8811fc2fa7ee 6635f0eb-d36a-4982-90e2-a1fb1175e553 <?xml version="1.0" encoding="utf-8"?>
<ns:Documents xmlns:tc="http://fsrar.ru/WEGAIS/Ticket"
              xmlns:oref="http://fsrar.ru/WEGAIS/ClientRef"
              xmlns:ns="http://fsrar.ru/WEGAIS/WB_DOC_SINGLE_01"
              xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
              Version="1.0">
    <ns:Owner>
        <ns:FSRAR_ID>3463047</ns:FSRAR_ID>
    </ns:Owner>
    <ns:Document>
        <ns:Ticket>
            <tc:TicketDate>2025-06-19T14:34:37.018</tc:TicketDate>
            <tc:Identity>00019</tc:Identity>
            <tc:DocId></tc:DocId>
            <tc:TransportId>030000434308-6635f0eb-d36a-4982-90e2-a1fb1175e553</tc:TransportId>
            <tc:RegID></tc:RegID>
            <tc:DocHash/>
            <tc:DocType>RepImportedProduct_v4</tc:DocType>
            <tc:Result>
                <tc:Conclusion>Rejected</tc:Conclusion>
                <tc:ConclusionDate></tc:ConclusionDate>
                <tc:Comments>Документ с номером 00019 и датой 2025-06-19 уже зафиксирован в системе</tc:Comments>
            </tc:Result>
        </ns:Ticket>
    </ns:Document>
</ns:Documents>


2025-06-19 14:34:37,037 DEBUG [] [PollThread] = insert 1 rows
2025-06-19 14:34:37,037 DEBUG [] [PollThread] = INSERT INTO outbox.meta (dtype, fsrarid, uri, ts)
    VALUES (?, ?, ?, ?)

2025-06-19 14:34:37,038 DEBUG [] [PollThread] = ticket 30000434308 39992431-767e-420e-8cea-8811fc2fa7ee 2025-06-19T14:34:37.018+0300
2025-06-19 14:34:37,044 DEBUG [] [PollThread] = insert 1 rows
2025-06-19 14:34:37,048 DEBUG [] [PollThread] = Fail finish
2025-06-19 14:34:37,048 INFO [] [PollThread] = End processing. 177 ms
2025-06-19 14:34:37,048 DEBUG [] [PollThread] = repeat()
2025-06-19 14:34:37,048 DEBUG [] [PollThread] = repeatEnabled:true
2025-06-19 14:34:37,048 DEBUG [] [PollThread] = repeatRecords size:0

</pre>
}}
{{collapse(Часть лога)
<pre>

2025-06-19 14:34:37,032 DEBUG [] [PollThread] = 39992431-767e-420e-8cea-8811fc2fa7ee 6635f0eb-d36a-4982-90e2-a1fb1175e553 <?xml version="1.0" encoding="utf-8"?>
<ns:Documents xmlns:tc="http://fsrar.ru/WEGAIS/Ticket"
              xmlns:oref="http://fsrar.ru/WEGAIS/ClientRef"
              xmlns:ns="http://fsrar.ru/WEGAIS/WB_DOC_SINGLE_01"
              xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
              Version="1.0">
    <ns:Owner>
        <ns:FSRAR_ID>3463047</ns:FSRAR_ID>
    </ns:Owner>
    <ns:Document>
        <ns:Ticket>
            <tc:TicketDate>2025-06-19T14:34:37.018</tc:TicketDate>
            <tc:Identity>00019</tc:Identity>
            <tc:DocId></tc:DocId>
            <tc:TransportId>030000434308-6635f0eb-d36a-4982-90e2-a1fb1175e553</tc:TransportId>
            <tc:RegID></tc:RegID>
            <tc:DocHash/>
            <tc:DocType>RepImportedProduct_v4</tc:DocType>
            <tc:Result>
                <tc:Conclusion>Rejected</tc:Conclusion>
                <tc:ConclusionDate></tc:ConclusionDate>
                <tc:Comments>Документ с номером 00019 и датой 2025-06-19 уже зафиксирован в системе</tc:Comments>
            </tc:Result>
        </ns:Ticket>
    </ns:Document>
</ns:Documents>
</pre>
}}
{{collapse(select + result)
<pre>


 SELECT 1
FROM
  registry.documents
WHERE
  fsrarid = '030000434308'
  AND dtype::text = 'repimportedproduct_v4'
  AND client_number = '00019'
  AND dt = '2025-06-19'
LIMIT 1;

|?column?|
|--------|
|1       |



</pre>
}}
*Полученный результат:  проверка определилась, статус прохождения проверки проставился корректно, проверка отработала - УСПЕХ*
# senderproducer
## skip {{collapse(БД)
<pre>
|id |document_name_format |document_format_version|check_code    |date_begin|date_end  |ordernum|service_code|check_action|
|---|---------------------|-----------------------|--------------|----------|----------|--------|------------|------------|
|66 |repimportedproduct_v4|4                      |senderproducer|2025-02-20|2050-02-20|3       |inspector   |skip        |

</pre>
}}
{{collapse(Полный лог)
<pre>
2025-06-19 14:41:58,254 DEBUG [] [GtdPollThread] = repeatRecords size:0
2025-06-19 14:41:58,254 DEBUG [] [GtdPollThread] = records is empty
2025-06-19 14:41:58,258 DEBUG [] [GtdPollThread] = commitSync()
2025-06-19 14:41:58,755 DEBUG [] [PollThread] = poll:0
2025-06-19 14:41:58,755 DEBUG [] [PollThread] = repeat()
2025-06-19 14:41:58,755 DEBUG [] [PollThread] = repeatEnabled:true
2025-06-19 14:41:58,755 DEBUG [] [PollThread] = repeatRecords size:0
2025-06-19 14:41:58,755 DEBUG [] [PollThread] = records is empty
2025-06-19 14:41:58,759 DEBUG [] [PollThread] = commitSync()
2025-06-19 14:41:59,257 DEBUG [] [PollThread] = poll:1
2025-06-19 14:41:59,257 DEBUG [] [PollThread] = consume. key:[null] value:[{"type":"repimportedproduct_v4","uri":"030000434308-6635f0eb-d36a-4982-90e2-a1fb1175e555","fsrarid":"030000434308","date":"2025-06-05","timezone":"+03:00","inn":"7841051711","kpp":""}] offset:[20755] topic:[confirmed])
2025-06-19 14:41:59,259 DEBUG [] [GtdPollThread] = poll:0
2025-06-19 14:41:59,259 DEBUG [] [GtdPollThread] = repeat()
2025-06-19 14:41:59,259 DEBUG [] [GtdPollThread] = repeatEnabled:true
2025-06-19 14:41:59,259 DEBUG [] [GtdPollThread] = repeatRecords size:0
2025-06-19 14:41:59,259 DEBUG [] [GtdPollThread] = records is empty
2025-06-19 14:41:59,260 INFO [] [PollThread] = Start processing.
2025-06-19 14:41:59,262 DEBUG [] [GtdPollThread] = commitSync()
2025-06-19 14:41:59,302 DEBUG [] [PollThread] = Для получения файла используем БД
2025-06-19 14:41:59,302 DEBUG [] [PollThread] = Loading data by uri: 6635f0eb-d36a-4982-90e2-a1fb1175e555
2025-06-19 14:41:59,302 DEBUG [] [PollThread] = SELECT filedata FROM filedata.inboxdata
WHERE uri=?
ORDER BY id

2025-06-19 14:41:59,363 DEBUG [] [PollThread] = Doc type:DocType{type='repimportedproduct_v4', num='46', ticketDocName='RepImportedProduct_v4'} date:2025-06-19 number:00020
2025-06-19 14:41:59,363 DEBUG [] [PollThread] = 030000434308-6635f0eb-d36a-4982-90e2-a1fb1175e555
2025-06-19 14:41:59,364 DEBUG [] [PollThread] = Load:62 ms
2025-06-19 14:41:59,367 DEBUG [] [PollThread] = checkExist:repimportedproduct_v4
2025-06-19 14:41:59,375 DEBUG [] [PollThread] = find rule:DocTypeCode[docType=DocType{type='repimportedproduct_v4', num='46', ticketDocName='RepImportedProduct_v4'}, code=doubles] Rule[code=doubles, mode=SKIP, start=Проверка документа на повтор, reject=Документ с номером %s и датой %s уже зафиксирован в системе, confirm=Проверка пройдена]
2025-06-19 14:41:59,375 DEBUG [] [PollThread] = skip:doubles
2025-06-19 14:41:59,376 DEBUG [] [PollThread] = docHash: 6bed5da58d3bd914ee41033d39533f7d
2025-06-19 14:41:59,381 DEBUG [] [PollThread] = set docHash 6bed5da58d3bd914ee41033d39533f7d to redis
2025-06-19 14:41:59,381 DEBUG [] [PollThread] = checkDayShift:repimportedproduct_v4
2025-06-19 14:41:59,382 DEBUG [] [PollThread] = find rule:DocTypeCode[docType=DocType{type='repimportedproduct_v4', num='46', ticketDocName='RepImportedProduct_v4'}, code=daterange] Rule[code=daterange, mode=SKIP, start=Дата, указанная отправителем в документе, может отличаться от даты подачи документа в ЕГАИС на три дня в большую или меньшую сторону (с учетом часовых поясов), reject=Дата документа (%s) отличается от текущей более чем на три дня, confirm=Проверка пройдена]
2025-06-19 14:41:59,382 DEBUG [] [PollThread] = skip:daterange
2025-06-19 14:41:59,382 DEBUG [] [PollThread] = docDate:2025-06-19 
2025-06-19 14:41:59,384 DEBUG [] [PollThread] = importedDate:2025-06-19 
2025-06-19 14:41:59,384 DEBUG [] [PollThread] = betweenDays:0
2025-06-19 14:41:59,384 DEBUG [] [PollThread] = checkShipper:repimportedproduct_v4
2025-06-19 14:41:59,385 DEBUG [] [PollThread] = find rule:DocTypeCode[docType=DocType{type='repimportedproduct_v4', num='46', ticketDocName='RepImportedProduct_v4'}, code=senderproducer] Rule[code=senderproducer, mode=SKIP, start=Отправитель отчета о производстве должен совпадать с производителем продукции, указанным в документе., reject=СИО отправителя документа не соответствует СИО производителя продукции, confirm=Проверка пройдена]
2025-06-19 14:41:59,385 DEBUG [] [PollThread] = skip:senderproducer
2025-06-19 14:41:59,385 DEBUG [] [PollThread] = checkQuantityFormat:DocType{type='repimportedproduct_v4', num='46', ticketDocName='RepImportedProduct_v4'}
2025-06-19 14:41:59,386 DEBUG [] [PollThread] = find rule:DocTypeCode[docType=DocType{type='repimportedproduct_v4', num='46', ticketDocName='RepImportedProduct_v4'}, code=quantity] Rule[code=quantity, mode=SKIP, start=Количество должно быть больше нуля, если значение «isUnpacked» - «0», проверяем что Quantity - целое число, reject=Значение количества продукции с кодом %s не соответствует формату, confirm=Проверка пройдена]
2025-06-19 14:41:59,386 DEBUG [] [PollThread] = skip:quantity
2025-06-19 14:41:59,386 DEBUG [] [PollThread] = find rule:DocTypeCode[docType=DocType{type='repimportedproduct_v4', num='46', ticketDocName='RepImportedProduct_v4'}, code=product] Rule[code=product, mode=SKIP, start=В документах ввода в оборот может быть указана только продукция, предварительно зарегистрированная во ФРАП и имеющая код ЕГАИС, reject=Продукция с кодами %s не зарегистрирована в ЕГАИС, confirm=Проверка пройдена]
2025-06-19 14:41:59,386 DEBUG [] [PollThread] = skip:product
2025-06-19 14:41:59,387 DEBUG [] [PollThread] = checkcUnionMembership [112] 
2025-06-19 14:41:59,387 DEBUG [] [PollThread] = SELECT 1
FROM
  subref.country_unions_lnk cul
  JOIN subref.country_unions cu ON cu.id = cul.country_unions_id
  AND cu.code = 'ЕАЭС'
WHERE
  cul.country_code = ?

2025-06-19 14:41:59,416 DEBUG [] [PollThread] = gen:IMP-0000000049
2025-06-19 14:41:59,418 DEBUG [] [PollThread] = Success
2025-06-19 14:41:59,418 DEBUG [] [PollThread] = Create ticket
2025-06-19 14:41:59,419 DEBUG [] [PollThread] = docUri:030000434308-6635f0eb-d36a-4982-90e2-a1fb1175e555
2025-06-19 14:41:59,419 DEBUG [] [PollThread] = date:2025-06-19T14:41:59.419780149
2025-06-19 14:41:59,420 DEBUG [] [PollThread] = ticketUri:030000434309-d577d688-c6a9-4706-9add-bc1076ed60c2
2025-06-19 14:41:59,420 DEBUG [] [PollThread] = xmlTransportId:030000434308-6635f0eb-d36a-4982-90e2-a1fb1175e555
2025-06-19 14:41:59,421 DEBUG [] [PollThread] = templatePath:xml/ticket.xml
2025-06-19 14:41:59,436 DEBUG [] [PollThread] = <?xml version="1.0" encoding="utf-8"?>
<ns:Documents xmlns:tc="http://fsrar.ru/WEGAIS/Ticket"
              xmlns:oref="http://fsrar.ru/WEGAIS/ClientRef"
              xmlns:ns="http://fsrar.ru/WEGAIS/WB_DOC_SINGLE_01"
              xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
              Version="1.0">
    <ns:Owner>
        <ns:FSRAR_ID>3463047</ns:FSRAR_ID>
    </ns:Owner>
    <ns:Document>
        <ns:Ticket>
            <tc:TicketDate>2025-06-19T14:41:59.419</tc:TicketDate>
            <tc:Identity>00020</tc:Identity>
            <tc:DocId></tc:DocId>
            <tc:TransportId>030000434308-6635f0eb-d36a-4982-90e2-a1fb1175e555</tc:TransportId>
            <tc:RegID>IMP-0000000049</tc:RegID>
            <tc:DocHash/>
            <tc:DocType>RepImportedProduct_v4</tc:DocType>
            <tc:Result>
                <tc:Conclusion>Accepted</tc:Conclusion>
                <tc:ConclusionDate>2025-06-19T14:41:59.419</tc:ConclusionDate>
                <tc:Comments>Документ успешно принят системой на обработку.</tc:Comments>
            </tc:Result>
        </ns:Ticket>
    </ns:Document>
</ns:Documents>


2025-06-19 14:41:59,436 DEBUG [] [PollThread] = Для сохранения квитанции используем БД
2025-06-19 14:41:59,442 DEBUG [] [PollThread] = save ticket to DB: Ticket{xml='<?xml version="1.0" encoding="utf-8"?>
<ns:Documents xmlns:tc="http://fsrar.ru/WEGAIS/Ticket"
              xmlns:oref="http://fsrar.ru/WEGAIS/ClientRef"
              xmlns:ns="http://fsrar.ru/WEGAIS/WB_DOC_SINGLE_01"
              xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
              Version="1.0">
    <ns:Owner>
        <ns:FSRAR_ID>3463047</ns:FSRAR_ID>
    </ns:Owner>
    <ns:Document>
        <ns:Ticket>
            <tc:TicketDate>2025-06-19T14:41:59.419</tc:TicketDate>
            <tc:Identity>00020</tc:Identity>
            <tc:DocId></tc:DocId>
            <tc:TransportId>030000434308-6635f0eb-d36a-4982-90e2-a1fb1175e555</tc:TransportId>
            <tc:RegID>IMP-0000000049</tc:RegID>
            <tc:DocHash/>
            <tc:DocType>RepImportedProduct_v4</tc:DocType>
            <tc:Result>
                <tc:Conclusion>Accepted</tc:Conclusion>
                <tc:ConclusionDate>2025-06-19T14:41:59.419</tc:ConclusionDate>
                <tc:Comments>Документ успешно принят системой на обработку.</tc:Comments>
            </tc:Result>
        </ns:Ticket>
    </ns:Document>
</ns:Documents>

', nowDateTime=2025-06-19T14:41:59.419780149, ticketDate='2025-06-19', ticketDateTime='2025-06-19T14:41:59.419', docUri='030000434308-6635f0eb-d36a-4982-90e2-a1fb1175e555', ticketUri='030000434309-d577d688-c6a9-4706-9add-bc1076ed60c2', ticketUUID='d577d688-c6a9-4706-9add-bc1076ed60c2', fsrarId='030000434309', identity='00020', templater=ru.centerinform.svs.insp.Templater@1450d8ab, type=DocType{type='repimportedproduct_v4', num='46', ticketDocName='RepImportedProduct_v4'}}
2025-06-19 14:41:59,442 DEBUG [] [PollThread] = INSERT INTO filedata.outboxdata
    (uri, inboxuri, filedata)
    VALUES(?, ?, ?)

2025-06-19 14:41:59,442 DEBUG [] [PollThread] = d577d688-c6a9-4706-9add-bc1076ed60c2 6635f0eb-d36a-4982-90e2-a1fb1175e555 <?xml version="1.0" encoding="utf-8"?>
<ns:Documents xmlns:tc="http://fsrar.ru/WEGAIS/Ticket"
              xmlns:oref="http://fsrar.ru/WEGAIS/ClientRef"
              xmlns:ns="http://fsrar.ru/WEGAIS/WB_DOC_SINGLE_01"
              xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
              Version="1.0">
    <ns:Owner>
        <ns:FSRAR_ID>3463047</ns:FSRAR_ID>
    </ns:Owner>
    <ns:Document>
        <ns:Ticket>
            <tc:TicketDate>2025-06-19T14:41:59.419</tc:TicketDate>
            <tc:Identity>00020</tc:Identity>
            <tc:DocId></tc:DocId>
            <tc:TransportId>030000434308-6635f0eb-d36a-4982-90e2-a1fb1175e555</tc:TransportId>
            <tc:RegID>IMP-0000000049</tc:RegID>
            <tc:DocHash/>
            <tc:DocType>RepImportedProduct_v4</tc:DocType>
            <tc:Result>
                <tc:Conclusion>Accepted</tc:Conclusion>
                <tc:ConclusionDate>2025-06-19T14:41:59.419</tc:ConclusionDate>
                <tc:Comments>Документ успешно принят системой на обработку.</tc:Comments>
            </tc:Result>
        </ns:Ticket>
    </ns:Document>
</ns:Documents>


2025-06-19 14:41:59,448 DEBUG [] [PollThread] = insert 1 rows
2025-06-19 14:41:59,448 DEBUG [] [PollThread] = INSERT INTO outbox.meta (dtype, fsrarid, uri, ts)
    VALUES (?, ?, ?, ?)

2025-06-19 14:41:59,449 DEBUG [] [PollThread] = ticket 30000434309 d577d688-c6a9-4706-9add-bc1076ed60c2 2025-06-19T14:41:59.419+0300
2025-06-19 14:41:59,455 DEBUG [] [PollThread] = insert 1 rows
2025-06-19 14:41:59,459 DEBUG [] [PollThread] = {"date":"2025-06-05","uri":"030000434308-6635f0eb-d36a-4982-90e2-a1fb1175e555","type":"repimportedproduct_v4","DocId":"IMP-0000000049"}
2025-06-19 14:41:59,466 DEBUG [] [PollThread] = Success finish
2025-06-19 14:41:59,466 INFO [] [PollThread] = End processing. 205 ms
2025-06-19 14:41:59,466 DEBUG [] [PollThread] = repeat()
2025-06-19 14:41:59,466 DEBUG [] [PollThread] = repeatEnabled:true
2025-06-19 14:41:59,466 DEBUG [] [PollThread] = repeatRecords size:0
2025-06-19 14:41:59,466 DEBUG [] [PollThread] = records is empty
2025-06-19 14:41:59,469 DEBUG [] [PollThread] = commitSync()
2025-06-19 14:42:00,263 DEBUG [] [GtdPollThread] = poll:0

</pre>
}}
{{collapse(Часть лога)
<pre>
2025-06-19 14:41:59,385 DEBUG [] [PollThread] = find rule:DocTypeCode[docType=DocType{type='repimportedproduct_v4', num='46', ticketDocName='RepImportedProduct_v4'}, code=senderproducer] Rule[code=senderproducer, mode=SKIP, start=Отправитель отчета о производстве должен совпадать с производителем продукции, указанным в документе., reject=СИО отправителя документа не соответствует СИО производителя продукции, confirm=Проверка пройдена]
2025-06-19 14:41:59,385 DEBUG [] [PollThread] = skip:senderproducer

</pre>
}}
*Полученный результат: проверка определилась, статус прохождения проверки проставился корректно,тикет корректный - УСПЕХ*
## warn {{collapse(БД)
<pre>
|id |document_name_format |document_format_version|check_code    |date_begin|date_end  |ordernum|service_code|check_action|
|---|---------------------|-----------------------|--------------|----------|----------|--------|------------|------------|
|66 |repimportedproduct_v4|4                      |senderproducer|2025-02-20|2050-02-20|3       |inspector   |warning     |

</pre>
}}
{{collapse(Полный лог)
<pre>
2025-06-19 14:47:20,658 DEBUG [] [GtdPollThread] = repeatRecords size:0
2025-06-19 14:47:20,658 DEBUG [] [GtdPollThread] = records is empty
2025-06-19 14:47:20,661 DEBUG [] [GtdPollThread] = commitSync()
2025-06-19 14:47:21,042 DEBUG [] [PollThread] = poll:0
2025-06-19 14:47:21,042 DEBUG [] [PollThread] = repeat()
2025-06-19 14:47:21,042 DEBUG [] [PollThread] = repeatEnabled:true
2025-06-19 14:47:21,042 DEBUG [] [PollThread] = repeatRecords size:0
2025-06-19 14:47:21,042 DEBUG [] [PollThread] = records is empty
2025-06-19 14:47:21,045 DEBUG [] [PollThread] = commitSync()
2025-06-19 14:47:21,634 DEBUG [] [PollThread] = poll:1
2025-06-19 14:47:21,634 DEBUG [] [PollThread] = consume. key:[null] value:[{"type":"repimportedproduct_v4","uri":"030000434308-6635f0eb-d36a-4982-90e2-a1fb1175e556","fsrarid":"030000434308","date":"2025-06-05","timezone":"+03:00","inn":"7841051711","kpp":""}] offset:[20757] topic:[confirmed])
2025-06-19 14:47:21,634 INFO [] [PollThread] = Start processing.
2025-06-19 14:47:21,638 DEBUG [] [PollThread] = Для получения файла используем БД
2025-06-19 14:47:21,638 DEBUG [] [PollThread] = Loading data by uri: 6635f0eb-d36a-4982-90e2-a1fb1175e556
2025-06-19 14:47:21,638 DEBUG [] [PollThread] = SELECT filedata FROM filedata.inboxdata
WHERE uri=?
ORDER BY id

2025-06-19 14:47:21,662 DEBUG [] [GtdPollThread] = poll:0
2025-06-19 14:47:21,662 DEBUG [] [GtdPollThread] = repeat()
2025-06-19 14:47:21,662 DEBUG [] [GtdPollThread] = repeatEnabled:true
2025-06-19 14:47:21,662 DEBUG [] [GtdPollThread] = repeatRecords size:0
2025-06-19 14:47:21,662 DEBUG [] [GtdPollThread] = records is empty
2025-06-19 14:47:21,665 DEBUG [] [GtdPollThread] = commitSync()
2025-06-19 14:47:21,716 DEBUG [] [PollThread] = Doc type:DocType{type='repimportedproduct_v4', num='46', ticketDocName='RepImportedProduct_v4'} date:2025-06-19 number:00020
2025-06-19 14:47:21,716 DEBUG [] [PollThread] = 030000434308-6635f0eb-d36a-4982-90e2-a1fb1175e556
2025-06-19 14:47:21,717 DEBUG [] [PollThread] = Load:78 ms
2025-06-19 14:47:21,720 DEBUG [] [PollThread] = checkExist:repimportedproduct_v4
2025-06-19 14:47:21,728 DEBUG [] [PollThread] = find rule:DocTypeCode[docType=DocType{type='repimportedproduct_v4', num='46', ticketDocName='RepImportedProduct_v4'}, code=doubles] Rule[code=doubles, mode=SKIP, start=Проверка документа на повтор, reject=Документ с номером %s и датой %s уже зафиксирован в системе, confirm=Проверка пройдена]
2025-06-19 14:47:21,728 DEBUG [] [PollThread] = skip:doubles
2025-06-19 14:47:21,729 DEBUG [] [PollThread] = docHash: 8978c98f0a3674f7f0a4c9e44fe97d9d
2025-06-19 14:47:21,735 DEBUG [] [PollThread] = set docHash 8978c98f0a3674f7f0a4c9e44fe97d9d to redis
2025-06-19 14:47:21,735 DEBUG [] [PollThread] = checkDayShift:repimportedproduct_v4
2025-06-19 14:47:21,736 DEBUG [] [PollThread] = find rule:DocTypeCode[docType=DocType{type='repimportedproduct_v4', num='46', ticketDocName='RepImportedProduct_v4'}, code=daterange] Rule[code=daterange, mode=SKIP, start=Дата, указанная отправителем в документе, может отличаться от даты подачи документа в ЕГАИС на три дня в большую или меньшую сторону (с учетом часовых поясов), reject=Дата документа (%s) отличается от текущей более чем на три дня, confirm=Проверка пройдена]
2025-06-19 14:47:21,736 DEBUG [] [PollThread] = skip:daterange
2025-06-19 14:47:21,736 DEBUG [] [PollThread] = docDate:2025-06-19 
2025-06-19 14:47:21,740 DEBUG [] [PollThread] = importedDate:2025-06-19 
2025-06-19 14:47:21,740 DEBUG [] [PollThread] = betweenDays:0
2025-06-19 14:47:21,740 DEBUG [] [PollThread] = checkShipper:repimportedproduct_v4
2025-06-19 14:47:21,741 DEBUG [] [PollThread] = find rule:DocTypeCode[docType=DocType{type='repimportedproduct_v4', num='46', ticketDocName='RepImportedProduct_v4'}, code=senderproducer] Rule[code=senderproducer, mode=WARNING, start=Отправитель отчета о производстве должен совпадать с производителем продукции, указанным в документе., reject=СИО отправителя документа не соответствует СИО производителя продукции, confirm=Проверка пройдена]
2025-06-19 14:47:21,742 DEBUG [] [PollThread] = warning:{}
ru.centerinform.svs.insp.doc.HandleException: Документ от организации 030000434309 номер 00020 с датой 2025-06-19. Отправитель документа не соответствует импортеру продукции.
	at ru.centerinform.svs.insp.doc.checker.Checker.ex(Checker.java:635) ~[insp-3.27.0.jar:?]
	at ru.centerinform.svs.insp.doc.checker.Checker.checkShipperImpl(Checker.java:384) ~[insp-3.27.0.jar:?]
	at ru.centerinform.svs.insp.doc.checker.Checker.lambda$checkShipper$9(Checker.java:375) ~[insp-3.27.0.jar:?]
	at ru.centerinform.svs.insp.doc.checker.Checker.check(Checker.java:97) ~[insp-3.27.0.jar:?]
	at ru.centerinform.svs.insp.doc.checker.Checker.checkShipper(Checker.java:375) ~[insp-3.27.0.jar:?]
	at ru.centerinform.svs.insp.doc.ri.RIHandler.check(RIHandler.java:67) ~[insp-3.27.0.jar:?]
	at ru.centerinform.svs.insp.doc.ri.RIHandler.handle(RIHandler.java:50) ~[insp-3.27.0.jar:?]
	at ru.centerinform.svs.insp.InspMessageHandler.handleImpl(InspMessageHandler.java:99) ~[insp-3.27.0.jar:?]
	at ru.centerinform.svs.insp.InspMessageHandler.handle(InspMessageHandler.java:76) ~[insp-3.27.0.jar:?]
	at ru.centerinform.svs.insp.kafka.Consumption.poll0(Consumption.java:223) ~[insp-3.27.0.jar:?]
	at ru.centerinform.svs.insp.kafka.Consumption.poll(Consumption.java:93) ~[insp-3.27.0.jar:?]
	at ru.centerinform.svs.insp.kafka.PollThread.run(PollThread.java:121) ~[insp-3.27.0.jar:?]
2025-06-19 14:47:21,742 DEBUG [] [PollThread] = checkQuantityFormat:DocType{type='repimportedproduct_v4', num='46', ticketDocName='RepImportedProduct_v4'}
2025-06-19 14:47:21,743 DEBUG [] [PollThread] = find rule:DocTypeCode[docType=DocType{type='repimportedproduct_v4', num='46', ticketDocName='RepImportedProduct_v4'}, code=quantity] Rule[code=quantity, mode=SKIP, start=Количество должно быть больше нуля, если значение «isUnpacked» - «0», проверяем что Quantity - целое число, reject=Значение количества продукции с кодом %s не соответствует формату, confirm=Проверка пройдена]
2025-06-19 14:47:21,743 DEBUG [] [PollThread] = skip:quantity
2025-06-19 14:47:21,743 DEBUG [] [PollThread] = find rule:DocTypeCode[docType=DocType{type='repimportedproduct_v4', num='46', ticketDocName='RepImportedProduct_v4'}, code=product] Rule[code=product, mode=SKIP, start=В документах ввода в оборот может быть указана только продукция, предварительно зарегистрированная во ФРАП и имеющая код ЕГАИС, reject=Продукция с кодами %s не зарегистрирована в ЕГАИС, confirm=Проверка пройдена]
2025-06-19 14:47:21,743 DEBUG [] [PollThread] = skip:product
2025-06-19 14:47:21,744 DEBUG [] [PollThread] = checkcUnionMembership [112] 
2025-06-19 14:47:21,744 DEBUG [] [PollThread] = SELECT 1
FROM
  subref.country_unions_lnk cul
  JOIN subref.country_unions cu ON cu.id = cul.country_unions_id
  AND cu.code = 'ЕАЭС'
WHERE
  cul.country_code = ?

2025-06-19 14:47:21,776 DEBUG [] [PollThread] = gen:IMP-0000000050
2025-06-19 14:47:21,777 DEBUG [] [PollThread] = Success
2025-06-19 14:47:21,777 DEBUG [] [PollThread] = Create ticket
2025-06-19 14:47:21,778 DEBUG [] [PollThread] = docUri:030000434308-6635f0eb-d36a-4982-90e2-a1fb1175e556
2025-06-19 14:47:21,779 DEBUG [] [PollThread] = date:2025-06-19T14:47:21.779010202
2025-06-19 14:47:21,780 DEBUG [] [PollThread] = ticketUri:030000434309-083719cd-c464-4dd3-afb0-a5fb32b99b73
2025-06-19 14:47:21,780 DEBUG [] [PollThread] = xmlTransportId:030000434308-6635f0eb-d36a-4982-90e2-a1fb1175e556
2025-06-19 14:47:21,780 DEBUG [] [PollThread] = set warning comments: СИО отправителя документа не соответствует СИО производителя продукции
2025-06-19 14:47:21,780 DEBUG [] [PollThread] = templatePath:xml/ticket.xml
2025-06-19 14:47:21,793 DEBUG [] [PollThread] = <?xml version="1.0" encoding="utf-8"?>
<ns:Documents xmlns:tc="http://fsrar.ru/WEGAIS/Ticket"
              xmlns:oref="http://fsrar.ru/WEGAIS/ClientRef"
              xmlns:ns="http://fsrar.ru/WEGAIS/WB_DOC_SINGLE_01"
              xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
              Version="1.0">
    <ns:Owner>
        <ns:FSRAR_ID>3463047</ns:FSRAR_ID>
    </ns:Owner>
    <ns:Document>
        <ns:Ticket>
            <tc:TicketDate>2025-06-19T14:47:21.779</tc:TicketDate>
            <tc:Identity>00020</tc:Identity>
            <tc:DocId></tc:DocId>
            <tc:TransportId>030000434308-6635f0eb-d36a-4982-90e2-a1fb1175e556</tc:TransportId>
            <tc:RegID>IMP-0000000050</tc:RegID>
            <tc:DocHash/>
            <tc:DocType>RepImportedProduct_v4</tc:DocType>
            <tc:Result>
                <tc:Conclusion>Accepted</tc:Conclusion>
                <tc:ConclusionDate>2025-06-19T14:47:21.779</tc:ConclusionDate>
                <tc:Comments>Документ успешно принят системой на обработку. СИО отправителя документа не соответствует СИО производителя продукции</tc:Comments>
            </tc:Result>
        </ns:Ticket>
    </ns:Document>
</ns:Documents>


2025-06-19 14:47:21,793 DEBUG [] [PollThread] = Для сохранения квитанции используем БД
2025-06-19 14:47:21,795 DEBUG [] [PollThread] = save ticket to DB: Ticket{xml='<?xml version="1.0" encoding="utf-8"?>
<ns:Documents xmlns:tc="http://fsrar.ru/WEGAIS/Ticket"
              xmlns:oref="http://fsrar.ru/WEGAIS/ClientRef"
              xmlns:ns="http://fsrar.ru/WEGAIS/WB_DOC_SINGLE_01"
              xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
              Version="1.0">
    <ns:Owner>
        <ns:FSRAR_ID>3463047</ns:FSRAR_ID>
    </ns:Owner>
    <ns:Document>
        <ns:Ticket>
            <tc:TicketDate>2025-06-19T14:47:21.779</tc:TicketDate>
            <tc:Identity>00020</tc:Identity>
            <tc:DocId></tc:DocId>
            <tc:TransportId>030000434308-6635f0eb-d36a-4982-90e2-a1fb1175e556</tc:TransportId>
            <tc:RegID>IMP-0000000050</tc:RegID>
            <tc:DocHash/>
            <tc:DocType>RepImportedProduct_v4</tc:DocType>
            <tc:Result>
                <tc:Conclusion>Accepted</tc:Conclusion>
                <tc:ConclusionDate>2025-06-19T14:47:21.779</tc:ConclusionDate>
                <tc:Comments>Документ успешно принят системой на обработку. СИО отправителя документа не соответствует СИО производителя продукции</tc:Comments>
            </tc:Result>
        </ns:Ticket>
    </ns:Document>
</ns:Documents>

', nowDateTime=2025-06-19T14:47:21.779010202, ticketDate='2025-06-19', ticketDateTime='2025-06-19T14:47:21.779', docUri='030000434308-6635f0eb-d36a-4982-90e2-a1fb1175e556', ticketUri='030000434309-083719cd-c464-4dd3-afb0-a5fb32b99b73', ticketUUID='083719cd-c464-4dd3-afb0-a5fb32b99b73', fsrarId='030000434309', identity='00020', templater=ru.centerinform.svs.insp.Templater@22b57fd8, type=DocType{type='repimportedproduct_v4', num='46', ticketDocName='RepImportedProduct_v4'}}
2025-06-19 14:47:21,795 DEBUG [] [PollThread] = INSERT INTO filedata.outboxdata
    (uri, inboxuri, filedata)
    VALUES(?, ?, ?)

2025-06-19 14:47:21,795 DEBUG [] [PollThread] = 083719cd-c464-4dd3-afb0-a5fb32b99b73 6635f0eb-d36a-4982-90e2-a1fb1175e556 <?xml version="1.0" encoding="utf-8"?>
<ns:Documents xmlns:tc="http://fsrar.ru/WEGAIS/Ticket"
              xmlns:oref="http://fsrar.ru/WEGAIS/ClientRef"
              xmlns:ns="http://fsrar.ru/WEGAIS/WB_DOC_SINGLE_01"
              xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
              Version="1.0">
    <ns:Owner>
        <ns:FSRAR_ID>3463047</ns:FSRAR_ID>
    </ns:Owner>
    <ns:Document>
        <ns:Ticket>
            <tc:TicketDate>2025-06-19T14:47:21.779</tc:TicketDate>
            <tc:Identity>00020</tc:Identity>
            <tc:DocId></tc:DocId>
            <tc:TransportId>030000434308-6635f0eb-d36a-4982-90e2-a1fb1175e556</tc:TransportId>
            <tc:RegID>IMP-0000000050</tc:RegID>
            <tc:DocHash/>
            <tc:DocType>RepImportedProduct_v4</tc:DocType>
            <tc:Result>
                <tc:Conclusion>Accepted</tc:Conclusion>
                <tc:ConclusionDate>2025-06-19T14:47:21.779</tc:ConclusionDate>
                <tc:Comments>Документ успешно принят системой на обработку. СИО отправителя документа не соответствует СИО производителя продукции</tc:Comments>
            </tc:Result>
        </ns:Ticket>
    </ns:Document>
</ns:Documents>


2025-06-19 14:47:21,801 DEBUG [] [PollThread] = insert 1 rows
2025-06-19 14:47:21,801 DEBUG [] [PollThread] = INSERT INTO outbox.meta (dtype, fsrarid, uri, ts)
    VALUES (?, ?, ?, ?)

2025-06-19 14:47:21,802 DEBUG [] [PollThread] = ticket 30000434309 083719cd-c464-4dd3-afb0-a5fb32b99b73 2025-06-19T14:47:21.779+0300
2025-06-19 14:47:21,809 DEBUG [] [PollThread] = insert 1 rows
2025-06-19 14:47:21,813 DEBUG [] [PollThread] = {"date":"2025-06-05","uri":"030000434308-6635f0eb-d36a-4982-90e2-a1fb1175e556","type":"repimportedproduct_v4","DocId":"IMP-0000000050"}
2025-06-19 14:47:21,822 DEBUG [] [PollThread] = Success finish
2025-06-19 14:47:21,822 INFO [] [PollThread] = End processing. 187 ms
2025-06-19 14:47:21,822 DEBUG [] [PollThread] = repeat()

</pre>
}}
{{collapse(Часть лога)
<pre>
2025-06-19 14:47:21,795 DEBUG [] [PollThread] = 083719cd-c464-4dd3-afb0-a5fb32b99b73 6635f0eb-d36a-4982-90e2-a1fb1175e556 <?xml version="1.0" encoding="utf-8"?>
<ns:Documents xmlns:tc="http://fsrar.ru/WEGAIS/Ticket"
              xmlns:oref="http://fsrar.ru/WEGAIS/ClientRef"
              xmlns:ns="http://fsrar.ru/WEGAIS/WB_DOC_SINGLE_01"
              xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
              Version="1.0">
    <ns:Owner>
        <ns:FSRAR_ID>3463047</ns:FSRAR_ID>
    </ns:Owner>
    <ns:Document>
        <ns:Ticket>
            <tc:TicketDate>2025-06-19T14:47:21.779</tc:TicketDate>
            <tc:Identity>00020</tc:Identity>
            <tc:DocId></tc:DocId>
            <tc:TransportId>030000434308-6635f0eb-d36a-4982-90e2-a1fb1175e556</tc:TransportId>
            <tc:RegID>IMP-0000000050</tc:RegID>
            <tc:DocHash/>
            <tc:DocType>RepImportedProduct_v4</tc:DocType>
            <tc:Result>
                <tc:Conclusion>Accepted</tc:Conclusion>
                <tc:ConclusionDate>2025-06-19T14:47:21.779</tc:ConclusionDate>
                <tc:Comments>Документ успешно принят системой на обработку. СИО отправителя документа не соответствует СИО производителя продукции</tc:Comments>
            </tc:Result>
        </ns:Ticket>
    </ns:Document>
</ns:Documents>
</pre>
}}
*Полученный результат: проверка определилась, статус прохождения проверки проставился корректно,тикет корректный - УСПЕХ*
## error {{collapse(БД)
<pre>
|id |document_name_format |document_format_version|check_code    |date_begin|date_end  |ordernum|service_code|check_action|
|---|---------------------|-----------------------|--------------|----------|----------|--------|------------|------------|
|66 |repimportedproduct_v4|4                      |senderproducer|2025-02-20|2050-02-20|3       |inspector   |error       |

</pre>
}}
{{collapse(Полный лог)
<pre>
2025-06-19 14:53:13,109 DEBUG [] [GtdPollThread] = records is empty
2025-06-19 14:53:13,111 DEBUG [] [GtdPollThread] = commitSync()
2025-06-19 14:53:13,771 DEBUG [] [PollThread] = poll:1
2025-06-19 14:53:13,771 DEBUG [] [PollThread] = consume. key:[null] value:[{"type":"repimportedproduct_v4","uri":"030000434308-6635f0eb-d36a-4982-90e2-a1fb1175e557","fsrarid":"030000434308","date":"2025-06-05","timezone":"+03:00","inn":"7841051711","kpp":""}] offset:[20758] topic:[confirmed])
2025-06-19 14:53:13,774 INFO [] [PollThread] = Start processing.
2025-06-19 14:53:14,112 DEBUG [] [GtdPollThread] = poll:0
2025-06-19 14:53:14,112 DEBUG [] [GtdPollThread] = repeat()
2025-06-19 14:53:14,112 DEBUG [] [GtdPollThread] = repeatEnabled:true
2025-06-19 14:53:14,112 DEBUG [] [GtdPollThread] = repeatRecords size:0
2025-06-19 14:53:14,112 DEBUG [] [GtdPollThread] = records is empty
2025-06-19 14:53:14,115 DEBUG [] [GtdPollThread] = commitSync()
2025-06-19 14:53:15,115 DEBUG [] [GtdPollThread] = poll:0
2025-06-19 14:53:15,115 DEBUG [] [GtdPollThread] = repeat()
2025-06-19 14:53:15,115 DEBUG [] [GtdPollThread] = repeatEnabled:true
2025-06-19 14:53:15,115 DEBUG [] [GtdPollThread] = repeatRecords size:0
2025-06-19 14:53:15,115 DEBUG [] [GtdPollThread] = records is empty
2025-06-19 14:53:15,118 DEBUG [] [GtdPollThread] = commitSync()
2025-06-19 14:53:16,119 DEBUG [] [GtdPollThread] = poll:0
2025-06-19 14:53:16,119 DEBUG [] [GtdPollThread] = repeat()
2025-06-19 14:53:16,119 DEBUG [] [GtdPollThread] = repeatEnabled:true
2025-06-19 14:53:16,119 DEBUG [] [GtdPollThread] = repeatRecords size:0
2025-06-19 14:53:16,119 DEBUG [] [GtdPollThread] = records is empty
2025-06-19 14:53:16,122 DEBUG [] [GtdPollThread] = commitSync()
2025-06-19 14:53:17,122 DEBUG [] [GtdPollThread] = poll:0
2025-06-19 14:53:17,122 DEBUG [] [GtdPollThread] = repeat()
2025-06-19 14:53:17,122 DEBUG [] [GtdPollThread] = repeatEnabled:true
2025-06-19 14:53:17,122 DEBUG [] [GtdPollThread] = repeatRecords size:0
2025-06-19 14:53:17,122 DEBUG [] [GtdPollThread] = records is empty
2025-06-19 14:53:17,332 DEBUG [] [GtdPollThread] = commitSync()
2025-06-19 14:53:18,333 DEBUG [] [GtdPollThread] = poll:0
2025-06-19 14:53:18,333 DEBUG [] [GtdPollThread] = repeat()
2025-06-19 14:53:18,333 DEBUG [] [GtdPollThread] = repeatEnabled:true
2025-06-19 14:53:18,333 DEBUG [] [GtdPollThread] = repeatRecords size:0
2025-06-19 14:53:18,333 DEBUG [] [GtdPollThread] = records is empty
2025-06-19 14:53:18,336 DEBUG [] [GtdPollThread] = commitSync()
2025-06-19 14:53:18,831 DEBUG [] [PollThread] = Для получения файла используем БД
2025-06-19 14:53:18,832 DEBUG [] [PollThread] = Loading data by uri: 6635f0eb-d36a-4982-90e2-a1fb1175e557
2025-06-19 14:53:18,832 DEBUG [] [PollThread] = SELECT filedata FROM filedata.inboxdata
WHERE uri=?
ORDER BY id

2025-06-19 14:53:18,908 DEBUG [] [PollThread] = Doc type:DocType{type='repimportedproduct_v4', num='46', ticketDocName='RepImportedProduct_v4'} date:2025-06-19 number:00020
2025-06-19 14:53:18,908 DEBUG [] [PollThread] = 030000434308-6635f0eb-d36a-4982-90e2-a1fb1175e557
2025-06-19 14:53:18,908 DEBUG [] [PollThread] = Load:77 ms
2025-06-19 14:53:18,911 DEBUG [] [PollThread] = checkExist:repimportedproduct_v4
2025-06-19 14:53:18,921 DEBUG [] [PollThread] = find rule:DocTypeCode[docType=DocType{type='repimportedproduct_v4', num='46', ticketDocName='RepImportedProduct_v4'}, code=doubles] Rule[code=doubles, mode=SKIP, start=Проверка документа на повтор, reject=Документ с номером %s и датой %s уже зафиксирован в системе, confirm=Проверка пройдена]
2025-06-19 14:53:18,921 DEBUG [] [PollThread] = skip:doubles
2025-06-19 14:53:18,922 DEBUG [] [PollThread] = docHash: b0108be55f5c83c93c8f6b714b5dc028
2025-06-19 14:53:18,928 DEBUG [] [PollThread] = set docHash b0108be55f5c83c93c8f6b714b5dc028 to redis
2025-06-19 14:53:18,928 DEBUG [] [PollThread] = checkDayShift:repimportedproduct_v4
2025-06-19 14:53:18,928 DEBUG [] [PollThread] = find rule:DocTypeCode[docType=DocType{type='repimportedproduct_v4', num='46', ticketDocName='RepImportedProduct_v4'}, code=daterange] Rule[code=daterange, mode=SKIP, start=Дата, указанная отправителем в документе, может отличаться от даты подачи документа в ЕГАИС на три дня в большую или меньшую сторону (с учетом часовых поясов), reject=Дата документа (%s) отличается от текущей более чем на три дня, confirm=Проверка пройдена]
2025-06-19 14:53:18,928 DEBUG [] [PollThread] = skip:daterange
2025-06-19 14:53:18,929 DEBUG [] [PollThread] = docDate:2025-06-19 
2025-06-19 14:53:18,931 DEBUG [] [PollThread] = importedDate:2025-06-19 
2025-06-19 14:53:18,931 DEBUG [] [PollThread] = betweenDays:0
2025-06-19 14:53:18,931 DEBUG [] [PollThread] = checkShipper:repimportedproduct_v4
2025-06-19 14:53:18,932 DEBUG [] [PollThread] = find rule:DocTypeCode[docType=DocType{type='repimportedproduct_v4', num='46', ticketDocName='RepImportedProduct_v4'}, code=senderproducer] Rule[code=senderproducer, mode=ERROR, start=Отправитель отчета о производстве должен совпадать с производителем продукции, указанным в документе., reject=СИО отправителя документа не соответствует СИО производителя продукции, confirm=Проверка пройдена]
2025-06-19 14:53:18,932 DEBUG [] [PollThread] = error:{}
ru.centerinform.svs.insp.doc.HandleException: Документ от организации 030000434309 номер 00020 с датой 2025-06-19. Отправитель документа не соответствует импортеру продукции.
	at ru.centerinform.svs.insp.doc.checker.Checker.ex(Checker.java:635) ~[insp-3.27.0.jar:?]
	at ru.centerinform.svs.insp.doc.checker.Checker.checkShipperImpl(Checker.java:384) ~[insp-3.27.0.jar:?]
	at ru.centerinform.svs.insp.doc.checker.Checker.lambda$checkShipper$9(Checker.java:375) ~[insp-3.27.0.jar:?]
	at ru.centerinform.svs.insp.doc.checker.Checker.check(Checker.java:109) ~[insp-3.27.0.jar:?]
	at ru.centerinform.svs.insp.doc.checker.Checker.checkShipper(Checker.java:375) ~[insp-3.27.0.jar:?]
	at ru.centerinform.svs.insp.doc.ri.RIHandler.check(RIHandler.java:67) ~[insp-3.27.0.jar:?]
	at ru.centerinform.svs.insp.doc.ri.RIHandler.handle(RIHandler.java:50) ~[insp-3.27.0.jar:?]
	at ru.centerinform.svs.insp.InspMessageHandler.handleImpl(InspMessageHandler.java:99) ~[insp-3.27.0.jar:?]
	at ru.centerinform.svs.insp.InspMessageHandler.handle(InspMessageHandler.java:76) ~[insp-3.27.0.jar:?]
	at ru.centerinform.svs.insp.kafka.Consumption.poll0(Consumption.java:223) ~[insp-3.27.0.jar:?]
	at ru.centerinform.svs.insp.kafka.Consumption.poll(Consumption.java:93) ~[insp-3.27.0.jar:?]
	at ru.centerinform.svs.insp.kafka.PollThread.run(PollThread.java:121) ~[insp-3.27.0.jar:?]
2025-06-19 14:53:18,932 ERROR [] [PollThread] = handle error
ru.centerinform.svs.insp.doc.HandleException: Документ от организации 030000434309 номер 00020 с датой 2025-06-19. Отправитель документа не соответствует импортеру продукции.
	at ru.centerinform.svs.insp.doc.checker.Checker.ex(Checker.java:635) ~[insp-3.27.0.jar:?]
	at ru.centerinform.svs.insp.doc.checker.Checker.checkShipperImpl(Checker.java:384) ~[insp-3.27.0.jar:?]
	at ru.centerinform.svs.insp.doc.checker.Checker.lambda$checkShipper$9(Checker.java:375) ~[insp-3.27.0.jar:?]
	at ru.centerinform.svs.insp.doc.checker.Checker.check(Checker.java:109) ~[insp-3.27.0.jar:?]
	at ru.centerinform.svs.insp.doc.checker.Checker.checkShipper(Checker.java:375) ~[insp-3.27.0.jar:?]
	at ru.centerinform.svs.insp.doc.ri.RIHandler.check(RIHandler.java:67) ~[insp-3.27.0.jar:?]
	at ru.centerinform.svs.insp.doc.ri.RIHandler.handle(RIHandler.java:50) ~[insp-3.27.0.jar:?]
	at ru.centerinform.svs.insp.InspMessageHandler.handleImpl(InspMessageHandler.java:99) ~[insp-3.27.0.jar:?]
	at ru.centerinform.svs.insp.InspMessageHandler.handle(InspMessageHandler.java:76) ~[insp-3.27.0.jar:?]
	at ru.centerinform.svs.insp.kafka.Consumption.poll0(Consumption.java:223) ~[insp-3.27.0.jar:?]
	at ru.centerinform.svs.insp.kafka.Consumption.poll(Consumption.java:93) ~[insp-3.27.0.jar:?]
	at ru.centerinform.svs.insp.kafka.PollThread.run(PollThread.java:121) ~[insp-3.27.0.jar:?]
2025-06-19 14:53:18,933 ERROR [] [PollThread] = Fail
ru.centerinform.svs.insp.doc.HandleException: Документ от организации 030000434309 номер 00020 с датой 2025-06-19. Отправитель документа не соответствует импортеру продукции.
	at ru.centerinform.svs.insp.doc.checker.Checker.ex(Checker.java:635) ~[insp-3.27.0.jar:?]
	at ru.centerinform.svs.insp.doc.checker.Checker.checkShipperImpl(Checker.java:384) ~[insp-3.27.0.jar:?]
	at ru.centerinform.svs.insp.doc.checker.Checker.lambda$checkShipper$9(Checker.java:375) ~[insp-3.27.0.jar:?]
	at ru.centerinform.svs.insp.doc.checker.Checker.check(Checker.java:109) ~[insp-3.27.0.jar:?]
	at ru.centerinform.svs.insp.doc.checker.Checker.checkShipper(Checker.java:375) ~[insp-3.27.0.jar:?]
	at ru.centerinform.svs.insp.doc.ri.RIHandler.check(RIHandler.java:67) ~[insp-3.27.0.jar:?]
	at ru.centerinform.svs.insp.doc.ri.RIHandler.handle(RIHandler.java:50) ~[insp-3.27.0.jar:?]
	at ru.centerinform.svs.insp.InspMessageHandler.handleImpl(InspMessageHandler.java:99) ~[insp-3.27.0.jar:?]
	at ru.centerinform.svs.insp.InspMessageHandler.handle(InspMessageHandler.java:76) ~[insp-3.27.0.jar:?]
	at ru.centerinform.svs.insp.kafka.Consumption.poll0(Consumption.java:223) ~[insp-3.27.0.jar:?]
	at ru.centerinform.svs.insp.kafka.Consumption.poll(Consumption.java:93) ~[insp-3.27.0.jar:?]
	at ru.centerinform.svs.insp.kafka.PollThread.run(PollThread.java:121) ~[insp-3.27.0.jar:?]
2025-06-19 14:53:18,933 DEBUG [] [PollThread] = Remove docHash:b0108be55f5c83c93c8f6b714b5dc028 from redis cache
2025-06-19 14:53:18,935 DEBUG [] [PollThread] = docUri:030000434308-6635f0eb-d36a-4982-90e2-a1fb1175e557
2025-06-19 14:53:18,935 DEBUG [] [PollThread] = date:2025-06-19T14:53:18.935582991
2025-06-19 14:53:18,936 DEBUG [] [PollThread] = ticketUri:030000434309-b34279aa-3838-4e83-9223-39720f2fc4e9
2025-06-19 14:53:18,936 DEBUG [] [PollThread] = xmlTransportId:030000434308-6635f0eb-d36a-4982-90e2-a1fb1175e557
2025-06-19 14:53:18,936 DEBUG [] [PollThread] = set comments: СИО отправителя документа не соответствует СИО производителя продукции
2025-06-19 14:53:18,936 DEBUG [] [PollThread] = templatePath:xml/ticket.xml
2025-06-19 14:53:18,946 DEBUG [] [PollThread] = <?xml version="1.0" encoding="utf-8"?>
<ns:Documents xmlns:tc="http://fsrar.ru/WEGAIS/Ticket"
              xmlns:oref="http://fsrar.ru/WEGAIS/ClientRef"
              xmlns:ns="http://fsrar.ru/WEGAIS/WB_DOC_SINGLE_01"
              xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
              Version="1.0">
    <ns:Owner>
        <ns:FSRAR_ID>3463047</ns:FSRAR_ID>
    </ns:Owner>
    <ns:Document>
        <ns:Ticket>
            <tc:TicketDate>2025-06-19T14:53:18.935</tc:TicketDate>
            <tc:Identity>00020</tc:Identity>
            <tc:DocId></tc:DocId>
            <tc:TransportId>030000434308-6635f0eb-d36a-4982-90e2-a1fb1175e557</tc:TransportId>
            <tc:RegID></tc:RegID>
            <tc:DocHash/>
            <tc:DocType>RepImportedProduct_v4</tc:DocType>
            <tc:Result>
                <tc:Conclusion>Rejected</tc:Conclusion>
                <tc:ConclusionDate></tc:ConclusionDate>
                <tc:Comments>СИО отправителя документа не соответствует СИО производителя продукции</tc:Comments>
            </tc:Result>
        </ns:Ticket>
    </ns:Document>
</ns:Documents>


2025-06-19 14:53:18,946 DEBUG [] [PollThread] = Для сохранения квитанции используем БД
2025-06-19 14:53:18,948 DEBUG [] [PollThread] = save ticket to DB: Ticket{xml='<?xml version="1.0" encoding="utf-8"?>
<ns:Documents xmlns:tc="http://fsrar.ru/WEGAIS/Ticket"
              xmlns:oref="http://fsrar.ru/WEGAIS/ClientRef"
              xmlns:ns="http://fsrar.ru/WEGAIS/WB_DOC_SINGLE_01"
              xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
              Version="1.0">
    <ns:Owner>
        <ns:FSRAR_ID>3463047</ns:FSRAR_ID>
    </ns:Owner>
    <ns:Document>
        <ns:Ticket>
            <tc:TicketDate>2025-06-19T14:53:18.935</tc:TicketDate>
            <tc:Identity>00020</tc:Identity>
            <tc:DocId></tc:DocId>
            <tc:TransportId>030000434308-6635f0eb-d36a-4982-90e2-a1fb1175e557</tc:TransportId>
            <tc:RegID></tc:RegID>
            <tc:DocHash/>
            <tc:DocType>RepImportedProduct_v4</tc:DocType>
            <tc:Result>
                <tc:Conclusion>Rejected</tc:Conclusion>
                <tc:ConclusionDate></tc:ConclusionDate>
                <tc:Comments>СИО отправителя документа не соответствует СИО производителя продукции</tc:Comments>
            </tc:Result>
        </ns:Ticket>
    </ns:Document>
</ns:Documents>

', nowDateTime=2025-06-19T14:53:18.935582991, ticketDate='2025-06-19', ticketDateTime='2025-06-19T14:53:18.935', docUri='030000434308-6635f0eb-d36a-4982-90e2-a1fb1175e557', ticketUri='030000434309-b34279aa-3838-4e83-9223-39720f2fc4e9', ticketUUID='b34279aa-3838-4e83-9223-39720f2fc4e9', fsrarId='030000434309', identity='00020', templater=ru.centerinform.svs.insp.Templater@40d16872, type=DocType{type='repimportedproduct_v4', num='46', ticketDocName='RepImportedProduct_v4'}}
2025-06-19 14:53:18,948 DEBUG [] [PollThread] = INSERT INTO filedata.outboxdata
    (uri, inboxuri, filedata)
    VALUES(?, ?, ?)

2025-06-19 14:53:18,948 DEBUG [] [PollThread] = b34279aa-3838-4e83-9223-39720f2fc4e9 6635f0eb-d36a-4982-90e2-a1fb1175e557 <?xml version="1.0" encoding="utf-8"?>
<ns:Documents xmlns:tc="http://fsrar.ru/WEGAIS/Ticket"
              xmlns:oref="http://fsrar.ru/WEGAIS/ClientRef"
              xmlns:ns="http://fsrar.ru/WEGAIS/WB_DOC_SINGLE_01"
              xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
              Version="1.0">
    <ns:Owner>
        <ns:FSRAR_ID>3463047</ns:FSRAR_ID>
    </ns:Owner>
    <ns:Document>
        <ns:Ticket>
            <tc:TicketDate>2025-06-19T14:53:18.935</tc:TicketDate>
            <tc:Identity>00020</tc:Identity>
            <tc:DocId></tc:DocId>
            <tc:TransportId>030000434308-6635f0eb-d36a-4982-90e2-a1fb1175e557</tc:TransportId>
            <tc:RegID></tc:RegID>
            <tc:DocHash/>
            <tc:DocType>RepImportedProduct_v4</tc:DocType>
            <tc:Result>
                <tc:Conclusion>Rejected</tc:Conclusion>
                <tc:ConclusionDate></tc:ConclusionDate>
                <tc:Comments>СИО отправителя документа не соответствует СИО производителя продукции</tc:Comments>
            </tc:Result>
        </ns:Ticket>
    </ns:Document>
</ns:Documents>


2025-06-19 14:53:18,955 DEBUG [] [PollThread] = insert 1 rows
2025-06-19 14:53:18,955 DEBUG [] [PollThread] = INSERT INTO outbox.meta (dtype, fsrarid, uri, ts)
    VALUES (?, ?, ?, ?)

2025-06-19 14:53:18,955 DEBUG [] [PollThread] = ticket 30000434309 b34279aa-3838-4e83-9223-39720f2fc4e9 2025-06-19T14:53:18.935+0300
2025-06-19 14:53:18,961 DEBUG [] [PollThread] = insert 1 rows
2025-06-19 14:53:18,965 DEBUG [] [PollThread] = Fail finish
2025-06-19 14:53:18,965 INFO [] [PollThread] = End processing. 5190 ms
2025-06-19 14:53:18,965 DEBUG [] [PollThread] = repeat()
2025-06-19 14:53:18,965 DEBUG [] [PollThread] = repeatEnabled:true
2025-06-19 14:53:18,965 DEBUG [] [PollThread] = repeatRecords size:0
2025-06-19 14:53:18,965 DEBUG [] [PollThread] = records is empty
2025-06-19 14:53:18,968 DEBUG [] [PollThread] = commitSync()
2025-06-19 14:53:19,337 DEBUG [] [GtdPollThread] = poll:0
2025-06-19 14:53:19,337 DEBUG [] [GtdPollThread] = repeat()
2025-06-19 14:53:19,337 DEBUG [] [GtdPollThread] = repeatEnabled:true
2025-06-19 14:53:19,337 DEBUG [] [GtdPollThread] = repeatRecords size:0
2025-06-19 14:53:19,337 DEBUG [] [GtdPollThread] = records is empty
2025-06-19 14:53:19,340 DEBUG [] [GtdPollThread] = commitSync()
2025-06-19 14:53:19,969 DEBUG [] [PollThread] = poll:0
2025-06-19 14:53:19,969 DEBUG [] [PollThread] = repeat()
2025-06-19 14:53:19,969 DEBUG [] [PollThread] = repeatEnabled:true
2025-06-19 14:53:19,969 DEBUG [] [PollThread] = repeatRecords size:0
2025-06-19 14:53:19,969 DEBUG [] [PollThread] = records is empty

</pre>
}}
{{collapse(Часть лога)
<pre>
2025-06-19 14:53:18,948 DEBUG [] [PollThread] = b34279aa-3838-4e83-9223-39720f2fc4e9 6635f0eb-d36a-4982-90e2-a1fb1175e557 <?xml version="1.0" encoding="utf-8"?>
<ns:Documents xmlns:tc="http://fsrar.ru/WEGAIS/Ticket"
              xmlns:oref="http://fsrar.ru/WEGAIS/ClientRef"
              xmlns:ns="http://fsrar.ru/WEGAIS/WB_DOC_SINGLE_01"
              xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
              Version="1.0">
    <ns:Owner>
        <ns:FSRAR_ID>3463047</ns:FSRAR_ID>
    </ns:Owner>
    <ns:Document>
        <ns:Ticket>
            <tc:TicketDate>2025-06-19T14:53:18.935</tc:TicketDate>
            <tc:Identity>00020</tc:Identity>
            <tc:DocId></tc:DocId>
            <tc:TransportId>030000434308-6635f0eb-d36a-4982-90e2-a1fb1175e557</tc:TransportId>
            <tc:RegID></tc:RegID>
            <tc:DocHash/>
            <tc:DocType>RepImportedProduct_v4</tc:DocType>
            <tc:Result>
                <tc:Conclusion>Rejected</tc:Conclusion>
                <tc:ConclusionDate></tc:ConclusionDate>
                <tc:Comments>СИО отправителя документа не соответствует СИО производителя продукции</tc:Comments>
            </tc:Result>
        </ns:Ticket>
    </ns:Document>
</ns:Documents>

</pre>
}}
*Полученный результат: проверка определилась, статус прохождения проверки проставился корректно, тикет сформировался корректный - УСПЕХ*

---

h6. Ошибки 

* Решил перечитать все шаблоны тестов ошибок
И увидел, что в quantity вместо кода продукции стоит пробел (Значение количества продукции с кодом не соответствует формату), а шаблон выгядит вот так: Значение количества продукции с кодом %s не соответствует формату (П. 2.3)
* quantity - Пока не очень понятно как воспроизвести именно эту проверку. Так как она перекрывается другой проверкой по тэгу Quantity (У Леши было предложение объединение этих проверок, но для этого требуется официальное указание) (П. 2)
